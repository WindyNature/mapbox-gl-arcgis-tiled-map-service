{"version":3,"file":"mapbox-gl-arcgis-tiled-map-service.js","sources":["../node_modules/mapbox-gl/src/util/util.js","../node_modules/mapbox-gl/src/util/config.js","../node_modules/mapbox-gl/src/util/browser.js","../node_modules/mapbox-gl/src/util/webp_supported.js","../node_modules/mapbox-gl/src/util/mapbox.js","../node_modules/mapbox-gl/src/util/sku_token.js","../node_modules/mapbox-gl/src/util/tile_request_cache.js","../node_modules/mapbox-gl/src/util/ajax.js","../node_modules/mapbox-gl/src/util/evented.js","../node_modules/@mapbox/sphericalmercator/sphericalmercator.js","../src/load_arcgis_mapserver.js","../node_modules/mapbox-gl/src/geo/lng_lat.js","../node_modules/mapbox-gl/src/geo/lng_lat_bounds.js","../node_modules/mapbox-gl/src/geo/mercator_coordinate.js","../node_modules/mapbox-gl/src/source/tile_bounds.js","../src/helpers.js","../node_modules/mapbox-gl/src/render/texture.js","../src/arcgis_tiled_map_service_source.js"],"sourcesContent":["// @flow\n\nimport UnitBezier from '@mapbox/unitbezier';\n\nimport Point from '@mapbox/point-geometry';\nimport window from './window';\n\nimport type {Callback} from '../types/callback';\n\n/**\n * @module util\n * @private\n */\n\n/**\n * Given a value `t` that varies between 0 and 1, return\n * an interpolation function that eases between 0 and 1 in a pleasing\n * cubic in-out fashion.\n *\n * @private\n */\nexport function easeCubicInOut(t: number): number {\n    if (t <= 0) return 0;\n    if (t >= 1) return 1;\n    const t2 = t * t,\n        t3 = t2 * t;\n    return 4 * (t < 0.5 ? t3 : 3 * (t - t2) + t3 - 0.75);\n}\n\n/**\n * Given given (x, y), (x1, y1) control points for a bezier curve,\n * return a function that interpolates along that curve.\n *\n * @param p1x control point 1 x coordinate\n * @param p1y control point 1 y coordinate\n * @param p2x control point 2 x coordinate\n * @param p2y control point 2 y coordinate\n * @private\n */\nexport function bezier(p1x: number, p1y: number, p2x: number, p2y: number): (t: number) => number {\n    const bezier = new UnitBezier(p1x, p1y, p2x, p2y);\n    return function(t: number) {\n        return bezier.solve(t);\n    };\n}\n\n/**\n * A default bezier-curve powered easing function with\n * control points (0.25, 0.1) and (0.25, 1)\n *\n * @private\n */\nexport const ease = bezier(0.25, 0.1, 0.25, 1);\n\n/**\n * constrain n to the given range via min + max\n *\n * @param n value\n * @param min the minimum value to be returned\n * @param max the maximum value to be returned\n * @returns the clamped value\n * @private\n */\nexport function clamp(n: number, min: number, max: number): number {\n    return Math.min(max, Math.max(min, n));\n}\n\n/**\n * constrain n to the given range, excluding the minimum, via modular arithmetic\n *\n * @param n value\n * @param min the minimum value to be returned, exclusive\n * @param max the maximum value to be returned, inclusive\n * @returns constrained number\n * @private\n */\nexport function wrap(n: number, min: number, max: number): number {\n    const d = max - min;\n    const w = ((n - min) % d + d) % d + min;\n    return (w === min) ? max : w;\n}\n\n/*\n * Call an asynchronous function on an array of arguments,\n * calling `callback` with the completed results of all calls.\n *\n * @param array input to each call of the async function.\n * @param fn an async function with signature (data, callback)\n * @param callback a callback run after all async work is done.\n * called with an array, containing the results of each async call.\n * @private\n */\nexport function asyncAll<Item, Result>(\n    array: Array<Item>,\n    fn: (item: Item, fnCallback: Callback<Result>) => void,\n    callback: Callback<Array<Result>>\n) {\n    if (!array.length) { return callback(null, []); }\n    let remaining = array.length;\n    const results = new Array(array.length);\n    let error = null;\n    array.forEach((item, i) => {\n        fn(item, (err, result) => {\n            if (err) error = err;\n            results[i] = ((result: any): Result); // https://github.com/facebook/flow/issues/2123\n            if (--remaining === 0) callback(error, results);\n        });\n    });\n}\n\n/*\n * Polyfill for Object.values. Not fully spec compliant, but we don't\n * need it to be.\n *\n * @private\n */\nexport function values<T>(obj: {[key: string]: T}): Array<T> {\n    const result = [];\n    for (const k in obj) {\n        result.push(obj[k]);\n    }\n    return result;\n}\n\n/*\n * Compute the difference between the keys in one object and the keys\n * in another object.\n *\n * @returns keys difference\n * @private\n */\nexport function keysDifference<S, T>(obj: {[key: string]: S}, other: {[key: string]: T}): Array<string> {\n    const difference = [];\n    for (const i in obj) {\n        if (!(i in other)) {\n            difference.push(i);\n        }\n    }\n    return difference;\n}\n\n/**\n * Given a destination object and optionally many source objects,\n * copy all properties from the source objects into the destination.\n * The last source object given overrides properties from previous\n * source objects.\n *\n * @param dest destination object\n * @param sources sources from which properties are pulled\n * @private\n */\nexport function extend(dest: Object, ...sources: Array<?Object>): Object {\n    for (const src of sources) {\n        for (const k in src) {\n            dest[k] = src[k];\n        }\n    }\n    return dest;\n}\n\n/**\n * Given an object and a number of properties as strings, return version\n * of that object with only those properties.\n *\n * @param src the object\n * @param properties an array of property names chosen\n * to appear on the resulting object.\n * @returns object with limited properties.\n * @example\n * var foo = { name: 'Charlie', age: 10 };\n * var justName = pick(foo, ['name']);\n * // justName = { name: 'Charlie' }\n * @private\n */\nexport function pick(src: Object, properties: Array<string>): Object {\n    const result = {};\n    for (let i = 0; i < properties.length; i++) {\n        const k = properties[i];\n        if (k in src) {\n            result[k] = src[k];\n        }\n    }\n    return result;\n}\n\nlet id = 1;\n\n/**\n * Return a unique numeric id, starting at 1 and incrementing with\n * each call.\n *\n * @returns unique numeric id.\n * @private\n */\nexport function uniqueId(): number {\n    return id++;\n}\n\n/**\n * Return a random UUID (v4). Taken from: https://gist.github.com/jed/982883\n * @private\n */\nexport function uuid(): string {\n    function b(a) {\n        return a ? (a ^ Math.random() * 16 >> a / 4).toString(16) :\n        //$FlowFixMe: Flow doesn't like the implied array literal conversion here\n            ([1e7] + -[1e3] + -4e3 + -8e3 + -1e11).replace(/[018]/g, b);\n    }\n    return b();\n}\n\n/**\n * Validate a string to match UUID(v4) of the\n * form: xxxxxxxx-xxxx-4xxx-[89ab]xxx-xxxxxxxxxxxx\n * @param str string to validate.\n * @private\n */\nexport function validateUuid(str: ?string): boolean {\n    return str ? /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(str) : false;\n}\n\n/**\n * Given an array of member function names as strings, replace all of them\n * with bound versions that will always refer to `context` as `this`. This\n * is useful for classes where otherwise event bindings would reassign\n * `this` to the evented object or some other value: this lets you ensure\n * the `this` value always.\n *\n * @param fns list of member function names\n * @param context the context value\n * @example\n * function MyClass() {\n *   bindAll(['ontimer'], this);\n *   this.name = 'Tom';\n * }\n * MyClass.prototype.ontimer = function() {\n *   alert(this.name);\n * };\n * var myClass = new MyClass();\n * setTimeout(myClass.ontimer, 100);\n * @private\n */\nexport function bindAll(fns: Array<string>, context: Object): void {\n    fns.forEach((fn) => {\n        if (!context[fn]) { return; }\n        context[fn] = context[fn].bind(context);\n    });\n}\n\n/**\n * Determine if a string ends with a particular substring\n *\n * @private\n */\nexport function endsWith(string: string, suffix: string): boolean {\n    return string.indexOf(suffix, string.length - suffix.length) !== -1;\n}\n\n/**\n * Create an object by mapping all the values of an existing object while\n * preserving their keys.\n *\n * @private\n */\nexport function mapObject(input: Object, iterator: Function, context?: Object): Object {\n    const output = {};\n    for (const key in input) {\n        output[key] = iterator.call(context || this, input[key], key, input);\n    }\n    return output;\n}\n\n/**\n * Create an object by filtering out values of an existing object.\n *\n * @private\n */\nexport function filterObject(input: Object, iterator: Function, context?: Object): Object {\n    const output = {};\n    for (const key in input) {\n        if (iterator.call(context || this, input[key], key, input)) {\n            output[key] = input[key];\n        }\n    }\n    return output;\n}\n\nimport deepEqual from '../style-spec/util/deep_equal';\nexport {deepEqual};\n\n/**\n * Deeply clones two objects.\n *\n * @private\n */\nexport function clone<T>(input: T): T {\n    if (Array.isArray(input)) {\n        return input.map(clone);\n    } else if (typeof input === 'object' && input) {\n        return ((mapObject(input, clone): any): T);\n    } else {\n        return input;\n    }\n}\n\n/**\n * Check if two arrays have at least one common element.\n *\n * @private\n */\nexport function arraysIntersect<T>(a: Array<T>, b: Array<T>): boolean {\n    for (let l = 0; l < a.length; l++) {\n        if (b.indexOf(a[l]) >= 0) return true;\n    }\n    return false;\n}\n\n/**\n * Print a warning message to the console and ensure duplicate warning messages\n * are not printed.\n *\n * @private\n */\nconst warnOnceHistory: {[key: string]: boolean} = {};\n\nexport function warnOnce(message: string): void {\n    if (!warnOnceHistory[message]) {\n        // console isn't defined in some WebWorkers, see #2558\n        if (typeof console !== \"undefined\") console.warn(message);\n        warnOnceHistory[message] = true;\n    }\n}\n\n/**\n * Indicates if the provided Points are in a counter clockwise (true) or clockwise (false) order\n *\n * @private\n * @returns true for a counter clockwise set of points\n */\n// http://bryceboe.com/2006/10/23/line-segment-intersection-algorithm/\nexport function isCounterClockwise(a: Point, b: Point, c: Point): boolean {\n    return (c.y - a.y) * (b.x - a.x) > (b.y - a.y) * (c.x - a.x);\n}\n\n/**\n * Returns the signed area for the polygon ring.  Postive areas are exterior rings and\n * have a clockwise winding.  Negative areas are interior rings and have a counter clockwise\n * ordering.\n *\n * @private\n * @param ring Exterior or interior ring\n */\nexport function calculateSignedArea(ring: Array<Point>): number {\n    let sum = 0;\n    for (let i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\n        p1 = ring[i];\n        p2 = ring[j];\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\n    }\n    return sum;\n}\n\n/**\n * Detects closed polygons, first + last point are equal\n *\n * @private\n * @param points array of points\n * @return true if the points are a closed polygon\n */\nexport function isClosedPolygon(points: Array<Point>): boolean {\n    // If it is 2 points that are the same then it is a point\n    // If it is 3 points with start and end the same then it is a line\n    if (points.length < 4)\n        return false;\n\n    const p1 = points[0];\n    const p2 = points[points.length - 1];\n\n    if (Math.abs(p1.x - p2.x) > 0 ||\n        Math.abs(p1.y - p2.y) > 0) {\n        return false;\n    }\n\n    // polygon simplification can produce polygons with zero area and more than 3 points\n    return Math.abs(calculateSignedArea(points)) > 0.01;\n}\n\n/**\n * Converts spherical coordinates to cartesian coordinates.\n *\n * @private\n * @param spherical Spherical coordinates, in [radial, azimuthal, polar]\n * @return cartesian coordinates in [x, y, z]\n */\n\nexport function sphericalToCartesian([r, azimuthal, polar]: [number, number, number]): {x: number, y: number, z: number} {\n    // We abstract \"north\"/\"up\" (compass-wise) to be 0° when really this is 90° (π/2):\n    // correct for that here\n    azimuthal += 90;\n\n    // Convert azimuthal and polar angles to radians\n    azimuthal *= Math.PI / 180;\n    polar *= Math.PI / 180;\n\n    return {\n        x: r * Math.cos(azimuthal) * Math.sin(polar),\n        y: r * Math.sin(azimuthal) * Math.sin(polar),\n        z: r * Math.cos(polar)\n    };\n}\n\n/**\n * Parses data from 'Cache-Control' headers.\n *\n * @private\n * @param cacheControl Value of 'Cache-Control' header\n * @return object containing parsed header info.\n */\n\nexport function parseCacheControl(cacheControl: string): Object {\n    // Taken from [Wreck](https://github.com/hapijs/wreck)\n    const re = /(?:^|(?:\\s*\\,\\s*))([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)(?:\\=(?:([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)|(?:\\\"((?:[^\"\\\\]|\\\\.)*)\\\")))?/g;\n\n    const header = {};\n    cacheControl.replace(re, ($0, $1, $2, $3) => {\n        const value = $2 || $3;\n        header[$1] = value ? value.toLowerCase() : true;\n        return '';\n    });\n\n    if (header['max-age']) {\n        const maxAge = parseInt(header['max-age'], 10);\n        if (isNaN(maxAge)) delete header['max-age'];\n        else header['max-age'] = maxAge;\n    }\n\n    return header;\n}\n\nexport function storageAvailable(type: string): boolean {\n    try {\n        const storage = window[type];\n        storage.setItem('_mapbox_test_', 1);\n        storage.removeItem('_mapbox_test_');\n        return true;\n    } catch (e) {\n        return false;\n    }\n}\n\n// The following methods are from https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\n//Unicode compliant base64 encoder for strings\nexport function b64EncodeUnicode(str: string) {\n    return window.btoa(\n        encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,\n            (match, p1) => {\n                return String.fromCharCode(Number('0x' + p1)); //eslint-disable-line\n            }\n        )\n    );\n}\n\n// Unicode compliant decoder for base64-encoded strings\nexport function b64DecodeUnicode(str: string) {\n    return decodeURIComponent(window.atob(str).split('').map((c) => {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2); //eslint-disable-line\n    }).join(''));\n}\n","// @flow strict\n\ntype Config = {|\n  API_URL: string,\n  EVENTS_URL: ?string,\n  FEEDBACK_URL: string,\n  REQUIRE_ACCESS_TOKEN: boolean,\n  ACCESS_TOKEN: ?string,\n  MAX_PARALLEL_IMAGE_REQUESTS: number\n|};\n\nconst config: Config = {\n    API_URL: 'https://api.mapbox.com',\n    get EVENTS_URL() {\n        if (!this.API_URL) { return null; }\n        if (this.API_URL.indexOf('https://api.mapbox.cn') === 0) {\n            return 'https://events.mapbox.cn/events/v2';\n        } else if (this.API_URL.indexOf('https://api.mapbox.com') === 0) {\n            return 'https://events.mapbox.com/events/v2';\n        } else {\n            return null;\n        }\n    },\n    FEEDBACK_URL: 'https://apps.mapbox.com/feedback',\n    REQUIRE_ACCESS_TOKEN: true,\n    ACCESS_TOKEN: null,\n    MAX_PARALLEL_IMAGE_REQUESTS: 16\n};\n\nexport default config;\n","// @flow strict\n\nimport window from './window';\nimport type {Cancelable} from '../types/cancelable';\n\nconst now = window.performance && window.performance.now ?\n    window.performance.now.bind(window.performance) :\n    Date.now.bind(Date);\n\nconst raf = window.requestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.msRequestAnimationFrame;\n\nconst cancel = window.cancelAnimationFrame ||\n    window.mozCancelAnimationFrame ||\n    window.webkitCancelAnimationFrame ||\n    window.msCancelAnimationFrame;\n\nlet linkEl;\n\nlet reducedMotionQuery: MediaQueryList;\n\n/**\n * @private\n */\nconst exported = {\n    /**\n     * Provides a function that outputs milliseconds: either performance.now()\n     * or a fallback to Date.now()\n     */\n    now,\n\n    frame(fn: () => void): Cancelable {\n        const frame = raf(fn);\n        return {cancel: () => cancel(frame)};\n    },\n\n    getImageData(img: CanvasImageSource, padding?: number = 0): ImageData {\n        const canvas = window.document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        if (!context) {\n            throw new Error('failed to create canvas 2d context');\n        }\n        canvas.width = img.width;\n        canvas.height = img.height;\n        context.drawImage(img, 0, 0, img.width, img.height);\n        return context.getImageData(-padding, -padding, img.width + 2 * padding, img.height + 2 * padding);\n    },\n\n    resolveURL(path: string) {\n        if (!linkEl) linkEl = window.document.createElement('a');\n        linkEl.href = path;\n        return linkEl.href;\n    },\n\n    hardwareConcurrency: window.navigator.hardwareConcurrency || 4,\n\n    get devicePixelRatio() { return window.devicePixelRatio; },\n    get prefersReducedMotion(): boolean {\n        if (!window.matchMedia) return false;\n        //Lazily initialize media query\n        if (reducedMotionQuery == null) {\n            reducedMotionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n        }\n        return reducedMotionQuery.matches;\n    },\n};\n\nexport default exported;\n","// @flow strict\n\nimport window from './window';\n\nconst exported = {\n    supported: false,\n    testSupport\n};\n\nexport default exported;\n\nlet glForTesting;\nlet webpCheckComplete = false;\nlet webpImgTest;\nlet webpImgTestOnloadComplete = false;\n\nif (window.document) {\n    webpImgTest = window.document.createElement('img');\n    webpImgTest.onload = function() {\n        if (glForTesting) testWebpTextureUpload(glForTesting);\n        glForTesting = null;\n        webpImgTestOnloadComplete = true;\n    };\n    webpImgTest.onerror = function() {\n        webpCheckComplete = true;\n        glForTesting = null;\n    };\n    webpImgTest.src = 'data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=';\n}\n\nfunction testSupport(gl: WebGLRenderingContext) {\n    if (webpCheckComplete || !webpImgTest) return;\n\n    // HTMLImageElement.complete is set when an image is done loading it's source\n    // regardless of whether the load was successful or not.\n    // It's possible for an error to set HTMLImageElement.complete to true which would trigger\n    // testWebpTextureUpload and mistakenly set exported.supported to true in browsers which don't support webp\n    // To avoid this, we set a flag in the image's onload handler and only call testWebpTextureUpload\n    // after a successful image load event.\n    if (webpImgTestOnloadComplete) {\n        testWebpTextureUpload(gl);\n    } else {\n        glForTesting = gl;\n\n    }\n}\n\nfunction testWebpTextureUpload(gl: WebGLRenderingContext) {\n    // Edge 18 supports WebP but not uploading a WebP image to a gl texture\n    // Test support for this before allowing WebP images.\n    // https://github.com/mapbox/mapbox-gl-js/issues/7671\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    try {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, webpImgTest);\n\n        // The error does not get triggered in Edge if the context is lost\n        if (gl.isContextLost()) return;\n\n        exported.supported = true;\n    } catch (e) {\n        // Catch \"Unspecified Error.\" in Edge 18.\n    }\n\n    gl.deleteTexture(texture);\n\n    webpCheckComplete = true;\n}\n","// @flow\n\n/***** START WARNING - IF YOU USE THIS CODE WITH MAPBOX MAPPING APIS, REMOVAL OR\n* MODIFICATION OF THE FOLLOWING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******\n* The following code is used to access Mapbox's Mapping APIs. Removal or modification\n* of this code when used with Mapbox's Mapping APIs can result in higher fees and/or\n* termination of your account with Mapbox.\n*\n* Under the Mapbox Terms of Service, you may not use this code to access Mapbox\n* Mapping APIs other than through Mapbox SDKs.\n*\n* The Mapping APIs documentation is available at https://docs.mapbox.com/api/maps/#maps\n* and the Mapbox Terms of Service are available at https://www.mapbox.com/tos/\n******************************************************************************/\n\nimport config from './config';\n\nimport browser from './browser';\nimport window from './window';\nimport webpSupported from './webp_supported';\nimport {createSkuToken, SKU_ID} from './sku_token';\nimport {version as sdkVersion} from '../../package.json';\nimport {uuid, validateUuid, storageAvailable, b64DecodeUnicode, b64EncodeUnicode, warnOnce, extend} from './util';\nimport {postData, ResourceType} from './ajax';\n\nimport type {RequestParameters} from './ajax';\nimport type {Cancelable} from '../types/cancelable';\nimport type {TileJSON} from '../types/tilejson';\n\ntype ResourceTypeEnum = $Keys<typeof ResourceType>;\nexport type RequestTransformFunction = (url: string, resourceType?: ResourceTypeEnum) => RequestParameters;\n\ntype UrlObject = {|\n    protocol: string,\n    authority: string,\n    path: string,\n    params: Array<string>\n|};\n\nexport class RequestManager {\n    _skuToken: string;\n    _skuTokenExpiresAt: number;\n    _transformRequestFn: ?RequestTransformFunction;\n    _customAccessToken: ?string;\n\n    constructor(transformRequestFn?: RequestTransformFunction, customAccessToken?: string) {\n        this._transformRequestFn = transformRequestFn;\n        this._customAccessToken = customAccessToken;\n        this._createSkuToken();\n    }\n\n    _createSkuToken() {\n        const skuToken = createSkuToken();\n        this._skuToken = skuToken.token;\n        this._skuTokenExpiresAt = skuToken.tokenExpiresAt;\n    }\n\n    _isSkuTokenExpired(): boolean {\n        return Date.now() > this._skuTokenExpiresAt;\n    }\n\n    transformRequest(url: string, type: ResourceTypeEnum) {\n        if (this._transformRequestFn) {\n            return this._transformRequestFn(url, type) || {url};\n        }\n\n        return {url};\n    }\n\n    normalizeStyleURL(url: string, accessToken?: string): string {\n        if (!isMapboxURL(url)) return url;\n        const urlObject = parseUrl(url);\n        urlObject.path = `/styles/v1${urlObject.path}`;\n        return this._makeAPIURL(urlObject, this._customAccessToken || accessToken);\n    }\n\n    normalizeGlyphsURL(url: string, accessToken?: string): string {\n        if (!isMapboxURL(url)) return url;\n        const urlObject = parseUrl(url);\n        urlObject.path = `/fonts/v1${urlObject.path}`;\n        return this._makeAPIURL(urlObject, this._customAccessToken || accessToken);\n    }\n\n    normalizeSourceURL(url: string, accessToken?: string): string {\n        if (!isMapboxURL(url)) return url;\n        const urlObject = parseUrl(url);\n        urlObject.path = `/v4/${urlObject.authority}.json`;\n        // TileJSON requests need a secure flag appended to their URLs so\n        // that the server knows to send SSL-ified resource references.\n        urlObject.params.push('secure');\n        return this._makeAPIURL(urlObject, this._customAccessToken || accessToken);\n    }\n\n    normalizeSpriteURL(url: string, format: string, extension: string, accessToken?: string): string {\n        const urlObject = parseUrl(url);\n        if (!isMapboxURL(url)) {\n            urlObject.path += `${format}${extension}`;\n            return formatUrl(urlObject);\n        }\n        urlObject.path = `/styles/v1${urlObject.path}/sprite${format}${extension}`;\n        return this._makeAPIURL(urlObject, this._customAccessToken || accessToken);\n    }\n\n    normalizeTileURL(tileURL: string, sourceURL?: ?string, tileSize?: ?number): string {\n        if (this._isSkuTokenExpired()) {\n            this._createSkuToken();\n        }\n\n        if (!sourceURL || !isMapboxURL(sourceURL)) return tileURL;\n\n        const urlObject = parseUrl(tileURL);\n        const imageExtensionRe = /(\\.(png|jpg)\\d*)(?=$)/;\n        const tileURLAPIPrefixRe = /^.+\\/v4\\//;\n\n        // The v4 mapbox tile API supports 512x512 image tiles only when @2x\n        // is appended to the tile URL. If `tileSize: 512` is specified for\n        // a Mapbox raster source force the @2x suffix even if a non hidpi device.\n        const suffix = browser.devicePixelRatio >= 2 || tileSize === 512 ? '@2x' : '';\n        const extension = webpSupported.supported ? '.webp' : '$1';\n        urlObject.path = urlObject.path.replace(imageExtensionRe, `${suffix}${extension}`);\n        urlObject.path = urlObject.path.replace(tileURLAPIPrefixRe, '/');\n        urlObject.path = `/v4${urlObject.path}`;\n\n        if (config.REQUIRE_ACCESS_TOKEN && (config.ACCESS_TOKEN || this._customAccessToken) && this._skuToken) {\n            urlObject.params.push(`sku=${this._skuToken}`);\n        }\n\n        return this._makeAPIURL(urlObject, this._customAccessToken);\n    }\n\n    canonicalizeTileURL(url: string) {\n        const version = \"/v4/\";\n        // matches any file extension specified by a dot and one or more alphanumeric characters\n        const extensionRe = /\\.[\\w]+$/;\n\n        const urlObject = parseUrl(url);\n        // Make sure that we are dealing with a valid Mapbox tile URL.\n        // Has to begin with /v4/, with a valid filename + extension\n        if (!urlObject.path.match(/(^\\/v4\\/)/) || !urlObject.path.match(extensionRe)) {\n            // Not a proper Mapbox tile URL.\n            return url;\n        }\n        // Reassemble the canonical URL from the parts we've parsed before.\n        let result = \"mapbox://tiles/\";\n        result +=  urlObject.path.replace(version, '');\n\n        // Append the query string, minus the access token parameter.\n        const params = urlObject.params.filter(p => !p.match(/^access_token=/));\n        if (params.length) result += `?${params.join('&')}`;\n        return result;\n    }\n\n    canonicalizeTileset(tileJSON: TileJSON, sourceURL: string) {\n        if (!isMapboxURL(sourceURL)) return tileJSON.tiles || [];\n        const canonical = [];\n        for (const url of tileJSON.tiles) {\n            const canonicalUrl = this.canonicalizeTileURL(url);\n            canonical.push(canonicalUrl);\n        }\n        return canonical;\n    }\n\n    _makeAPIURL(urlObject: UrlObject, accessToken: string | null | void): string {\n        const help = 'See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes';\n        const apiUrlObject = parseUrl(config.API_URL);\n        urlObject.protocol = apiUrlObject.protocol;\n        urlObject.authority = apiUrlObject.authority;\n\n        if (apiUrlObject.path !== '/') {\n            urlObject.path = `${apiUrlObject.path}${urlObject.path}`;\n        }\n\n        if (!config.REQUIRE_ACCESS_TOKEN) return formatUrl(urlObject);\n\n        accessToken = accessToken || config.ACCESS_TOKEN;\n        if (!accessToken)\n            throw new Error(`An API access token is required to use Mapbox GL. ${help}`);\n        if (accessToken[0] === 's')\n            throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${help}`);\n\n        urlObject.params = urlObject.params.filter((d) => d.indexOf('access_token') === -1);\n        urlObject.params.push(`access_token=${accessToken}`);\n        return formatUrl(urlObject);\n    }\n}\n\nfunction isMapboxURL(url: string) {\n    return url.indexOf('mapbox:') === 0;\n}\n\nconst mapboxHTTPURLRe = /^((https?:)?\\/\\/)?([^\\/]+\\.)?mapbox\\.c(n|om)(\\/|\\?|$)/i;\nfunction isMapboxHTTPURL(url: string): boolean {\n    return mapboxHTTPURLRe.test(url);\n}\n\nfunction hasCacheDefeatingSku(url: string) {\n    return url.indexOf('sku=') > 0 && isMapboxHTTPURL(url);\n}\n\nconst urlRe = /^(\\w+):\\/\\/([^/?]*)(\\/[^?]+)?\\??(.+)?/;\n\nfunction parseUrl(url: string): UrlObject {\n    const parts = url.match(urlRe);\n    if (!parts) {\n        throw new Error('Unable to parse URL object');\n    }\n    return {\n        protocol: parts[1],\n        authority: parts[2],\n        path: parts[3] || '/',\n        params: parts[4] ? parts[4].split('&') : []\n    };\n}\n\nfunction formatUrl(obj: UrlObject): string {\n    const params = obj.params.length ? `?${obj.params.join('&')}` : '';\n    return `${obj.protocol}://${obj.authority}${obj.path}${params}`;\n}\n\nexport {isMapboxURL, isMapboxHTTPURL, hasCacheDefeatingSku};\n\nconst telemEventKey = 'mapbox.eventData';\n\nfunction parseAccessToken(accessToken: ?string) {\n    if (!accessToken) {\n        return null;\n    }\n\n    const parts = accessToken.split('.');\n    if (!parts || parts.length !== 3) {\n        return null;\n    }\n\n    try {\n        const jsonData = JSON.parse(b64DecodeUnicode(parts[1]));\n        return jsonData;\n    } catch (e) {\n        return null;\n    }\n}\n\ntype TelemetryEventType = 'appUserTurnstile' | 'map.load';\n\nclass TelemetryEvent {\n    eventData: any;\n    anonId: ?string;\n    queue: Array<any>;\n    type: TelemetryEventType;\n    pendingRequest: ?Cancelable;\n    _customAccessToken: ?string;\n\n    constructor(type: TelemetryEventType) {\n        this.type = type;\n        this.anonId = null;\n        this.eventData = {};\n        this.queue = [];\n        this.pendingRequest = null;\n    }\n\n    getStorageKey(domain: ?string) {\n        const tokenData = parseAccessToken(config.ACCESS_TOKEN);\n        let u = '';\n        if (tokenData && tokenData['u']) {\n            u = b64EncodeUnicode(tokenData['u']);\n        } else {\n            u = config.ACCESS_TOKEN || '';\n        }\n        return domain ?\n            `${telemEventKey}.${domain}:${u}` :\n            `${telemEventKey}:${u}`;\n    }\n\n    fetchEventData() {\n        const isLocalStorageAvailable = storageAvailable('localStorage');\n        const storageKey = this.getStorageKey();\n        const uuidKey = this.getStorageKey('uuid');\n\n        if (isLocalStorageAvailable) {\n            //Retrieve cached data\n            try {\n                const data = window.localStorage.getItem(storageKey);\n                if (data) {\n                    this.eventData = JSON.parse(data);\n                }\n\n                const uuid = window.localStorage.getItem(uuidKey);\n                if (uuid) this.anonId = uuid;\n            } catch (e) {\n                warnOnce('Unable to read from LocalStorage');\n            }\n        }\n    }\n\n    saveEventData() {\n        const isLocalStorageAvailable = storageAvailable('localStorage');\n        const storageKey =  this.getStorageKey();\n        const uuidKey = this.getStorageKey('uuid');\n        if (isLocalStorageAvailable) {\n            try {\n                window.localStorage.setItem(uuidKey, this.anonId);\n                if (Object.keys(this.eventData).length >= 1) {\n                    window.localStorage.setItem(storageKey, JSON.stringify(this.eventData));\n                }\n            } catch (e) {\n                warnOnce('Unable to write to LocalStorage');\n            }\n        }\n\n    }\n\n    processRequests(_: ?string) {}\n\n    /*\n    * If any event data should be persisted after the POST request, the callback should modify eventData`\n    * to the values that should be saved. For this reason, the callback should be invoked prior to the call\n    * to TelemetryEvent#saveData\n    */\n    postEvent(timestamp: number, additionalPayload: {[string]: any}, callback: (err: ?Error) => void, customAccessToken?: ?string) {\n        if (!config.EVENTS_URL) return;\n        const eventsUrlObject: UrlObject = parseUrl(config.EVENTS_URL);\n        eventsUrlObject.params.push(`access_token=${customAccessToken || config.ACCESS_TOKEN || ''}`);\n\n        const payload: Object = {\n            event: this.type,\n            created: new Date(timestamp).toISOString(),\n            sdkIdentifier: 'mapbox-gl-js',\n            sdkVersion,\n            skuId: SKU_ID,\n            userId: this.anonId\n        };\n\n        const finalPayload = additionalPayload ? extend(payload, additionalPayload) : payload;\n        const request: RequestParameters = {\n            url: formatUrl(eventsUrlObject),\n            headers: {\n                'Content-Type': 'text/plain' //Skip the pre-flight OPTIONS request\n            },\n            body: JSON.stringify([finalPayload])\n        };\n\n        this.pendingRequest = postData(request, (error) => {\n            this.pendingRequest = null;\n            callback(error);\n            this.saveEventData();\n            this.processRequests(customAccessToken);\n        });\n    }\n\n    queueRequest(event: number | {id: number, timestamp: number}, customAccessToken?: ?string) {\n        this.queue.push(event);\n        this.processRequests(customAccessToken);\n    }\n}\n\nexport class MapLoadEvent extends TelemetryEvent {\n    +success: {[number]: boolean};\n    skuToken: string;\n\n    constructor() {\n        super('map.load');\n        this.success = {};\n        this.skuToken = '';\n    }\n\n    postMapLoadEvent(tileUrls: Array<string>, mapId: number, skuToken: string, customAccessToken: string) {\n        //Enabled only when Mapbox Access Token is set and a source uses\n        // mapbox tiles.\n        this.skuToken = skuToken;\n\n        if (config.EVENTS_URL &&\n            customAccessToken || config.ACCESS_TOKEN &&\n            Array.isArray(tileUrls) &&\n            tileUrls.some(url => isMapboxURL(url) || isMapboxHTTPURL(url))) {\n            this.queueRequest({id: mapId, timestamp: Date.now()}, customAccessToken);\n        }\n    }\n\n    processRequests(customAccessToken?: ?string) {\n        if (this.pendingRequest || this.queue.length === 0) return;\n        const {id, timestamp} = this.queue.shift();\n\n        // Only one load event should fire per map\n        if (id && this.success[id]) return;\n\n        if (!this.anonId) {\n            this.fetchEventData();\n        }\n\n        if (!validateUuid(this.anonId)) {\n            this.anonId = uuid();\n        }\n\n        this.postEvent(timestamp, {skuToken: this.skuToken}, (err) => {\n            if (!err) {\n                if (id) this.success[id] = true;\n            }\n        }, customAccessToken);\n    }\n}\n\nexport class TurnstileEvent extends TelemetryEvent {\n    constructor(customAccessToken?: ?string) {\n        super('appUserTurnstile');\n        this._customAccessToken = customAccessToken;\n    }\n\n    postTurnstileEvent(tileUrls: Array<string>, customAccessToken?: ?string) {\n        //Enabled only when Mapbox Access Token is set and a source uses\n        // mapbox tiles.\n        if (config.EVENTS_URL &&\n            config.ACCESS_TOKEN &&\n            Array.isArray(tileUrls) &&\n            tileUrls.some(url => isMapboxURL(url) || isMapboxHTTPURL(url))) {\n            this.queueRequest(Date.now(), customAccessToken);\n        }\n    }\n\n    processRequests(customAccessToken?: ?string) {\n        if (this.pendingRequest || this.queue.length === 0) {\n            return;\n        }\n\n        if (!this.anonId || !this.eventData.lastSuccess || !this.eventData.tokenU) {\n            //Retrieve cached data\n            this.fetchEventData();\n        }\n\n        const tokenData = parseAccessToken(config.ACCESS_TOKEN);\n        const tokenU = tokenData ? tokenData['u'] : config.ACCESS_TOKEN;\n        //Reset event data cache if the access token owner changed.\n        let dueForEvent = tokenU !== this.eventData.tokenU;\n\n        if (!validateUuid(this.anonId)) {\n            this.anonId = uuid();\n            dueForEvent = true;\n        }\n\n        const nextUpdate = this.queue.shift();\n        // Record turnstile event once per calendar day.\n        if (this.eventData.lastSuccess) {\n            const lastUpdate = new Date(this.eventData.lastSuccess);\n            const nextDate = new Date(nextUpdate);\n            const daysElapsed = (nextUpdate - this.eventData.lastSuccess) / (24 * 60 * 60 * 1000);\n            dueForEvent = dueForEvent || daysElapsed >= 1 || daysElapsed < -1 || lastUpdate.getDate() !== nextDate.getDate();\n        } else {\n            dueForEvent = true;\n        }\n\n        if (!dueForEvent) {\n            return this.processRequests();\n        }\n\n        this.postEvent(nextUpdate, {\"enabled.telemetry\": false}, (err) => {\n            if (!err) {\n                this.eventData.lastSuccess = nextUpdate;\n                this.eventData.tokenU = tokenU;\n            }\n        }, customAccessToken);\n    }\n}\n\nconst turnstileEvent_ = new TurnstileEvent();\nexport const postTurnstileEvent = turnstileEvent_.postTurnstileEvent.bind(turnstileEvent_);\n\nconst mapLoadEvent_ = new MapLoadEvent();\nexport const postMapLoadEvent = mapLoadEvent_.postMapLoadEvent.bind(mapLoadEvent_);\n\n/***** END WARNING - REMOVAL OR MODIFICATION OF THE\nPRECEDING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******/\n","// @flow\n\n/***** START WARNING - IF YOU USE THIS CODE WITH MAPBOX MAPPING APIS, REMOVAL OR\n* MODIFICATION OF THE FOLLOWING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******\n* The following code is used to access Mapbox's Mapping APIs. Removal or modification\n* of this code when used with Mapbox's Mapping APIs can result in higher fees and/or\n* termination of your account with Mapbox.\n*\n* Under the Mapbox Terms of Service, you may not use this code to access Mapbox\n* Mapping APIs other than through Mapbox SDKs.\n*\n* The Mapping APIs documentation is available at https://docs.mapbox.com/api/maps/#maps\n* and the Mapbox Terms of Service are available at https://www.mapbox.com/tos/\n******************************************************************************/\n\ntype SkuTokenObject = {|\n    token: string,\n    tokenExpiresAt: number\n|};\n\nconst SKU_ID = '01';\n\nfunction createSkuToken(): SkuTokenObject {\n    // SKU_ID and TOKEN_VERSION are specified by an internal schema and should not change\n    const TOKEN_VERSION = '1';\n    const base62chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n    // sessionRandomizer is a randomized 10-digit base-62 number\n    let sessionRandomizer = '';\n    for (let i = 0; i < 10; i++) {\n        sessionRandomizer += base62chars[Math.floor(Math.random() * 62)];\n    }\n    const expiration = 12 * 60 * 60 * 1000; // 12 hours\n    const token = [TOKEN_VERSION, SKU_ID, sessionRandomizer].join('');\n    const tokenExpiresAt = Date.now() + expiration;\n\n    return {token, tokenExpiresAt};\n}\n\nexport {createSkuToken, SKU_ID};\n\n/***** END WARNING - REMOVAL OR MODIFICATION OF THE\nPRECEDING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******/\n","// @flow\n\nimport {warnOnce, parseCacheControl} from './util';\nimport window from './window';\n\nimport type Dispatcher from './dispatcher';\n\nconst CACHE_NAME = 'mapbox-tiles';\nlet cacheLimit = 500; // 50MB / (100KB/tile) ~= 500 tiles\nlet cacheCheckThreshold = 50;\n\nconst MIN_TIME_UNTIL_EXPIRY = 1000 * 60 * 7; // 7 minutes. Skip caching tiles with a short enough max age.\n\nexport type ResponseOptions = {\n    status: number,\n    statusText: string,\n    headers: window.Headers\n};\n\nlet responseConstructorSupportsReadableStream;\nfunction prepareBody(response: Response, callback) {\n    if (responseConstructorSupportsReadableStream === undefined) {\n        try {\n            new Response(new ReadableStream()); // eslint-disable-line no-undef\n            responseConstructorSupportsReadableStream = true;\n        } catch (e) {\n            // Edge\n            responseConstructorSupportsReadableStream = false;\n        }\n    }\n\n    if (responseConstructorSupportsReadableStream) {\n        callback(response.body);\n    } else {\n        response.blob().then(callback);\n    }\n}\n\nexport function cachePut(request: Request, response: Response, requestTime: number) {\n    if (!window.caches) return;\n\n    const options: ResponseOptions = {\n        status: response.status,\n        statusText: response.statusText,\n        headers: new window.Headers()\n    };\n    response.headers.forEach((v, k) => options.headers.set(k, v));\n\n    const cacheControl = parseCacheControl(response.headers.get('Cache-Control') || '');\n    if (cacheControl['no-store']) {\n        return;\n    }\n    if (cacheControl['max-age']) {\n        options.headers.set('Expires', new Date(requestTime + cacheControl['max-age'] * 1000).toUTCString());\n    }\n\n    const timeUntilExpiry = new Date(options.headers.get('Expires')).getTime() - requestTime;\n    if (timeUntilExpiry < MIN_TIME_UNTIL_EXPIRY) return;\n\n    prepareBody(response, body => {\n        const clonedResponse = new window.Response(body, options);\n\n        window.caches.open(CACHE_NAME)\n            .then(cache => cache.put(stripQueryParameters(request.url), clonedResponse))\n            .catch(e => warnOnce(e.message));\n    });\n}\n\nfunction stripQueryParameters(url: string) {\n    const start = url.indexOf('?');\n    return start < 0 ? url : url.slice(0, start);\n}\n\nexport function cacheGet(request: Request, callback: (error: ?any, response: ?Response, fresh: ?boolean) => void) {\n    if (!window.caches) return callback(null);\n\n    const strippedURL = stripQueryParameters(request.url);\n\n    window.caches.open(CACHE_NAME)\n        .then(cache => {\n            // manually strip URL instead of `ignoreSearch: true` because of a known\n            // performance issue in Chrome https://github.com/mapbox/mapbox-gl-js/issues/8431\n            cache.match(strippedURL)\n                .catch(callback)\n                .then(response => {\n                    const fresh = isFresh(response);\n\n                    // Reinsert into cache so that order of keys in the cache is the order of access.\n                    // This line makes the cache a LRU instead of a FIFO cache.\n                    cache.delete(strippedURL);\n                    if (fresh) {\n                        cache.put(strippedURL, response.clone());\n                    }\n\n                    callback(null, response, fresh);\n                });\n        })\n        .catch(callback);\n\n}\n\nfunction isFresh(response) {\n    if (!response) return false;\n    const expires = new Date(response.headers.get('Expires'));\n    const cacheControl = parseCacheControl(response.headers.get('Cache-Control') || '');\n    return expires > Date.now() && !cacheControl['no-cache'];\n}\n\n// `Infinity` triggers a cache check after the first tile is loaded\n// so that a check is run at least once on each page load.\nlet globalEntryCounter = Infinity;\n\n// The cache check gets run on a worker. The reason for this is that\n// profiling sometimes shows this as taking up significant time on the\n// thread it gets called from. And sometimes it doesn't. It *may* be\n// fine to run this on the main thread but out of caution this is being\n// dispatched on a worker. This can be investigated further in the future.\nexport function cacheEntryPossiblyAdded(dispatcher: Dispatcher) {\n    globalEntryCounter++;\n    if (globalEntryCounter > cacheCheckThreshold) {\n        dispatcher.getActor().send('enforceCacheSizeLimit', cacheLimit);\n        globalEntryCounter = 0;\n    }\n}\n\n// runs on worker, see above comment\nexport function enforceCacheSizeLimit(limit: number) {\n    if (!window.caches) return;\n    window.caches.open(CACHE_NAME)\n        .then(cache => {\n            cache.keys().then(keys => {\n                for (let i = 0; i < keys.length - limit; i++) {\n                    cache.delete(keys[i]);\n                }\n            });\n        });\n}\n\nexport function clearTileCache(callback?: (err: ?Error) => void) {\n    const promise = window.caches.delete(CACHE_NAME);\n    if (callback) {\n        promise.catch(callback).then(() => callback());\n    }\n}\n\nexport function setCacheLimits(limit: number, checkThreshold: number) {\n    cacheLimit = limit;\n    cacheCheckThreshold = checkThreshold;\n}\n","// @flow\n\nimport window from './window';\nimport {extend, warnOnce} from './util';\nimport {isMapboxHTTPURL, hasCacheDefeatingSku} from './mapbox';\nimport config from './config';\nimport assert from 'assert';\nimport {cacheGet, cachePut} from './tile_request_cache';\n\nimport type {Callback} from '../types/callback';\nimport type {Cancelable} from '../types/cancelable';\n\n/**\n * The type of a resource.\n * @private\n * @readonly\n * @enum {string}\n */\nconst ResourceType = {\n    Unknown: 'Unknown',\n    Style: 'Style',\n    Source: 'Source',\n    Tile: 'Tile',\n    Glyphs: 'Glyphs',\n    SpriteImage: 'SpriteImage',\n    SpriteJSON: 'SpriteJSON',\n    Image: 'Image'\n};\nexport {ResourceType};\n\nif (typeof Object.freeze == 'function') {\n    Object.freeze(ResourceType);\n}\n\n/**\n * A `RequestParameters` object to be returned from Map.options.transformRequest callbacks.\n * @typedef {Object} RequestParameters\n * @property {string} url The URL to be requested.\n * @property {Object} headers The headers to be sent with the request.\n * @property {string} credentials `'same-origin'|'include'` Use 'include' to send cookies with cross-origin requests.\n */\nexport type RequestParameters = {\n    url: string,\n    headers?: Object,\n    method?: 'GET' | 'POST' | 'PUT',\n    body?: string,\n    type?: 'string' | 'json' | 'arrayBuffer',\n    credentials?: 'same-origin' | 'include',\n    collectResourceTiming?: boolean\n};\n\nexport type ResponseCallback<T> = (error: ?Error, data: ?T, cacheControl: ?string, expires: ?string) => void;\n\nclass AJAXError extends Error {\n    status: number;\n    url: string;\n    constructor(message: string, status: number, url: string) {\n        if (status === 401 && isMapboxHTTPURL(url)) {\n            message += ': you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes';\n        }\n        super(message);\n        this.status = status;\n        this.url = url;\n\n        // work around for https://github.com/Rich-Harris/buble/issues/40\n        this.name = this.constructor.name;\n        this.message = message;\n    }\n\n    toString() {\n        return `${this.name}: ${this.message} (${this.status}): ${this.url}`;\n    }\n}\n\nfunction isWorker() {\n    return typeof WorkerGlobalScope !== 'undefined' && typeof self !== 'undefined' &&\n           self instanceof WorkerGlobalScope;\n}\n\n// Ensure that we're sending the correct referrer from blob URL worker bundles.\n// For files loaded from the local file system, `location.origin` will be set\n// to the string(!) \"null\" (Firefox), or \"file://\" (Chrome, Safari, Edge, IE),\n// and we will set an empty referrer. Otherwise, we're using the document's URL.\n/* global self, WorkerGlobalScope */\nexport const getReferrer = isWorker() ?\n    () => self.worker && self.worker.referrer :\n    () => (window.location.protocol === 'blob:' ? window.parent : window).location.href;\n\n// Determines whether a URL is a file:// URL. This is obviously the case if it begins\n// with file://. Relative URLs are also file:// URLs iff the original document was loaded\n// via a file:// URL.\nconst isFileURL = url => /^file:/.test(url) || (/^file:/.test(getReferrer()) && !/^\\w+:/.test(url));\n\nfunction makeFetchRequest(requestParameters: RequestParameters, callback: ResponseCallback<any>): Cancelable {\n    const controller = new window.AbortController();\n    const request = new window.Request(requestParameters.url, {\n        method: requestParameters.method || 'GET',\n        body: requestParameters.body,\n        credentials: requestParameters.credentials,\n        headers: requestParameters.headers,\n        referrer: getReferrer(),\n        signal: controller.signal\n    });\n    let complete = false;\n    let aborted = false;\n\n    const cacheIgnoringSearch = hasCacheDefeatingSku(request.url);\n\n    if (requestParameters.type === 'json') {\n        request.headers.set('Accept', 'application/json');\n    }\n\n    const validateOrFetch = (err, cachedResponse, responseIsFresh) => {\n        if (aborted) return;\n\n        if (err) {\n            // Do fetch in case of cache error.\n            // HTTP pages in Edge trigger a security error that can be ignored.\n            if (err.message !== 'SecurityError') {\n                warnOnce(err);\n            }\n        }\n\n        if (cachedResponse && responseIsFresh) {\n            return finishRequest(cachedResponse);\n        }\n\n        if (cachedResponse) {\n            // We can't do revalidation with 'If-None-Match' because then the\n            // request doesn't have simple cors headers.\n        }\n\n        const requestTime = Date.now();\n\n        window.fetch(request).then(response => {\n            if (response.ok) {\n                const cacheableResponse = cacheIgnoringSearch ? response.clone() : null;\n                return finishRequest(response, cacheableResponse, requestTime);\n\n            } else {\n                return callback(new AJAXError(response.statusText, response.status, requestParameters.url));\n            }\n        }).catch(error => {\n            if (error.code === 20) {\n                // silence expected AbortError\n                return;\n            }\n            callback(new Error(error.message));\n        });\n    };\n\n    const finishRequest = (response, cacheableResponse, requestTime) => {\n        (\n            requestParameters.type === 'arrayBuffer' ? response.arrayBuffer() :\n            requestParameters.type === 'json' ? response.json() :\n            response.text()\n        ).then(result => {\n            if (aborted) return;\n            if (cacheableResponse && requestTime) {\n                // The response needs to be inserted into the cache after it has completely loaded.\n                // Until it is fully loaded there is a chance it will be aborted. Aborting while\n                // reading the body can cause the cache insertion to error. We could catch this error\n                // in most browsers but in Firefox it seems to sometimes crash the tab. Adding\n                // it to the cache here avoids that error.\n                cachePut(request, cacheableResponse, requestTime);\n            }\n            complete = true;\n            callback(null, result, response.headers.get('Cache-Control'), response.headers.get('Expires'));\n        }).catch(err => callback(new Error(err.message)));\n    };\n\n    if (cacheIgnoringSearch) {\n        cacheGet(request, validateOrFetch);\n    } else {\n        validateOrFetch(null, null);\n    }\n\n    return {cancel: () => {\n        aborted = true;\n        if (!complete) controller.abort();\n    }};\n}\n\nfunction makeXMLHttpRequest(requestParameters: RequestParameters, callback: ResponseCallback<any>): Cancelable {\n    const xhr: XMLHttpRequest = new window.XMLHttpRequest();\n\n    xhr.open(requestParameters.method || 'GET', requestParameters.url, true);\n    if (requestParameters.type === 'arrayBuffer') {\n        xhr.responseType = 'arraybuffer';\n    }\n    for (const k in requestParameters.headers) {\n        xhr.setRequestHeader(k, requestParameters.headers[k]);\n    }\n    if (requestParameters.type === 'json') {\n        xhr.responseType = 'text';\n        xhr.setRequestHeader('Accept', 'application/json');\n    }\n    xhr.withCredentials = requestParameters.credentials === 'include';\n    xhr.onerror = () => {\n        callback(new Error(xhr.statusText));\n    };\n    xhr.onload = () => {\n        if (((xhr.status >= 200 && xhr.status < 300) || xhr.status === 0) && xhr.response !== null) {\n            let data: mixed = xhr.response;\n            if (requestParameters.type === 'json') {\n                // We're manually parsing JSON here to get better error messages.\n                try {\n                    data = JSON.parse(xhr.response);\n                } catch (err) {\n                    return callback(err);\n                }\n            }\n            callback(null, data, xhr.getResponseHeader('Cache-Control'), xhr.getResponseHeader('Expires'));\n        } else {\n            callback(new AJAXError(xhr.statusText, xhr.status, requestParameters.url));\n        }\n    };\n    xhr.send(requestParameters.body);\n    return {cancel: () => xhr.abort()};\n}\n\nexport const makeRequest = function(requestParameters: RequestParameters, callback: ResponseCallback<any>): Cancelable {\n    // We're trying to use the Fetch API if possible. However, in some situations we can't use it:\n    // - IE11 doesn't support it at all. In this case, we dispatch the request to the main thread so\n    //   that we can get an accruate referrer header.\n    // - Safari exposes window.AbortController, but it doesn't work actually abort any requests in\n    //   some versions (see https://bugs.webkit.org/show_bug.cgi?id=174980#c2)\n    // - Requests for resources with the file:// URI scheme don't work with the Fetch API either. In\n    //   this case we unconditionally use XHR on the current thread since referrers don't matter.\n    if (!isFileURL(requestParameters.url)) {\n        if (window.fetch && window.Request && window.AbortController && window.Request.prototype.hasOwnProperty('signal')) {\n            return makeFetchRequest(requestParameters, callback);\n        }\n        if (isWorker() && self.worker && self.worker.actor) {\n            return self.worker.actor.send('getResource', requestParameters, callback);\n        }\n    }\n    return makeXMLHttpRequest(requestParameters, callback);\n};\n\nexport const getJSON = function(requestParameters: RequestParameters, callback: ResponseCallback<Object>): Cancelable {\n    return makeRequest(extend(requestParameters, {type: 'json'}), callback);\n};\n\nexport const getArrayBuffer = function(requestParameters: RequestParameters, callback: ResponseCallback<ArrayBuffer>): Cancelable {\n    return makeRequest(extend(requestParameters, {type: 'arrayBuffer'}), callback);\n};\n\nexport const postData = function(requestParameters: RequestParameters, callback: ResponseCallback<string>): Cancelable {\n    return makeRequest(extend(requestParameters, {method: 'POST'}), callback);\n};\n\nfunction sameOrigin(url) {\n    const a: HTMLAnchorElement = window.document.createElement('a');\n    a.href = url;\n    return a.protocol === window.document.location.protocol && a.host === window.document.location.host;\n}\n\nconst transparentPngUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\n\nlet imageQueue, numImageRequests;\nexport const resetImageRequestQueue = () => {\n    imageQueue = [];\n    numImageRequests = 0;\n};\nresetImageRequestQueue();\n\nexport const getImage = function(requestParameters: RequestParameters, callback: Callback<HTMLImageElement>): Cancelable {\n    // limit concurrent image loads to help with raster sources performance on big screens\n    if (numImageRequests >= config.MAX_PARALLEL_IMAGE_REQUESTS) {\n        const queued = {\n            requestParameters,\n            callback,\n            cancelled: false,\n            cancel() { this.cancelled = true; }\n        };\n        imageQueue.push(queued);\n        return queued;\n    }\n    numImageRequests++;\n\n    let advanced = false;\n    const advanceImageRequestQueue = () => {\n        if (advanced) return;\n        advanced = true;\n        numImageRequests--;\n        assert(numImageRequests >= 0);\n        while (imageQueue.length && numImageRequests < config.MAX_PARALLEL_IMAGE_REQUESTS) { // eslint-disable-line\n            const request = imageQueue.shift();\n            const {requestParameters, callback, cancelled} = request;\n            if (!cancelled) {\n                request.cancel = getImage(requestParameters, callback).cancel;\n            }\n        }\n    };\n\n    // request the image with XHR to work around caching issues\n    // see https://github.com/mapbox/mapbox-gl-js/issues/1470\n    const request = getArrayBuffer(requestParameters, (err: ?Error, data: ?ArrayBuffer, cacheControl: ?string, expires: ?string) => {\n\n        advanceImageRequestQueue();\n\n        if (err) {\n            callback(err);\n        } else if (data) {\n            const img: HTMLImageElement = new window.Image();\n            const URL = window.URL || window.webkitURL;\n            img.onload = () => {\n                callback(null, img);\n                URL.revokeObjectURL(img.src);\n            };\n            img.onerror = () => callback(new Error('Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.'));\n            const blob: Blob = new window.Blob([new Uint8Array(data)], {type: 'image/png'});\n            (img: any).cacheControl = cacheControl;\n            (img: any).expires = expires;\n            img.src = data.byteLength ? URL.createObjectURL(blob) : transparentPngUrl;\n        }\n    });\n\n    return {\n        cancel: () => {\n            request.cancel();\n            advanceImageRequestQueue();\n        }\n    };\n};\n\nexport const getVideo = function(urls: Array<string>, callback: Callback<HTMLVideoElement>): Cancelable {\n    const video: HTMLVideoElement = window.document.createElement('video');\n    video.muted = true;\n    video.onloadstart = function() {\n        callback(null, video);\n    };\n    for (let i = 0; i < urls.length; i++) {\n        const s: HTMLSourceElement = window.document.createElement('source');\n        if (!sameOrigin(urls[i])) {\n            video.crossOrigin = 'Anonymous';\n        }\n        s.src = urls[i];\n        video.appendChild(s);\n    }\n    return {cancel: () => {}};\n};\n","// @flow\n\nimport {extend} from './util';\n\ntype Listener = (Object) => any;\ntype Listeners = { [string]: Array<Listener> };\n\nfunction _addEventListener(type: string, listener: Listener, listenerList: Listeners) {\n    const listenerExists = listenerList[type] && listenerList[type].indexOf(listener) !== -1;\n    if (!listenerExists) {\n        listenerList[type] = listenerList[type] || [];\n        listenerList[type].push(listener);\n    }\n}\n\nfunction _removeEventListener(type: string, listener: Listener, listenerList: Listeners) {\n    if (listenerList && listenerList[type]) {\n        const index = listenerList[type].indexOf(listener);\n        if (index !== -1) {\n            listenerList[type].splice(index, 1);\n        }\n    }\n}\n\nexport class Event {\n    +type: string;\n\n    constructor(type: string, data: Object = {}) {\n        extend(this, data);\n        this.type = type;\n    }\n}\n\nexport class ErrorEvent extends Event {\n    error: Error;\n\n    constructor(error: Error, data: Object = {}) {\n        super('error', extend({error}, data));\n    }\n}\n\n/**\n * Methods mixed in to other classes for event capabilities.\n *\n * @mixin Evented\n */\nexport class Evented {\n    _listeners: Listeners;\n    _oneTimeListeners: Listeners;\n    _eventedParent: ?Evented;\n    _eventedParentData: ?(Object | () => Object);\n\n    /**\n     * Adds a listener to a specified event type.\n     *\n     * @param {string} type The event type to add a listen for.\n     * @param {Function} listener The function to be called when the event is fired.\n     *   The listener function is called with the data object passed to `fire`,\n     *   extended with `target` and `type` properties.\n     * @returns {Object} `this`\n     */\n    on(type: *, listener: Listener): this {\n        this._listeners = this._listeners || {};\n        _addEventListener(type, listener, this._listeners);\n\n        return this;\n    }\n\n    /**\n     * Removes a previously registered event listener.\n     *\n     * @param {string} type The event type to remove listeners for.\n     * @param {Function} listener The listener function to remove.\n     * @returns {Object} `this`\n     */\n    off(type: *, listener: Listener) {\n        _removeEventListener(type, listener, this._listeners);\n        _removeEventListener(type, listener, this._oneTimeListeners);\n\n        return this;\n    }\n\n    /**\n     * Adds a listener that will be called only once to a specified event type.\n     *\n     * The listener will be called first time the event fires after the listener is registered.\n     *\n     * @param {string} type The event type to listen for.\n     * @param {Function} listener The function to be called when the event is fired the first time.\n     * @returns {Object} `this`\n     */\n    once(type: string, listener: Listener) {\n        this._oneTimeListeners = this._oneTimeListeners || {};\n        _addEventListener(type, listener, this._oneTimeListeners);\n\n        return this;\n    }\n\n    fire(event: Event, properties?: Object) {\n        // Compatibility with (type: string, properties: Object) signature from previous versions.\n        // See https://github.com/mapbox/mapbox-gl-js/issues/6522,\n        //     https://github.com/mapbox/mapbox-gl-draw/issues/766\n        if (typeof event === 'string') {\n            event = new Event(event, properties || {});\n        }\n\n        const type = event.type;\n\n        if (this.listens(type)) {\n            (event: any).target = this;\n\n            // make sure adding or removing listeners inside other listeners won't cause an infinite loop\n            const listeners = this._listeners && this._listeners[type] ? this._listeners[type].slice() : [];\n            for (const listener of listeners) {\n                listener.call(this, event);\n            }\n\n            const oneTimeListeners = this._oneTimeListeners && this._oneTimeListeners[type] ? this._oneTimeListeners[type].slice() : [];\n            for (const listener of oneTimeListeners) {\n                _removeEventListener(type, listener, this._oneTimeListeners);\n                listener.call(this, event);\n            }\n\n            const parent = this._eventedParent;\n            if (parent) {\n                extend(\n                    event,\n                    typeof this._eventedParentData === 'function' ? this._eventedParentData() : this._eventedParentData\n                );\n                parent.fire(event);\n            }\n\n        // To ensure that no error events are dropped, print them to the\n        // console if they have no listeners.\n        } else if (event instanceof ErrorEvent) {\n            console.error(event.error);\n        }\n\n        return this;\n    }\n\n    /**\n     * Returns a true if this instance of Evented or any forwardeed instances of Evented have a listener for the specified type.\n     *\n     * @param {string} type The event type\n     * @returns {boolean} `true` if there is at least one registered listener for specified event type, `false` otherwise\n     * @private\n     */\n    listens(type: string) {\n        return (\n            (this._listeners && this._listeners[type] && this._listeners[type].length > 0) ||\n            (this._oneTimeListeners && this._oneTimeListeners[type] && this._oneTimeListeners[type].length > 0) ||\n            (this._eventedParent && this._eventedParent.listens(type))\n        );\n    }\n\n    /**\n     * Bubble all events fired by this instance of Evented to this parent instance of Evented.\n     *\n     * @private\n     * @returns {Object} `this`\n     * @private\n     */\n    setEventedParent(parent: ?Evented, data?: Object | () => Object) {\n        this._eventedParent = parent;\n        this._eventedParentData = data;\n\n        return this;\n    }\n}\n","var SphericalMercator = (function(){\n\n// Closures including constants and other precalculated values.\nvar cache = {},\n    EPSLN = 1.0e-10,\n    D2R = Math.PI / 180,\n    R2D = 180 / Math.PI,\n    // 900913 properties.\n    A = 6378137.0,\n    MAXEXTENT = 20037508.342789244;\n\nfunction isFloat(n){\n    return Number(n) === n && n % 1 !== 0;\n}\n\n// SphericalMercator constructor: precaches calculations\n// for fast tile lookups.\nfunction SphericalMercator(options) {\n    options = options || {};\n    this.size = options.size || 256;\n    if (!cache[this.size]) {\n        var size = this.size;\n        var c = cache[this.size] = {};\n        c.Bc = [];\n        c.Cc = [];\n        c.zc = [];\n        c.Ac = [];\n        for (var d = 0; d < 30; d++) {\n            c.Bc.push(size / 360);\n            c.Cc.push(size / (2 * Math.PI));\n            c.zc.push(size / 2);\n            c.Ac.push(size);\n            size *= 2;\n        }\n    }\n    this.Bc = cache[this.size].Bc;\n    this.Cc = cache[this.size].Cc;\n    this.zc = cache[this.size].zc;\n    this.Ac = cache[this.size].Ac;\n};\n\n// Convert lon lat to screen pixel value\n//\n// - `ll` {Array} `[lon, lat]` array of geographic coordinates.\n// - `zoom` {Number} zoom level.\nSphericalMercator.prototype.px = function(ll, zoom) {\n  if (isFloat(zoom)) {\n    var size = this.size * Math.pow(2, zoom);\n    var d = size / 2;\n    var bc = (size / 360);\n    var cc = (size / (2 * Math.PI));\n    var ac = size;\n    var f = Math.min(Math.max(Math.sin(D2R * ll[1]), -0.9999), 0.9999);\n    var x = d + ll[0] * bc;\n    var y = d + 0.5 * Math.log((1 + f) / (1 - f)) * -cc;\n    (x > ac) && (x = ac);\n    (y > ac) && (y = ac);\n    //(x < 0) && (x = 0);\n    //(y < 0) && (y = 0);\n    return [x, y];\n  } else {\n    var d = this.zc[zoom];\n    var f = Math.min(Math.max(Math.sin(D2R * ll[1]), -0.9999), 0.9999);\n    var x = Math.round(d + ll[0] * this.Bc[zoom]);\n    var y = Math.round(d + 0.5 * Math.log((1 + f) / (1 - f)) * (-this.Cc[zoom]));\n    (x > this.Ac[zoom]) && (x = this.Ac[zoom]);\n    (y > this.Ac[zoom]) && (y = this.Ac[zoom]);\n    //(x < 0) && (x = 0);\n    //(y < 0) && (y = 0);\n    return [x, y];\n  }\n};\n\n// Convert screen pixel value to lon lat\n//\n// - `px` {Array} `[x, y]` array of geographic coordinates.\n// - `zoom` {Number} zoom level.\nSphericalMercator.prototype.ll = function(px, zoom) {\n  if (isFloat(zoom)) {\n    var size = this.size * Math.pow(2, zoom);\n    var bc = (size / 360);\n    var cc = (size / (2 * Math.PI));\n    var zc = size / 2;\n    var g = (px[1] - zc) / -cc;\n    var lon = (px[0] - zc) / bc;\n    var lat = R2D * (2 * Math.atan(Math.exp(g)) - 0.5 * Math.PI);\n    return [lon, lat];\n  } else {\n    var g = (px[1] - this.zc[zoom]) / (-this.Cc[zoom]);\n    var lon = (px[0] - this.zc[zoom]) / this.Bc[zoom];\n    var lat = R2D * (2 * Math.atan(Math.exp(g)) - 0.5 * Math.PI);\n    return [lon, lat];\n  }\n};\n\n// Convert tile xyz value to bbox of the form `[w, s, e, n]`\n//\n// - `x` {Number} x (longitude) number.\n// - `y` {Number} y (latitude) number.\n// - `zoom` {Number} zoom.\n// - `tms_style` {Boolean} whether to compute using tms-style.\n// - `srs` {String} projection for resulting bbox (WGS84|900913).\n// - `return` {Array} bbox array of values in form `[w, s, e, n]`.\nSphericalMercator.prototype.bbox = function(x, y, zoom, tms_style, srs) {\n    // Convert xyz into bbox with srs WGS84\n    if (tms_style) {\n        y = (Math.pow(2, zoom) - 1) - y;\n    }\n    // Use +y to make sure it's a number to avoid inadvertent concatenation.\n    var ll = [x * this.size, (+y + 1) * this.size]; // lower left\n    // Use +x to make sure it's a number to avoid inadvertent concatenation.\n    var ur = [(+x + 1) * this.size, y * this.size]; // upper right\n    var bbox = this.ll(ll, zoom).concat(this.ll(ur, zoom));\n\n    // If web mercator requested reproject to 900913.\n    if (srs === '900913') {\n        return this.convert(bbox, '900913');\n    } else {\n        return bbox;\n    }\n};\n\n// Convert bbox to xyx bounds\n//\n// - `bbox` {Number} bbox in the form `[w, s, e, n]`.\n// - `zoom` {Number} zoom.\n// - `tms_style` {Boolean} whether to compute using tms-style.\n// - `srs` {String} projection of input bbox (WGS84|900913).\n// - `@return` {Object} XYZ bounds containing minX, maxX, minY, maxY properties.\nSphericalMercator.prototype.xyz = function(bbox, zoom, tms_style, srs) {\n    // If web mercator provided reproject to WGS84.\n    if (srs === '900913') {\n        bbox = this.convert(bbox, 'WGS84');\n    }\n\n    var ll = [bbox[0], bbox[1]]; // lower left\n    var ur = [bbox[2], bbox[3]]; // upper right\n    var px_ll = this.px(ll, zoom);\n    var px_ur = this.px(ur, zoom);\n    // Y = 0 for XYZ is the top hence minY uses px_ur[1].\n    var x = [ Math.floor(px_ll[0] / this.size), Math.floor((px_ur[0] - 1) / this.size) ];\n    var y = [ Math.floor(px_ur[1] / this.size), Math.floor((px_ll[1] - 1) / this.size) ];\n    var bounds = {\n        minX: Math.min.apply(Math, x) < 0 ? 0 : Math.min.apply(Math, x),\n        minY: Math.min.apply(Math, y) < 0 ? 0 : Math.min.apply(Math, y),\n        maxX: Math.max.apply(Math, x),\n        maxY: Math.max.apply(Math, y)\n    };\n    if (tms_style) {\n        var tms = {\n            minY: (Math.pow(2, zoom) - 1) - bounds.maxY,\n            maxY: (Math.pow(2, zoom) - 1) - bounds.minY\n        };\n        bounds.minY = tms.minY;\n        bounds.maxY = tms.maxY;\n    }\n    return bounds;\n};\n\n// Convert projection of given bbox.\n//\n// - `bbox` {Number} bbox in the form `[w, s, e, n]`.\n// - `to` {String} projection of output bbox (WGS84|900913). Input bbox\n//   assumed to be the \"other\" projection.\n// - `@return` {Object} bbox with reprojected coordinates.\nSphericalMercator.prototype.convert = function(bbox, to) {\n    if (to === '900913') {\n        return this.forward(bbox.slice(0, 2)).concat(this.forward(bbox.slice(2,4)));\n    } else {\n        return this.inverse(bbox.slice(0, 2)).concat(this.inverse(bbox.slice(2,4)));\n    }\n};\n\n// Convert lon/lat values to 900913 x/y.\nSphericalMercator.prototype.forward = function(ll) {\n    var xy = [\n        A * ll[0] * D2R,\n        A * Math.log(Math.tan((Math.PI*0.25) + (0.5 * ll[1] * D2R)))\n    ];\n    // if xy value is beyond maxextent (e.g. poles), return maxextent.\n    (xy[0] > MAXEXTENT) && (xy[0] = MAXEXTENT);\n    (xy[0] < -MAXEXTENT) && (xy[0] = -MAXEXTENT);\n    (xy[1] > MAXEXTENT) && (xy[1] = MAXEXTENT);\n    (xy[1] < -MAXEXTENT) && (xy[1] = -MAXEXTENT);\n    return xy;\n};\n\n// Convert 900913 x/y values to lon/lat.\nSphericalMercator.prototype.inverse = function(xy) {\n    return [\n        (xy[0] * R2D / A),\n        ((Math.PI*0.5) - 2.0 * Math.atan(Math.exp(-xy[1] / A))) * R2D\n    ];\n};\n\nreturn SphericalMercator;\n\n})();\n\nif (typeof module !== 'undefined' && typeof exports !== 'undefined') {\n    module.exports = exports = SphericalMercator;\n}\n","import { pick } from 'mapbox-gl/src/util/util';\nimport { getJSON } from 'mapbox-gl/src/util/ajax';\nimport browser from 'mapbox-gl/src/util/browser';\nimport SphericalMercator from '@mapbox/sphericalmercator';\n\n//Contains code from esri-leaflet https://github.com/Esri/esri-leaflet\nconst MercatorZoomLevels = {\n    '0': 156543.03392799999,\n    '1': 78271.516963999893,\n    '2': 39135.758482000099,\n    '3': 19567.879240999901,\n    '4': 9783.9396204999593,\n    '5': 4891.9698102499797,\n    '6': 2445.9849051249898,\n    '7': 1222.9924525624899,\n    '8': 611.49622628138002,\n    '9': 305.74811314055802,\n    '10': 152.874056570411,\n    '11': 76.437028285073197,\n    '12': 38.218514142536598,\n    '13': 19.109257071268299,\n    '14': 9.5546285356341496,\n    '15': 4.7773142679493699,\n    '16': 2.38865713397468,\n    '17': 1.1943285668550501,\n    '18': 0.59716428355981699,\n    '19': 0.29858214164761698,\n    '20': 0.14929107082381,\n    '21': 0.07464553541191,\n    '22': 0.0373227677059525,\n    '23': 0.0186613838529763\n};\n\nconst _withinPercentage = function (a, b, percentage) {\n    const diff = Math.abs((a / b) - 1);\n    return diff < percentage;\n};\n\nexport default function(options, callback) {\n    const loaded = function(err, metadata) {\n        if (err) {\n            return callback(err);\n        }\n\n        const result = pick(metadata,\n            ['tileInfo', 'initialExtent', 'fullExtent', 'spatialReference', 'tileServers', 'documentInfo']);\n\n        result._lodMap = {};\n        const zoomOffsetAllowance = 0.1;\n        const sr = metadata.spatialReference.latestWkid || metadata.spatialReference.wkid;\n        if (sr === 102100 || sr === 3857) {\n\n            /*\n            Example extent from ArcGIS REST API\n            fullExtent: {\n            xmin: -9144791.679226127,\n            ymin: -2195190.961437726,\n            xmax: -4650987.072019983,\n            ymax: 1118113.110155766,\n            spatialReference: {\n            wkid: 102100,\n            wkt: null\n            }\n            },\n            */\n            //convert ArcGIS extent to bounds\n            const extent = metadata.fullExtent;\n            if (extent && extent.spatialReference && extent.spatialReference.wkid ===  102100) {\n                const boundsWebMercator = [extent.xmin, extent.ymin, extent.xmax, extent.ymax];\n                var merc = new SphericalMercator({\n                    size: 256\n                });\n                const boundsWGS84 = merc.convert(boundsWebMercator);\n                result.bounds = boundsWGS84;\n            }\n\n            // create the zoom level data\n            const arcgisLODs = metadata.tileInfo.lods;\n            const correctResolutions = MercatorZoomLevels;\n            result.minzoom = arcgisLODs[0].level;\n            result.maxzoom = arcgisLODs[arcgisLODs.length - 1].level;\n            for (let i = 0; i < arcgisLODs.length; i++) {\n                const arcgisLOD = arcgisLODs[i];\n                for (const ci in correctResolutions) {\n                    const correctRes = correctResolutions[ci];\n\n                    if (_withinPercentage(arcgisLOD.resolution, correctRes, zoomOffsetAllowance)) {\n                        result._lodMap[ci] = arcgisLOD.level;\n                        break;\n                    }\n                }\n            }\n        } else {\n            callback(new Error('non-mercator spatial reference'));\n        }\n\n        callback(null, result);\n    };\n\n    if (options.url) {\n        getJSON({url: options.url}, loaded);\n    } else {\n        browser.frame(loaded.bind(null, null, options));\n    }\n};\n","// @flow\n\nimport {wrap} from '../util/util';\nimport LngLatBounds from './lng_lat_bounds';\n\n/**\n * A `LngLat` object represents a given longitude and latitude coordinate, measured in degrees.\n *\n * Mapbox GL uses longitude, latitude coordinate order (as opposed to latitude, longitude) to match GeoJSON.\n *\n * Note that any Mapbox GL method that accepts a `LngLat` object as an argument or option\n * can also accept an `Array` of two numbers and will perform an implicit conversion.\n * This flexible type is documented as {@link LngLatLike}.\n *\n * @param {number} lng Longitude, measured in degrees.\n * @param {number} lat Latitude, measured in degrees.\n * @example\n * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n * @see [Get coordinates of the mouse pointer](https://www.mapbox.com/mapbox-gl-js/example/mouse-position/)\n * @see [Display a popup](https://www.mapbox.com/mapbox-gl-js/example/popup/)\n * @see [Highlight features within a bounding box](https://www.mapbox.com/mapbox-gl-js/example/using-box-queryrenderedfeatures/)\n * @see [Create a timeline animation](https://www.mapbox.com/mapbox-gl-js/example/timeline-animation/)\n */\nclass LngLat {\n    lng: number;\n    lat: number;\n\n    constructor(lng: number, lat: number) {\n        if (isNaN(lng) || isNaN(lat)) {\n            throw new Error(`Invalid LngLat object: (${lng}, ${lat})`);\n        }\n        this.lng = +lng;\n        this.lat = +lat;\n        if (this.lat > 90 || this.lat < -90) {\n            throw new Error('Invalid LngLat latitude value: must be between -90 and 90');\n        }\n    }\n\n    /**\n     * Returns a new `LngLat` object whose longitude is wrapped to the range (-180, 180).\n     *\n     * @returns {LngLat} The wrapped `LngLat` object.\n     * @example\n     * var ll = new mapboxgl.LngLat(286.0251, 40.7736);\n     * var wrapped = ll.wrap();\n     * wrapped.lng; // = -73.9749\n     */\n    wrap() {\n        return new LngLat(wrap(this.lng, -180, 180), this.lat);\n    }\n\n    /**\n     * Returns the coordinates represented as an array of two numbers.\n     *\n     * @returns {Array<number>} The coordinates represeted as an array of longitude and latitude.\n     * @example\n     * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n     * ll.toArray(); // = [-73.9749, 40.7736]\n     */\n    toArray() {\n        return [this.lng, this.lat];\n    }\n\n    /**\n     * Returns the coordinates represent as a string.\n     *\n     * @returns {string} The coordinates represented as a string of the format `'LngLat(lng, lat)'`.\n     * @example\n     * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n     * ll.toString(); // = \"LngLat(-73.9749, 40.7736)\"\n     */\n    toString() {\n        return `LngLat(${this.lng}, ${this.lat})`;\n    }\n\n    /**\n     * Returns a `LngLatBounds` from the coordinates extended by a given `radius`.\n     *\n     * @param {number} [radius=0] Distance in meters from the coordinates to extend the bounds.\n     * @returns {LngLatBounds} A new `LngLatBounds` object representing the coordinates extended by the `radius`.\n     * @example\n     * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n     * ll.toBounds(100).toArray(); // = [[-73.97501862141328, 40.77351016847229], [-73.97478137858673, 40.77368983152771]]\n     */\n    toBounds(radius?: number = 0) {\n        const earthCircumferenceInMetersAtEquator = 40075017;\n        const latAccuracy = 360 * radius / earthCircumferenceInMetersAtEquator,\n            lngAccuracy = latAccuracy / Math.cos((Math.PI / 180) * this.lat);\n\n        return new LngLatBounds(new LngLat(this.lng - lngAccuracy, this.lat - latAccuracy),\n            new LngLat(this.lng + lngAccuracy, this.lat + latAccuracy));\n    }\n\n    /**\n     * Converts an array of two numbers or an object with `lng` and `lat` or `lon` and `lat` properties\n     * to a `LngLat` object.\n     *\n     * If a `LngLat` object is passed in, the function returns it unchanged.\n     *\n     * @param {LngLatLike} input An array of two numbers or object to convert, or a `LngLat` object to return.\n     * @returns {LngLat} A new `LngLat` object, if a conversion occurred, or the original `LngLat` object.\n     * @example\n     * var arr = [-73.9749, 40.7736];\n     * var ll = mapboxgl.LngLat.convert(arr);\n     * ll;   // = LngLat {lng: -73.9749, lat: 40.7736}\n     */\n    static convert(input: LngLatLike): LngLat {\n        if (input instanceof LngLat) {\n            return input;\n        }\n        if (Array.isArray(input) && (input.length === 2 || input.length === 3)) {\n            return new LngLat(Number(input[0]), Number(input[1]));\n        }\n        if (!Array.isArray(input) && typeof input === 'object' && input !== null) {\n            return new LngLat(\n                // flow can't refine this to have one of lng or lat, so we have to cast to any\n                Number('lng' in input ? (input: any).lng : (input: any).lon),\n                Number(input.lat)\n            );\n        }\n        throw new Error(\"`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]\");\n    }\n}\n\n/**\n * A {@link LngLat} object, an array of two numbers representing longitude and latitude,\n * or an object with `lng` and `lat` or `lon` and `lat` properties.\n *\n * @typedef {LngLat | {lng: number, lat: number} | {lon: number, lat: number} | [number, number]} LngLatLike\n * @example\n * var v1 = new mapboxgl.LngLat(-122.420679, 37.772537);\n * var v2 = [-122.420679, 37.772537];\n * var v3 = {lon: -122.420679, lat: 37.772537};\n */\nexport type LngLatLike = LngLat | {lng: number, lat: number} | {lon: number, lat: number} | [number, number];\n\nexport default LngLat;\n","// @flow\n\nimport LngLat from './lng_lat';\n\nimport type {LngLatLike} from './lng_lat';\n\n/**\n * A `LngLatBounds` object represents a geographical bounding box,\n * defined by its southwest and northeast points in longitude and latitude.\n *\n * If no arguments are provided to the constructor, a `null` bounding box is created.\n *\n * Note that any Mapbox GL method that accepts a `LngLatBounds` object as an argument or option\n * can also accept an `Array` of two {@link LngLatLike} constructs and will perform an implicit conversion.\n * This flexible type is documented as {@link LngLatBoundsLike}.\n *\n * @param {LngLatLike} [sw] The southwest corner of the bounding box.\n * @param {LngLatLike} [ne] The northeast corner of the bounding box.\n * @example\n * var sw = new mapboxgl.LngLat(-73.9876, 40.7661);\n * var ne = new mapboxgl.LngLat(-73.9397, 40.8002);\n * var llb = new mapboxgl.LngLatBounds(sw, ne);\n */\nclass LngLatBounds {\n    _ne: LngLat;\n    _sw: LngLat;\n\n    // This constructor is too flexible to type. It should not be so flexible.\n    constructor(sw: any, ne: any) {\n        if (!sw) {\n            // noop\n        } else if (ne) {\n            this.setSouthWest(sw).setNorthEast(ne);\n        } else if (sw.length === 4) {\n            this.setSouthWest([sw[0], sw[1]]).setNorthEast([sw[2], sw[3]]);\n        } else {\n            this.setSouthWest(sw[0]).setNorthEast(sw[1]);\n        }\n    }\n\n    /**\n     * Set the northeast corner of the bounding box\n     *\n     * @param {LngLatLike} ne\n     * @returns {LngLatBounds} `this`\n     */\n    setNorthEast(ne: LngLatLike) {\n        this._ne = ne instanceof LngLat ? new LngLat(ne.lng, ne.lat) : LngLat.convert(ne);\n        return this;\n    }\n\n    /**\n     * Set the southwest corner of the bounding box\n     *\n     * @param {LngLatLike} sw\n     * @returns {LngLatBounds} `this`\n     */\n    setSouthWest(sw: LngLatLike) {\n        this._sw = sw instanceof LngLat ? new LngLat(sw.lng, sw.lat) : LngLat.convert(sw);\n        return this;\n    }\n\n    /**\n     * Extend the bounds to include a given LngLat or LngLatBounds.\n     *\n     * @param {LngLat|LngLatBounds} obj object to extend to\n     * @returns {LngLatBounds} `this`\n     */\n    extend(obj: LngLat | LngLatBounds) {\n        const sw = this._sw,\n            ne = this._ne;\n        let sw2, ne2;\n\n        if (obj instanceof LngLat) {\n            sw2 = obj;\n            ne2 = obj;\n\n        } else if (obj instanceof LngLatBounds) {\n            sw2 = obj._sw;\n            ne2 = obj._ne;\n\n            if (!sw2 || !ne2) return this;\n\n        } else {\n            if (Array.isArray(obj)) {\n                if (obj.every(Array.isArray)) {\n                    return this.extend(LngLatBounds.convert(obj));\n                } else {\n                    return this.extend(LngLat.convert(obj));\n                }\n            }\n            return this;\n        }\n\n        if (!sw && !ne) {\n            this._sw = new LngLat(sw2.lng, sw2.lat);\n            this._ne = new LngLat(ne2.lng, ne2.lat);\n\n        } else {\n            sw.lng = Math.min(sw2.lng, sw.lng);\n            sw.lat = Math.min(sw2.lat, sw.lat);\n            ne.lng = Math.max(ne2.lng, ne.lng);\n            ne.lat = Math.max(ne2.lat, ne.lat);\n        }\n\n        return this;\n    }\n\n    /**\n     * Returns the geographical coordinate equidistant from the bounding box's corners.\n     *\n     * @returns {LngLat} The bounding box's center.\n     * @example\n     * var llb = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002]);\n     * llb.getCenter(); // = LngLat {lng: -73.96365, lat: 40.78315}\n     */\n    getCenter(): LngLat {\n        return new LngLat((this._sw.lng + this._ne.lng) / 2, (this._sw.lat + this._ne.lat) / 2);\n    }\n\n    /**\n     * Returns the southwest corner of the bounding box.\n     *\n     * @returns {LngLat} The southwest corner of the bounding box.\n     */\n    getSouthWest(): LngLat { return this._sw; }\n\n    /**\n    * Returns the northeast corner of the bounding box.\n    *\n    * @returns {LngLat} The northeast corner of the bounding box.\n     */\n    getNorthEast(): LngLat { return this._ne; }\n\n    /**\n    * Returns the northwest corner of the bounding box.\n    *\n    * @returns {LngLat} The northwest corner of the bounding box.\n     */\n    getNorthWest(): LngLat { return new LngLat(this.getWest(), this.getNorth()); }\n\n    /**\n    * Returns the southeast corner of the bounding box.\n    *\n    * @returns {LngLat} The southeast corner of the bounding box.\n     */\n    getSouthEast(): LngLat { return new LngLat(this.getEast(), this.getSouth()); }\n\n    /**\n    * Returns the west edge of the bounding box.\n    *\n    * @returns {number} The west edge of the bounding box.\n     */\n    getWest(): number { return this._sw.lng; }\n\n    /**\n    * Returns the south edge of the bounding box.\n    *\n    * @returns {number} The south edge of the bounding box.\n     */\n    getSouth(): number { return this._sw.lat; }\n\n    /**\n    * Returns the east edge of the bounding box.\n    *\n    * @returns {number} The east edge of the bounding box.\n     */\n    getEast(): number { return this._ne.lng; }\n\n    /**\n    * Returns the north edge of the bounding box.\n    *\n    * @returns {number} The north edge of the bounding box.\n     */\n    getNorth(): number { return this._ne.lat; }\n\n    /**\n     * Returns the bounding box represented as an array.\n     *\n     * @returns {Array<Array<number>>} The bounding box represented as an array, consisting of the\n     *   southwest and northeast coordinates of the bounding represented as arrays of numbers.\n     * @example\n     * var llb = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002]);\n     * llb.toArray(); // = [[-73.9876, 40.7661], [-73.9397, 40.8002]]\n     */\n    toArray() {\n        return [this._sw.toArray(), this._ne.toArray()];\n    }\n\n    /**\n     * Return the bounding box represented as a string.\n     *\n     * @returns {string} The bounding box represents as a string of the format\n     *   `'LngLatBounds(LngLat(lng, lat), LngLat(lng, lat))'`.\n     * @example\n     * var llb = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002]);\n     * llb.toString(); // = \"LngLatBounds(LngLat(-73.9876, 40.7661), LngLat(-73.9397, 40.8002))\"\n     */\n    toString() {\n        return `LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`;\n    }\n\n    /**\n     * Check if the bounding box is an empty/`null`-type box.\n     *\n     * @returns {boolean} True if bounds have been defined, otherwise false.\n     */\n    isEmpty() {\n        return !(this._sw && this._ne);\n    }\n\n    /**\n     * Converts an array to a `LngLatBounds` object.\n     *\n     * If a `LngLatBounds` object is passed in, the function returns it unchanged.\n     *\n     * Internally, the function calls `LngLat#convert` to convert arrays to `LngLat` values.\n     *\n     * @param {LngLatBoundsLike} input An array of two coordinates to convert, or a `LngLatBounds` object to return.\n     * @returns {LngLatBounds} A new `LngLatBounds` object, if a conversion occurred, or the original `LngLatBounds` object.\n     * @example\n     * var arr = [[-73.9876, 40.7661], [-73.9397, 40.8002]];\n     * var llb = mapboxgl.LngLatBounds.convert(arr);\n     * llb;   // = LngLatBounds {_sw: LngLat {lng: -73.9876, lat: 40.7661}, _ne: LngLat {lng: -73.9397, lat: 40.8002}}\n     */\n    static convert(input: LngLatBoundsLike): LngLatBounds {\n        if (!input || input instanceof LngLatBounds) return input;\n        return new LngLatBounds(input);\n    }\n}\n\n/**\n * A {@link LngLatBounds} object, an array of {@link LngLatLike} objects in [sw, ne] order,\n * or an array of numbers in [west, south, east, north] order.\n *\n * @typedef {LngLatBounds | [LngLatLike, LngLatLike] | [number, number, number, number]} LngLatBoundsLike\n * @example\n * var v1 = new mapboxgl.LngLatBounds(\n *   new mapboxgl.LngLat(-73.9876, 40.7661),\n *   new mapboxgl.LngLat(-73.9397, 40.8002)\n * );\n * var v2 = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002])\n * var v3 = [[-73.9876, 40.7661], [-73.9397, 40.8002]];\n */\nexport type LngLatBoundsLike = LngLatBounds | [LngLatLike, LngLatLike] | [number, number, number, number];\n\nexport default LngLatBounds;\n","// @flow\n\nimport LngLat from '../geo/lng_lat';\nimport type {LngLatLike} from '../geo/lng_lat';\n\n/*\n * The circumference of the world in meters at the equator.\n */\nconst circumferenceAtEquator = 2 * Math.PI * 6378137;\n\n/*\n * The circumference of the world in meters at the given latitude.\n */\nfunction circumferenceAtLatitude(latitude: number) {\n    return circumferenceAtEquator * Math.cos(latitude * Math.PI / 180);\n}\n\nexport function mercatorXfromLng(lng: number) {\n    return (180 + lng) / 360;\n}\n\nexport function mercatorYfromLat(lat: number) {\n    return (180 - (180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + lat * Math.PI / 360)))) / 360;\n}\n\nexport function mercatorZfromAltitude(altitude: number, lat: number) {\n    return altitude / circumferenceAtLatitude(lat);\n}\n\nexport function lngFromMercatorX(x: number) {\n    return x * 360 - 180;\n}\n\nexport function latFromMercatorY(y: number) {\n    const y2 = 180 - y * 360;\n    return 360 / Math.PI * Math.atan(Math.exp(y2 * Math.PI / 180)) - 90;\n}\n\nexport function altitudeFromMercatorZ(z: number, y: number) {\n    return z * circumferenceAtLatitude(latFromMercatorY(y));\n}\n\n/**\n * Determine the Mercator scale factor for a given latitude, see\n * https://en.wikipedia.org/wiki/Mercator_projection#Scale_factor\n *\n * At the equator the scale factor will be 1, which increases at higher latitudes.\n *\n * @param {number} lat Latitude\n * @returns {number} scale factor\n */\nexport function mercatorScale(lat: number) {\n    return 1 / Math.cos(lat * Math.PI / 180);\n}\n\n/**\n * A `MercatorCoordinate` object represents a projected three dimensional position.\n *\n * `MercatorCoordinate` uses the web mercator projection ([EPSG:3857](https://epsg.io/3857)) with slightly different units:\n * - the size of 1 unit is the width of the projected world instead of the \"mercator meter\"\n * - the origin of the coordinate space is at the north-west corner instead of the middle\n *\n * For example, `MercatorCoordinate(0, 0, 0)` is the north-west corner of the mercator world and\n * `MercatorCoordinate(1, 1, 0)` is the south-east corner. If you are familiar with\n * [vector tiles](https://github.com/mapbox/vector-tile-spec) it may be helpful to think\n * of the coordinate space as the `0/0/0` tile with an extent of `1`.\n *\n * The `z` dimension of `MercatorCoordinate` is conformal. A cube in the mercator coordinate space would be rendered as a cube.\n *\n * @param {number} x The x component of the position.\n * @param {number} y The y component of the position.\n * @param {number} z The z component of the position.\n * @example\n * var nullIsland = new mapboxgl.MercatorCoordinate(0.5, 0.5, 0);\n *\n * @see [Add a custom style layer](https://www.mapbox.com/mapbox-gl-js/example/custom-style-layer/)\n */\nclass MercatorCoordinate {\n    x: number;\n    y: number;\n    z: number;\n\n    constructor(x: number, y: number, z: number = 0) {\n        this.x = +x;\n        this.y = +y;\n        this.z = +z;\n    }\n\n    /**\n     * Project a `LngLat` to a `MercatorCoordinate`.\n     *\n     * @param {LngLatLike} lngLatLike The location to project.\n     * @param {number} altitude The altitude in meters of the position.\n     * @returns {MercatorCoordinate} The projected mercator coordinate.\n     * @example\n     * var coord = mapboxgl.MercatorCoordinate.fromLngLat({ lng: 0, lat: 0}, 0);\n     * coord; // MercatorCoordinate(0.5, 0.5, 0)\n     */\n    static fromLngLat(lngLatLike: LngLatLike, altitude: number = 0) {\n        const lngLat = LngLat.convert(lngLatLike);\n\n        return new MercatorCoordinate(\n                mercatorXfromLng(lngLat.lng),\n                mercatorYfromLat(lngLat.lat),\n                mercatorZfromAltitude(altitude, lngLat.lat));\n    }\n\n    /**\n     * Returns the `LngLat` for the coordinate.\n     *\n     * @returns {LngLat} The `LngLat` object.\n     * @example\n     * var coord = new mapboxgl.MercatorCoordinate(0.5, 0.5, 0);\n     * var latLng = coord.toLngLat(); // LngLat(0, 0)\n     */\n    toLngLat() {\n        return new LngLat(\n                lngFromMercatorX(this.x),\n                latFromMercatorY(this.y));\n    }\n\n    /**\n     * Returns the altitude in meters of the coordinate.\n     *\n     * @returns {number} The altitude in meters.\n     * @example\n     * var coord = new mapboxgl.MercatorCoordinate(0, 0, 0.02);\n     * coord.toAltitude(); // 6914.281956295339\n     */\n    toAltitude() {\n        return altitudeFromMercatorZ(this.z, this.y);\n    }\n\n    /**\n     * Returns the distance of 1 meter in `MercatorCoordinate` units at this latitude.\n     *\n     * For coordinates in real world units using meters, this naturally provides the scale\n     * to transform into `MercatorCoordinate`s.\n     *\n     * @returns {number} Distance of 1 meter in `MercatorCoordinate` units.\n     */\n    meterInMercatorCoordinateUnits() {\n        // 1 meter / circumference at equator in meters * Mercator projection scale factor at this latitude\n        return 1 / circumferenceAtEquator * mercatorScale(latFromMercatorY(this.y));\n    }\n\n}\n\nexport default MercatorCoordinate;\n","// @flow\n\nimport LngLatBounds from '../geo/lng_lat_bounds';\nimport {mercatorXfromLng, mercatorYfromLat} from '../geo/mercator_coordinate';\n\nimport type {CanonicalTileID} from './tile_id';\n\nclass TileBounds {\n    bounds: LngLatBounds;\n    minzoom: number;\n    maxzoom: number;\n\n    constructor(bounds: [number, number, number, number], minzoom: ?number, maxzoom: ?number) {\n        this.bounds = LngLatBounds.convert(this.validateBounds(bounds));\n        this.minzoom = minzoom || 0;\n        this.maxzoom = maxzoom || 24;\n    }\n\n    validateBounds(bounds: [number, number, number, number]) {\n        // make sure the bounds property contains valid longitude and latitudes\n        if (!Array.isArray(bounds) || bounds.length !== 4) return [-180, -90, 180, 90];\n        return [Math.max(-180, bounds[0]), Math.max(-90, bounds[1]), Math.min(180, bounds[2]), Math.min(90, bounds[3])];\n    }\n\n    contains(tileID: CanonicalTileID) {\n        const worldSize = Math.pow(2, tileID.z);\n        const level = {\n            minX: Math.floor(mercatorXfromLng(this.bounds.getWest()) * worldSize),\n            minY: Math.floor(mercatorYfromLat(this.bounds.getNorth()) * worldSize),\n            maxX: Math.ceil(mercatorXfromLng(this.bounds.getEast()) * worldSize),\n            maxY: Math.ceil(mercatorYfromLat(this.bounds.getSouth()) * worldSize)\n        };\n        const hit = tileID.x >= level.minX && tileID.x < level.maxX && tileID.y >= level.minY && tileID.y < level.maxY;\n        return hit;\n    }\n}\n\nexport default TileBounds;\n","\n//From https://github.com/Leaflet/Leaflet/blob/master/src/core/Util.js\nconst _templateRe = /\\{ *([\\w_]+) *\\}/g;\nconst _template = function (str, data) {\n    return str.replace(_templateRe, (str, key) => {\n        let value = data[key];\n\n        if (value === undefined) {\n            throw new Error(`No value provided for variable ${str}`);\n\n        } else if (typeof value === 'function') {\n            value = value(data);\n        }\n        return value;\n    });\n};\n\n//From https://github.com/Leaflet/Leaflet/blob/master/src/layer/tile/TileLayer.js\nconst _getSubdomain = function (tilePoint, subdomains) {\n    if (subdomains) {\n        const index = Math.abs(tilePoint.x + tilePoint.y) % subdomains.length;\n        return subdomains[index];\n    }\n    return null;\n};\n\nexport {\n    _template,\n    _getSubdomain\n};\n","// @flow\n\nimport window from '../util/window';\nconst {HTMLImageElement, HTMLCanvasElement, HTMLVideoElement, ImageData} = window;\n\nimport type Context from '../gl/context';\nimport type {RGBAImage, AlphaImage} from '../util/image';\n\nexport type TextureFormat =\n    | $PropertyType<WebGLRenderingContext, 'RGBA'>\n    | $PropertyType<WebGLRenderingContext, 'ALPHA'>;\nexport type TextureFilter =\n    | $PropertyType<WebGLRenderingContext, 'LINEAR'>\n    | $PropertyType<WebGLRenderingContext, 'LINEAR_MIPMAP_NEAREST'>\n    | $PropertyType<WebGLRenderingContext, 'NEAREST'>;\nexport type TextureWrap =\n    | $PropertyType<WebGLRenderingContext, 'REPEAT'>\n    | $PropertyType<WebGLRenderingContext, 'CLAMP_TO_EDGE'>\n    | $PropertyType<WebGLRenderingContext, 'MIRRORED_REPEAT'>;\n\ntype EmptyImage = {\n    width: number,\n    height: number,\n    data: null\n}\n\nexport type TextureImage =\n    | RGBAImage\n    | AlphaImage\n    | HTMLImageElement\n    | HTMLCanvasElement\n    | HTMLVideoElement\n    | ImageData\n    | EmptyImage;\n\nclass Texture {\n    context: Context;\n    size: [number, number];\n    texture: WebGLTexture;\n    format: TextureFormat;\n    filter: ?TextureFilter;\n    wrap: ?TextureWrap;\n    useMipmap: boolean;\n\n    constructor(context: Context, image: TextureImage, format: TextureFormat, options: ?{ premultiply?: boolean, useMipmap?: boolean }) {\n        this.context = context;\n        this.format = format;\n        this.texture = context.gl.createTexture();\n        this.update(image, options);\n    }\n\n    update(image: TextureImage, options: ?{premultiply?: boolean, useMipmap?: boolean}, position?: { x: number, y: number }) {\n        const {width, height} = image;\n        const resize = (!this.size || this.size[0] !== width || this.size[1] !== height) && !position;\n        const {context} = this;\n        const {gl} = context;\n\n        this.useMipmap = Boolean(options && options.useMipmap);\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n        context.pixelStoreUnpackFlipY.set(false);\n        context.pixelStoreUnpack.set(1);\n        context.pixelStoreUnpackPremultiplyAlpha.set(this.format === gl.RGBA && (!options || options.premultiply !== false));\n\n        if (resize) {\n            this.size = [width, height];\n\n            if (image instanceof HTMLImageElement || image instanceof HTMLCanvasElement || image instanceof HTMLVideoElement || image instanceof ImageData) {\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, gl.UNSIGNED_BYTE, image);\n            } else {\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, gl.UNSIGNED_BYTE, image.data);\n            }\n\n        } else {\n            const {x, y} = position || {x: 0, y: 0};\n            if (image instanceof HTMLImageElement || image instanceof HTMLCanvasElement || image instanceof HTMLVideoElement || image instanceof ImageData) {\n                gl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, gl.RGBA, gl.UNSIGNED_BYTE, image);\n            } else {\n                gl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, width, height, gl.RGBA, gl.UNSIGNED_BYTE, image.data);\n            }\n        }\n\n        if (this.useMipmap && this.isSizePowerOfTwo()) {\n            gl.generateMipmap(gl.TEXTURE_2D);\n        }\n    }\n\n    bind(filter: TextureFilter, wrap: TextureWrap, minFilter: ?TextureFilter) {\n        const {context} = this;\n        const {gl} = context;\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n        if (minFilter === gl.LINEAR_MIPMAP_NEAREST && !this.isSizePowerOfTwo()) {\n            minFilter = gl.LINEAR;\n        }\n\n        if (filter !== this.filter) {\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter || filter);\n            this.filter = filter;\n        }\n\n        if (wrap !== this.wrap) {\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap);\n            this.wrap = wrap;\n        }\n    }\n\n    isSizePowerOfTwo() {\n        return this.size[0] === this.size[1] && (Math.log(this.size[0]) / Math.LN2) % 1 === 0;\n    }\n\n    destroy() {\n        const {gl} = this.context;\n        gl.deleteTexture(this.texture);\n        this.texture = (null: any);\n    }\n}\n\nexport default Texture;\n","// @flow\n\nimport {extend, pick} from 'mapbox-gl/src/util/util';\n\nimport {getImage} from 'mapbox-gl/src/util/ajax';\nimport {Event, ErrorEvent, Evented} from 'mapbox-gl/src/util/evented';\nimport loadArcGISMapServer from './load_arcgis_mapserver';\n// import {postTurnstileEvent, postMapLoadEvent} from 'mapbox-gl/src/util/mapbox';\nimport TileBounds from 'mapbox-gl/src/source/tile_bounds';\nimport {_template, _getSubdomain} from './helpers';\nimport Texture from 'mapbox-gl/src/render/texture';\nimport {cacheEntryPossiblyAdded} from 'mapbox-gl/src/util/tile_request_cache';\n\nimport type {Source} from 'mapbox-gl/src/source/source';\nimport type {OverscaledTileID} from 'mapbox-gl/src/source/tile_id';\nimport type Map from 'mapbox-gl/src/ui/map';\nimport type Dispatcher from 'mapbox-gl/src/util/dispatcher';\nimport type Tile from 'mapbox-gl/src/source/tile';\nimport type {Callback} from 'mapbox-gl/src/types/callback';\n// import type {Cancelable} from 'mapbox-gl/src/types/cancelable';\nimport type {\n    RasterSourceSpecification,\n    RasterDEMSourceSpecification\n} from 'mapbox-gl/src/style-spec/types';\n\nclass ArcGISTiledMapServiceSource extends Evented implements Source {\n\n    type: 'raster' | 'raster-dem';\n    id: string;\n    minzoom: number;\n    maxzoom: number;\n    url: string;\n    scheme: string;\n    tileSize: number;\n\n    bounds: ?[number, number, number, number];\n    tileBounds: TileBounds;\n    roundZoom: boolean;\n    dispatcher: Dispatcher;\n    map: Map;\n    tiles: Array<string>;\n\n    _loaded: boolean;\n    _options: RasterSourceSpecification | RasterDEMSourceSpecification;\n\n    constructor(id: string, options: RasterSourceSpecification | RasterDEMSourceSpecification, dispatcher: Dispatcher, eventedParent: Evented) {\n        super();\n        this.id = id;\n        this.dispatcher = dispatcher;\n        this.setEventedParent(eventedParent);\n\n        this.type = 'arcgisraster';\n        this.minzoom = 0;\n        this.maxzoom = 22;\n        this.roundZoom = true;\n        this.tileSize = 512;\n        this._loaded = false;\n\n        this._options = extend({type: 'arcgisraster'}, options);\n        extend(this, pick(options, ['url', 'scheme', 'tileSize']));\n    }\n\n    load() {\n        this._loaded = false;\n        this.fire(new Event('dataloading', {dataType: 'source'}));\n        loadArcGISMapServer(this._options, (err, metadata) => {\n            this._loaded = true;\n            if (err) {\n                this.fire(new ErrorEvent(err));\n            } else if (metadata) {\n                extend(this, metadata);\n\n                if (metadata.bounds) {\n                    this.tileBounds = new TileBounds(metadata.bounds, this.minzoom, this.maxzoom);\n                }\n\n                // `content` is included here to prevent a race condition where `Style#_updateSources` is called\n                // before the TileJSON arrives. this makes sure the tiles needed are loaded once TileJSON arrives\n                // ref: https://github.com/mapbox/mapbox-gl-js/pull/4347#discussion_r104418088\n                this.fire(new Event('data', {dataType: 'source', sourceDataType: 'metadata'}));\n                this.fire(new Event('data', {dataType: 'source', sourceDataType: 'content'}));\n            }\n        });\n    }\n\n    loaded(): boolean {\n        return this._loaded;\n    }\n\n    onAdd(map: Map) {\n        // set the urls\n        const baseUrl = this.url.split('?')[0];\n        this.tileUrl = `${baseUrl}/tile/{z}/{y}/{x}`;\n\n        const arcgisonline = new RegExp(/tiles.arcgis(online)?\\.com/g);\n        if (arcgisonline.test(this.url)) {\n            this.tileUrl = this.tileUrl.replace('://tiles', '://tiles{s}');\n            this.subdomains = ['1', '2', '3', '4'];\n        }\n\n        if (this.token) {\n            this.tileUrl += (`?token=${this.token}`);\n        }\n\n        this.map = map;\n        this.load();\n    }\n\n    onRemove() {\n\n    }\n\n    serialize() {\n        return extend({}, this._options);\n    }\n\n    hasTile(tileID: OverscaledTileID) {\n        return !this.tileBounds || this.tileBounds.contains(tileID.canonical);\n    }\n\n    loadTile(tile: Tile, callback: Callback<void>) {\n        //convert to ags coords\n        const tilePoint = { z: tile.tileID.overscaledZ, x: tile.tileID.canonical.x, y: tile.tileID.canonical.y };\n\n        const url =  _template(this.tileUrl, extend({\n            s: _getSubdomain(tilePoint, this.subdomains),\n            z: (this._lodMap && this._lodMap[tilePoint.z]) ? this._lodMap[tilePoint.z] : tilePoint.z, // try lod map first, then just defualt to zoom level\n            x: tilePoint.x,\n            y: tilePoint.y\n        }, this.options));\n        tile.request = getImage({url},  (err, img) => {\n            delete tile.request;\n\n            if (tile.aborted) {\n                tile.state = 'unloaded';\n                callback(null);\n            } else if (err) {\n                tile.state = 'errored';\n                callback(err);\n            } else if (img) {\n                if (this.map._refreshExpiredTiles) tile.setExpiryData(img);\n                delete (img: any).cacheControl;\n                delete (img: any).expires;\n\n                const context = this.map.painter.context;\n                const gl = context.gl;\n                tile.texture = this.map.painter.getTileTexture(img.width);\n                if (tile.texture) {\n                    tile.texture.update(img, {useMipmap: true});\n                } else {\n                    tile.texture = new Texture(context, img, gl.RGBA, {useMipmap: true});\n                    tile.texture.bind(gl.LINEAR, gl.CLAMP_TO_EDGE, gl.LINEAR_MIPMAP_NEAREST);\n\n                    if (context.extTextureFilterAnisotropic) {\n                        gl.texParameterf(gl.TEXTURE_2D, context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT, context.extTextureFilterAnisotropicMax);\n                    }\n                }\n\n                tile.state = 'loaded';\n\n                cacheEntryPossiblyAdded(this.dispatcher);\n\n                callback(null);\n            }\n        });\n    }\n\n    abortTile(tile: Tile, callback: Callback<void>) {\n        if (tile.request) {\n            tile.request.cancel();\n            delete tile.request;\n        }\n        callback();\n    }\n\n    unloadTile(tile: Tile, callback: Callback<void>) {\n        if (tile.texture) this.map.painter.saveTileTexture(tile.texture);\n        callback();\n    }\n\n    hasTransition() {\n        return false;\n    }\n}\n\nexport default ArcGISTiledMapServiceSource;\n"],"names":["extend","dest","sources","src","k","pick","properties","const","result","i","length","let","uuid","b","a","Math","random","toString","replace","validateUuid","str","test","warnOnceHistory","warnOnce","message","console","warn","parseCacheControl","cacheControl","header","$0","$1","$2","$3","value","toLowerCase","maxAge","parseInt","isNaN","storageAvailable","type","storage","window","setItem","removeItem","e","linkEl","reducedMotionQuery","glForTesting","webpImgTest","config","API_URL","EVENTS_URL","this","indexOf","FEEDBACK_URL","REQUIRE_ACCESS_TOKEN","ACCESS_TOKEN","MAX_PARALLEL_IMAGE_REQUESTS","now","performance","bind","Date","raf","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","cancel","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","exported","frame","fn","getImageData","img","padding","canvas","document","createElement","context","getContext","Error","width","height","drawImage","resolveURL","path","href","hardwareConcurrency","navigator","devicePixelRatio","prefersReducedMotion","matchMedia","matches","onload","gl","texture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","isContextLost","deleteTexture","testWebpTextureUpload","onerror","isMapboxURL","url","mapboxHTTPURLRe","isMapboxHTTPURL","urlRe","parseAccessToken","accessToken","parts","split","JSON","parse","decodeURIComponent","atob","map","c","charCodeAt","slice","join","TelemetryEvent","constructor","anonId","eventData","queue","pendingRequest","getStorageKey","domain","tokenData","u","btoa","encodeURIComponent","match","p1","String","fromCharCode","Number","telemEventKey","fetchEventData","isLocalStorageAvailable","storageKey","uuidKey","data","localStorage","getItem","saveEventData","Object","keys","stringify","processRequests","_","postEvent","timestamp","additionalPayload","callback","customAccessToken","eventsUrlObject","protocol","authority","params","parseUrl","push","obj","payload","event","toISOString","userId","finalPayload","request","headers","Content-Type","postData","error","queueRequest","responseConstructorSupportsReadableStream","MapLoadEvent","super","success","skuToken","postMapLoadEvent","tileUrls","mapId","some","id","shift","err","turnstileEvent_","_customAccessToken","postTurnstileEvent","Array","isArray","lastSuccess","tokenU","dueForEvent","nextUpdate","lastUpdate","nextDate","daysElapsed","getDate","enabled.telemetry","mapLoadEvent_","CACHE_NAME","cacheLimit","cacheCheckThreshold","MIN_TIME_UNTIL_EXPIRY","cachePut","response","requestTime","caches","options","status","statusText","Headers","forEach","v","set","get","toUTCString","getTime","undefined","Response","ReadableStream","body","blob","then","prepareBody","clonedResponse","open","cache","put","stripQueryParameters","catch","start","cacheGet","strippedURL","fresh","expires","isFresh","delete","clone","globalEntryCounter","Infinity","freeze","Unknown","Style","Source","Tile","Glyphs","SpriteImage","SpriteJSON","Image","AJAXError","name","isWorker","WorkerGlobalScope","self","getReferrer","worker","referrer","location","parent","makeFetchRequest","requestParameters","controller","AbortController","Request","method","credentials","signal","complete","aborted","cacheIgnoringSearch","validateOrFetch","cachedResponse","responseIsFresh","finishRequest","fetch","ok","cacheableResponse","code","arrayBuffer","json","text","abort","imageQueue","numImageRequests","makeRequest","prototype","hasOwnProperty","actor","send","xhr","XMLHttpRequest","responseType","setRequestHeader","withCredentials","getResponseHeader","makeXMLHttpRequest","getJSON","getImage","queued","cancelled","advanced","advanceImageRequestQueue","getArrayBuffer","URL","webkitURL","revokeObjectURL","Blob","Uint8Array","byteLength","createObjectURL","_addEventListener","listener","listenerList","_removeEventListener","index","splice","Event","ErrorEvent","Evented","on","_listeners","off","_oneTimeListeners","once","fire","listens","target","call","_eventedParent","_eventedParentData","setEventedParent","SphericalMercator","D2R","PI","R2D","A","MAXEXTENT","isFloat","n","size","Bc","Cc","zc","Ac","d","px","ll","zoom","pow","bc","cc","ac","f","min","max","sin","x","y","log","round","g","atan","exp","bbox","tms_style","srs","ur","concat","convert","xyz","px_ll","px_ur","floor","bounds","minX","apply","minY","maxX","maxY","tms","to","forward","inverse","xy","tan","module","MercatorZoomLevels","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","_withinPercentage","percentage","abs","LngLat","lng","lat","wrap","w","toArray","toBounds","radius","latAccuracy","lngAccuracy","cos","LngLatBounds","input","lon","sw","ne","setSouthWest","setNorthEast","_ne","_sw","sw2","ne2","every","getCenter","getSouthWest","getNorthEast","getNorthWest","getWest","getNorth","getSouthEast","getEast","getSouth","isEmpty","mercatorXfromLng","mercatorYfromLat","TileBounds","minzoom","maxzoom","validateBounds","contains","tileID","worldSize","z","level","ceil","_templateRe","_getSubdomain","tilePoint","subdomains","Texture","image","format","update","position","resize","useMipmap","Boolean","pixelStoreUnpackFlipY","pixelStoreUnpack","pixelStoreUnpackPremultiplyAlpha","premultiply","HTMLImageElement","HTMLCanvasElement","HTMLVideoElement","ImageData","texSubImage2D","isSizePowerOfTwo","generateMipmap","filter","minFilter","LINEAR_MIPMAP_NEAREST","LINEAR","texParameteri","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","LN2","destroy","dispatcher","eventedParent","roundZoom","tileSize","_loaded","_options","load","dataType","metadata","tileBounds","sourceDataType","loaded","onAdd","baseUrl","tileUrl","RegExp","token","onRemove","serialize","hasTile","canonical","loadTile","tile","overscaledZ","s","_lodMap","key","state","_refreshExpiredTiles","setExpiryData","painter","getTileTexture","CLAMP_TO_EDGE","extTextureFilterAnisotropic","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","extTextureFilterAnisotropicMax","getActor","abortTile","unloadTile","saveTileTexture","hasTransition"],"mappings":"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"}