{"version":3,"file":"mapbox-gl-arcgis-tiled-map-service.js","sources":["../node_modules/mapbox-gl/src/util/util.js","../node_modules/mapbox-gl/src/util/config.js","../node_modules/mapbox-gl/src/util/browser.js","../node_modules/mapbox-gl/src/util/webp_supported.js","../node_modules/mapbox-gl/src/util/mapbox.js","../node_modules/mapbox-gl/src/util/sku_token.js","../node_modules/mapbox-gl/src/util/tile_request_cache.js","../node_modules/mapbox-gl/src/util/ajax.js","../node_modules/mapbox-gl/src/util/evented.js","../node_modules/@mapbox/sphericalmercator/sphericalmercator.js","../src/load_arcgis_mapserver.js","../node_modules/mapbox-gl/src/geo/lng_lat.js","../node_modules/mapbox-gl/src/geo/lng_lat_bounds.js","../node_modules/mapbox-gl/src/geo/mercator_coordinate.js","../node_modules/mapbox-gl/src/source/tile_bounds.js","../src/helpers.js","../node_modules/mapbox-gl/src/render/texture.js","../src/arcgis_tiled_map_service_source.js"],"sourcesContent":["// @flow\n\nimport UnitBezier from '@mapbox/unitbezier';\n\nimport Point from '@mapbox/point-geometry';\nimport window from './window';\n\nimport type {Callback} from '../types/callback';\n\n/**\n * @module util\n * @private\n */\n\n/**\n * Given a value `t` that varies between 0 and 1, return\n * an interpolation function that eases between 0 and 1 in a pleasing\n * cubic in-out fashion.\n *\n * @private\n */\nexport function easeCubicInOut(t: number): number {\n    if (t <= 0) return 0;\n    if (t >= 1) return 1;\n    const t2 = t * t,\n        t3 = t2 * t;\n    return 4 * (t < 0.5 ? t3 : 3 * (t - t2) + t3 - 0.75);\n}\n\n/**\n * Given given (x, y), (x1, y1) control points for a bezier curve,\n * return a function that interpolates along that curve.\n *\n * @param p1x control point 1 x coordinate\n * @param p1y control point 1 y coordinate\n * @param p2x control point 2 x coordinate\n * @param p2y control point 2 y coordinate\n * @private\n */\nexport function bezier(p1x: number, p1y: number, p2x: number, p2y: number): (t: number) => number {\n    const bezier = new UnitBezier(p1x, p1y, p2x, p2y);\n    return function(t: number) {\n        return bezier.solve(t);\n    };\n}\n\n/**\n * A default bezier-curve powered easing function with\n * control points (0.25, 0.1) and (0.25, 1)\n *\n * @private\n */\nexport const ease = bezier(0.25, 0.1, 0.25, 1);\n\n/**\n * constrain n to the given range via min + max\n *\n * @param n value\n * @param min the minimum value to be returned\n * @param max the maximum value to be returned\n * @returns the clamped value\n * @private\n */\nexport function clamp(n: number, min: number, max: number): number {\n    return Math.min(max, Math.max(min, n));\n}\n\n/**\n * constrain n to the given range, excluding the minimum, via modular arithmetic\n *\n * @param n value\n * @param min the minimum value to be returned, exclusive\n * @param max the maximum value to be returned, inclusive\n * @returns constrained number\n * @private\n */\nexport function wrap(n: number, min: number, max: number): number {\n    const d = max - min;\n    const w = ((n - min) % d + d) % d + min;\n    return (w === min) ? max : w;\n}\n\n/*\n * Call an asynchronous function on an array of arguments,\n * calling `callback` with the completed results of all calls.\n *\n * @param array input to each call of the async function.\n * @param fn an async function with signature (data, callback)\n * @param callback a callback run after all async work is done.\n * called with an array, containing the results of each async call.\n * @private\n */\nexport function asyncAll<Item, Result>(\n    array: Array<Item>,\n    fn: (item: Item, fnCallback: Callback<Result>) => void,\n    callback: Callback<Array<Result>>\n) {\n    if (!array.length) { return callback(null, []); }\n    let remaining = array.length;\n    const results = new Array(array.length);\n    let error = null;\n    array.forEach((item, i) => {\n        fn(item, (err, result) => {\n            if (err) error = err;\n            results[i] = ((result: any): Result); // https://github.com/facebook/flow/issues/2123\n            if (--remaining === 0) callback(error, results);\n        });\n    });\n}\n\n/*\n * Polyfill for Object.values. Not fully spec compliant, but we don't\n * need it to be.\n *\n * @private\n */\nexport function values<T>(obj: {[key: string]: T}): Array<T> {\n    const result = [];\n    for (const k in obj) {\n        result.push(obj[k]);\n    }\n    return result;\n}\n\n/*\n * Compute the difference between the keys in one object and the keys\n * in another object.\n *\n * @returns keys difference\n * @private\n */\nexport function keysDifference<S, T>(obj: {[key: string]: S}, other: {[key: string]: T}): Array<string> {\n    const difference = [];\n    for (const i in obj) {\n        if (!(i in other)) {\n            difference.push(i);\n        }\n    }\n    return difference;\n}\n\n/**\n * Given a destination object and optionally many source objects,\n * copy all properties from the source objects into the destination.\n * The last source object given overrides properties from previous\n * source objects.\n *\n * @param dest destination object\n * @param sources sources from which properties are pulled\n * @private\n */\nexport function extend(dest: Object, ...sources: Array<?Object>): Object {\n    for (const src of sources) {\n        for (const k in src) {\n            dest[k] = src[k];\n        }\n    }\n    return dest;\n}\n\n/**\n * Given an object and a number of properties as strings, return version\n * of that object with only those properties.\n *\n * @param src the object\n * @param properties an array of property names chosen\n * to appear on the resulting object.\n * @returns object with limited properties.\n * @example\n * var foo = { name: 'Charlie', age: 10 };\n * var justName = pick(foo, ['name']);\n * // justName = { name: 'Charlie' }\n * @private\n */\nexport function pick(src: Object, properties: Array<string>): Object {\n    const result = {};\n    for (let i = 0; i < properties.length; i++) {\n        const k = properties[i];\n        if (k in src) {\n            result[k] = src[k];\n        }\n    }\n    return result;\n}\n\nlet id = 1;\n\n/**\n * Return a unique numeric id, starting at 1 and incrementing with\n * each call.\n *\n * @returns unique numeric id.\n * @private\n */\nexport function uniqueId(): number {\n    return id++;\n}\n\n/**\n * Return a random UUID (v4). Taken from: https://gist.github.com/jed/982883\n * @private\n */\nexport function uuid(): string {\n    function b(a) {\n        return a ? (a ^ Math.random() * 16 >> a / 4).toString(16) :\n        //$FlowFixMe: Flow doesn't like the implied array literal conversion here\n            ([1e7] + -[1e3] + -4e3 + -8e3 + -1e11).replace(/[018]/g, b);\n    }\n    return b();\n}\n\n/**\n * Validate a string to match UUID(v4) of the\n * form: xxxxxxxx-xxxx-4xxx-[89ab]xxx-xxxxxxxxxxxx\n * @param str string to validate.\n * @private\n */\nexport function validateUuid(str: ?string): boolean {\n    return str ? /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(str) : false;\n}\n\n/**\n * Given an array of member function names as strings, replace all of them\n * with bound versions that will always refer to `context` as `this`. This\n * is useful for classes where otherwise event bindings would reassign\n * `this` to the evented object or some other value: this lets you ensure\n * the `this` value always.\n *\n * @param fns list of member function names\n * @param context the context value\n * @example\n * function MyClass() {\n *   bindAll(['ontimer'], this);\n *   this.name = 'Tom';\n * }\n * MyClass.prototype.ontimer = function() {\n *   alert(this.name);\n * };\n * var myClass = new MyClass();\n * setTimeout(myClass.ontimer, 100);\n * @private\n */\nexport function bindAll(fns: Array<string>, context: Object): void {\n    fns.forEach((fn) => {\n        if (!context[fn]) { return; }\n        context[fn] = context[fn].bind(context);\n    });\n}\n\n/**\n * Determine if a string ends with a particular substring\n *\n * @private\n */\nexport function endsWith(string: string, suffix: string): boolean {\n    return string.indexOf(suffix, string.length - suffix.length) !== -1;\n}\n\n/**\n * Create an object by mapping all the values of an existing object while\n * preserving their keys.\n *\n * @private\n */\nexport function mapObject(input: Object, iterator: Function, context?: Object): Object {\n    const output = {};\n    for (const key in input) {\n        output[key] = iterator.call(context || this, input[key], key, input);\n    }\n    return output;\n}\n\n/**\n * Create an object by filtering out values of an existing object.\n *\n * @private\n */\nexport function filterObject(input: Object, iterator: Function, context?: Object): Object {\n    const output = {};\n    for (const key in input) {\n        if (iterator.call(context || this, input[key], key, input)) {\n            output[key] = input[key];\n        }\n    }\n    return output;\n}\n\nimport deepEqual from '../style-spec/util/deep_equal';\nexport { deepEqual };\n\n/**\n * Deeply clones two objects.\n *\n * @private\n */\nexport function clone<T>(input: T): T {\n    if (Array.isArray(input)) {\n        return input.map(clone);\n    } else if (typeof input === 'object' && input) {\n        return ((mapObject(input, clone): any): T);\n    } else {\n        return input;\n    }\n}\n\n/**\n * Check if two arrays have at least one common element.\n *\n * @private\n */\nexport function arraysIntersect<T>(a: Array<T>, b: Array<T>): boolean {\n    for (let l = 0; l < a.length; l++) {\n        if (b.indexOf(a[l]) >= 0) return true;\n    }\n    return false;\n}\n\n/**\n * Print a warning message to the console and ensure duplicate warning messages\n * are not printed.\n *\n * @private\n */\nconst warnOnceHistory: {[key: string]: boolean} = {};\n\nexport function warnOnce(message: string): void {\n    if (!warnOnceHistory[message]) {\n        // console isn't defined in some WebWorkers, see #2558\n        if (typeof console !== \"undefined\") console.warn(message);\n        warnOnceHistory[message] = true;\n    }\n}\n\n/**\n * Indicates if the provided Points are in a counter clockwise (true) or clockwise (false) order\n *\n * @private\n * @returns true for a counter clockwise set of points\n */\n// http://bryceboe.com/2006/10/23/line-segment-intersection-algorithm/\nexport function isCounterClockwise(a: Point, b: Point, c: Point): boolean {\n    return (c.y - a.y) * (b.x - a.x) > (b.y - a.y) * (c.x - a.x);\n}\n\n/**\n * Returns the signed area for the polygon ring.  Postive areas are exterior rings and\n * have a clockwise winding.  Negative areas are interior rings and have a counter clockwise\n * ordering.\n *\n * @private\n * @param ring Exterior or interior ring\n */\nexport function calculateSignedArea(ring: Array<Point>): number {\n    let sum = 0;\n    for (let i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\n        p1 = ring[i];\n        p2 = ring[j];\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\n    }\n    return sum;\n}\n\n/**\n * Detects closed polygons, first + last point are equal\n *\n * @private\n * @param points array of points\n * @return true if the points are a closed polygon\n */\nexport function isClosedPolygon(points: Array<Point>): boolean {\n    // If it is 2 points that are the same then it is a point\n    // If it is 3 points with start and end the same then it is a line\n    if (points.length < 4)\n        return false;\n\n    const p1 = points[0];\n    const p2 = points[points.length - 1];\n\n    if (Math.abs(p1.x - p2.x) > 0 ||\n        Math.abs(p1.y - p2.y) > 0) {\n        return false;\n    }\n\n    // polygon simplification can produce polygons with zero area and more than 3 points\n    return Math.abs(calculateSignedArea(points)) > 0.01;\n}\n\n/**\n * Converts spherical coordinates to cartesian coordinates.\n *\n * @private\n * @param spherical Spherical coordinates, in [radial, azimuthal, polar]\n * @return cartesian coordinates in [x, y, z]\n */\n\nexport function sphericalToCartesian([r, azimuthal, polar]: [number, number, number]): {x: number, y: number, z: number} {\n    // We abstract \"north\"/\"up\" (compass-wise) to be 0° when really this is 90° (π/2):\n    // correct for that here\n    azimuthal += 90;\n\n    // Convert azimuthal and polar angles to radians\n    azimuthal *= Math.PI / 180;\n    polar *= Math.PI / 180;\n\n    return {\n        x: r * Math.cos(azimuthal) * Math.sin(polar),\n        y: r * Math.sin(azimuthal) * Math.sin(polar),\n        z: r * Math.cos(polar)\n    };\n}\n\n/**\n * Parses data from 'Cache-Control' headers.\n *\n * @private\n * @param cacheControl Value of 'Cache-Control' header\n * @return object containing parsed header info.\n */\n\nexport function parseCacheControl(cacheControl: string): Object {\n    // Taken from [Wreck](https://github.com/hapijs/wreck)\n    const re = /(?:^|(?:\\s*\\,\\s*))([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)(?:\\=(?:([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)|(?:\\\"((?:[^\"\\\\]|\\\\.)*)\\\")))?/g;\n\n    const header = {};\n    cacheControl.replace(re, ($0, $1, $2, $3) => {\n        const value = $2 || $3;\n        header[$1] = value ? value.toLowerCase() : true;\n        return '';\n    });\n\n    if (header['max-age']) {\n        const maxAge = parseInt(header['max-age'], 10);\n        if (isNaN(maxAge)) delete header['max-age'];\n        else header['max-age'] = maxAge;\n    }\n\n    return header;\n}\n\nexport function storageAvailable(type: string): boolean {\n    try {\n        const storage = window[type];\n        storage.setItem('_mapbox_test_', 1);\n        storage.removeItem('_mapbox_test_');\n        return true;\n    } catch (e) {\n        return false;\n    }\n}\n\n// The following methods are from https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\n//Unicode compliant base64 encoder for strings\nexport function b64EncodeUnicode(str: string) {\n    return window.btoa(\n        encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,\n            (match, p1) => {\n                return String.fromCharCode(Number('0x' + p1)); //eslint-disable-line\n            }\n        )\n    );\n}\n\n\n// Unicode compliant decoder for base64-encoded strings\nexport function b64DecodeUnicode(str: string) {\n    return decodeURIComponent(window.atob(str).split('').map((c) => {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2); //eslint-disable-line\n    }).join(''));\n}\n","// @flow strict\n\ntype Config = {|\n  API_URL: string,\n  EVENTS_URL: ?string,\n  FEEDBACK_URL: string,\n  REQUIRE_ACCESS_TOKEN: boolean,\n  ACCESS_TOKEN: ?string,\n  MAX_PARALLEL_IMAGE_REQUESTS: number\n|};\n\nconst config: Config = {\n    API_URL: 'https://api.mapbox.com',\n    get EVENTS_URL() {\n        if (!this.API_URL) { return null; }\n        if (this.API_URL.indexOf('https://api.mapbox.cn') === 0) {\n            return 'https://events.mapbox.cn/events/v2';\n        } else if (this.API_URL.indexOf('https://api.mapbox.com') === 0) {\n            return 'https://events.mapbox.com/events/v2';\n        } else {\n            return null;\n        }\n    },\n    FEEDBACK_URL: 'https://apps.mapbox.com/feedback',\n    REQUIRE_ACCESS_TOKEN: true,\n    ACCESS_TOKEN: null,\n    MAX_PARALLEL_IMAGE_REQUESTS: 16\n};\n\nexport default config;\n","// @flow strict\n\nimport window from './window';\nimport type { Cancelable } from '../types/cancelable';\n\nconst now = window.performance && window.performance.now ?\n    window.performance.now.bind(window.performance) :\n    Date.now.bind(Date);\n\nconst raf = window.requestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.msRequestAnimationFrame;\n\nconst cancel = window.cancelAnimationFrame ||\n    window.mozCancelAnimationFrame ||\n    window.webkitCancelAnimationFrame ||\n    window.msCancelAnimationFrame;\n\nlet linkEl;\n\n/**\n * @private\n */\nconst exported = {\n    /**\n     * Provides a function that outputs milliseconds: either performance.now()\n     * or a fallback to Date.now()\n     */\n    now,\n\n    frame(fn: () => void): Cancelable {\n        const frame = raf(fn);\n        return { cancel: () => cancel(frame) };\n    },\n\n    getImageData(img: CanvasImageSource): ImageData {\n        const canvas = window.document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        if (!context) {\n            throw new Error('failed to create canvas 2d context');\n        }\n        canvas.width = img.width;\n        canvas.height = img.height;\n        context.drawImage(img, 0, 0, img.width, img.height);\n        return context.getImageData(0, 0, img.width, img.height);\n    },\n\n    resolveURL(path: string) {\n        if (!linkEl) linkEl = window.document.createElement('a');\n        linkEl.href = path;\n        return linkEl.href;\n    },\n\n    hardwareConcurrency: window.navigator.hardwareConcurrency || 4,\n    get devicePixelRatio() { return window.devicePixelRatio; }\n};\n\nexport default exported;\n","// @flow strict\n\nimport window from './window';\n\nconst exported = {\n    supported: false,\n    testSupport\n};\n\nexport default exported;\n\nlet glForTesting;\nlet webpCheckComplete = false;\nlet webpImgTest;\nlet webpImgTestOnloadComplete = false;\n\nif (window.document) {\n    webpImgTest = window.document.createElement('img');\n    webpImgTest.onload = function() {\n        if (glForTesting) testWebpTextureUpload(glForTesting);\n        glForTesting = null;\n        webpImgTestOnloadComplete = true;\n    };\n    webpImgTest.onerror = function() {\n        webpCheckComplete = true;\n        glForTesting = null;\n    };\n    webpImgTest.src = 'data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=';\n}\n\nfunction testSupport(gl: WebGLRenderingContext) {\n    if (webpCheckComplete || !webpImgTest) return;\n\n    // HTMLImageElement.complete is set when an image is done loading it's source\n    // regardless of whether the load was successful or not.\n    // It's possible for an error to set HTMLImageElement.complete to true which would trigger\n    // testWebpTextureUpload and mistakenly set exported.supported to true in browsers which don't support webp\n    // To avoid this, we set a flag in the image's onload handler and only call testWebpTextureUpload\n    // after a successful image load event.\n    if (webpImgTestOnloadComplete) {\n        testWebpTextureUpload(gl);\n    } else {\n        glForTesting = gl;\n\n    }\n}\n\nfunction testWebpTextureUpload(gl: WebGLRenderingContext) {\n    // Edge 18 supports WebP but not uploading a WebP image to a gl texture\n    // Test support for this before allowing WebP images.\n    // https://github.com/mapbox/mapbox-gl-js/issues/7671\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    try {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, webpImgTest);\n\n        // The error does not get triggered in Edge if the context is lost\n        if (gl.isContextLost()) return;\n\n        exported.supported = true;\n    } catch (e) {\n        // Catch \"Unspecified Error.\" in Edge 18.\n    }\n\n    gl.deleteTexture(texture);\n\n    webpCheckComplete = true;\n}\n","// @flow\n\n/***** START WARNING - IF YOU USE THIS CODE WITH MAPBOX MAPPING APIS, REMOVAL OR\n* MODIFICATION OF THE FOLLOWING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******\n* The following code is used to access Mapbox's Mapping APIs. Removal or modification\n* of this code when used with Mapbox's Mapping APIs can result in higher fees and/or\n* termination of your account with Mapbox.\n*\n* Under the Mapbox Terms of Service, you may not use this code to access Mapbox\n* Mapping APIs other than through Mapbox SDKs.\n*\n* The Mapping APIs documentation is available at https://docs.mapbox.com/api/maps/#maps\n* and the Mapbox Terms of Service are available at https://www.mapbox.com/tos/\n******************************************************************************/\n\nimport config from './config';\n\nimport browser from './browser';\nimport window from './window';\nimport webpSupported from './webp_supported';\nimport { createSkuToken, SKU_ID } from './sku_token';\nimport { version as sdkVersion } from '../../package.json';\nimport { uuid, validateUuid, storageAvailable, b64DecodeUnicode, b64EncodeUnicode, warnOnce, extend } from './util';\nimport { postData, ResourceType } from './ajax';\n\nimport type { RequestParameters } from './ajax';\nimport type { Cancelable } from '../types/cancelable';\nimport type { TileJSON } from '../types/tilejson';\n\ntype ResourceTypeEnum = $Keys<typeof ResourceType>;\nexport type RequestTransformFunction = (url: string, resourceType?: ResourceTypeEnum) => RequestParameters;\n\ntype UrlObject = {|\n    protocol: string,\n    authority: string,\n    path: string,\n    params: Array<string>\n|};\n\nexport class RequestManager {\n    _skuToken: string;\n    _skuTokenExpiresAt: number;\n    _transformRequestFn: ?RequestTransformFunction;\n\n    constructor(transformRequestFn?: RequestTransformFunction) {\n        this._transformRequestFn = transformRequestFn;\n        this._createSkuToken();\n    }\n\n    _createSkuToken() {\n        const skuToken = createSkuToken();\n        this._skuToken = skuToken.token;\n        this._skuTokenExpiresAt = skuToken.tokenExpiresAt;\n    }\n\n    _isSkuTokenExpired(): boolean {\n        return Date.now() > this._skuTokenExpiresAt;\n    }\n\n    transformRequest(url: string, type: ResourceTypeEnum) {\n        if (this._transformRequestFn) {\n            return this._transformRequestFn(url, type) || {url};\n        }\n\n        return {url};\n    }\n\n    normalizeStyleURL(url: string, accessToken?: string): string {\n        return normalizeStyleURL(url, accessToken);\n    }\n\n    normalizeGlyphsURL(url: string, accessToken?: string): string {\n        return normalizeGlyphsURL(url, accessToken);\n    }\n\n    normalizeSourceURL(url: string, accessToken?: string): string {\n        return normalizeSourceURL(url, accessToken);\n    }\n\n    normalizeSpriteURL(url: string, format: string, extension: string, accessToken?: string): string {\n        return normalizeSpriteURL(url, format, extension, accessToken);\n    }\n\n    normalizeTileURL(tileURL: string, sourceURL?: ?string, tileSize?: ?number): string {\n        if (this._isSkuTokenExpired()) {\n            this._createSkuToken();\n        }\n\n        return normalizeTileURL(tileURL, sourceURL, tileSize, this._skuToken);\n    }\n\n    canonicalizeTileURL(url: string) {\n        return canonicalizeTileURL(url);\n    }\n\n    canonicalizeTileset(tileJSON: TileJSON, sourceURL: string) {\n        return canonicalizeTileset(tileJSON, sourceURL);\n    }\n}\n\nconst help = 'See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes';\n\nfunction makeAPIURL(urlObject: UrlObject, accessToken: string | null | void): string {\n    const apiUrlObject = parseUrl(config.API_URL);\n    urlObject.protocol = apiUrlObject.protocol;\n    urlObject.authority = apiUrlObject.authority;\n\n    if (apiUrlObject.path !== '/') {\n        urlObject.path = `${apiUrlObject.path}${urlObject.path}`;\n    }\n\n    if (!config.REQUIRE_ACCESS_TOKEN) return formatUrl(urlObject);\n\n    accessToken = accessToken || config.ACCESS_TOKEN;\n    if (!accessToken)\n        throw new Error(`An API access token is required to use Mapbox GL. ${help}`);\n    if (accessToken[0] === 's')\n        throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${help}`);\n\n    urlObject.params.push(`access_token=${accessToken}`);\n    return formatUrl(urlObject);\n}\n\nfunction isMapboxURL(url: string) {\n    return url.indexOf('mapbox:') === 0;\n}\n\nconst mapboxHTTPURLRe = /^((https?:)?\\/\\/)?([^\\/]+\\.)?mapbox\\.c(n|om)(\\/|\\?|$)/i;\nfunction isMapboxHTTPURL(url: string): boolean {\n    return mapboxHTTPURLRe.test(url);\n}\n\nfunction hasCacheDefeatingSku(url: string) {\n    return url.indexOf('sku=') > 0 && isMapboxHTTPURL(url);\n}\n\nconst normalizeStyleURL = function(url: string, accessToken?: string): string {\n    if (!isMapboxURL(url)) return url;\n    const urlObject = parseUrl(url);\n    urlObject.path = `/styles/v1${urlObject.path}`;\n    return makeAPIURL(urlObject, accessToken);\n};\n\nconst normalizeGlyphsURL = function(url: string, accessToken?: string): string {\n    if (!isMapboxURL(url)) return url;\n    const urlObject = parseUrl(url);\n    urlObject.path = `/fonts/v1${urlObject.path}`;\n    return makeAPIURL(urlObject, accessToken);\n};\n\nconst normalizeSourceURL = function(url: string, accessToken?: string): string {\n    if (!isMapboxURL(url)) return url;\n    const urlObject = parseUrl(url);\n    urlObject.path = `/v4/${urlObject.authority}.json`;\n    // TileJSON requests need a secure flag appended to their URLs so\n    // that the server knows to send SSL-ified resource references.\n    urlObject.params.push('secure');\n    return makeAPIURL(urlObject, accessToken);\n};\n\nconst normalizeSpriteURL = function(url: string, format: string, extension: string, accessToken?: string): string {\n    const urlObject = parseUrl(url);\n    if (!isMapboxURL(url)) {\n        urlObject.path += `${format}${extension}`;\n        return formatUrl(urlObject);\n    }\n    urlObject.path = `/styles/v1${urlObject.path}/sprite${format}${extension}`;\n    return makeAPIURL(urlObject, accessToken);\n};\n\nconst imageExtensionRe = /(\\.(png|jpg)\\d*)(?=$)/;\n\nconst normalizeTileURL = function(tileURL: string, sourceURL?: ?string, tileSize?: ?number, skuToken?: string): string {\n    if (!sourceURL || !isMapboxURL(sourceURL)) return tileURL;\n\n    const urlObject = parseUrl(tileURL);\n\n    // The v4 mapbox tile API supports 512x512 image tiles only when @2x\n    // is appended to the tile URL. If `tileSize: 512` is specified for\n    // a Mapbox raster source force the @2x suffix even if a non hidpi device.\n    const suffix = browser.devicePixelRatio >= 2 || tileSize === 512 ? '@2x' : '';\n    const extension = webpSupported.supported ? '.webp' : '$1';\n    urlObject.path = urlObject.path.replace(imageExtensionRe, `${suffix}${extension}`);\n    urlObject.path = `/v4${urlObject.path}`;\n\n    if (config.REQUIRE_ACCESS_TOKEN && config.ACCESS_TOKEN && skuToken) {\n        urlObject.params.push(`sku=${skuToken}`);\n    }\n\n    return makeAPIURL(urlObject);\n};\n\n// matches any file extension specified by a dot and one or more alphanumeric characters\nconst extensionRe = /\\.[\\w]+$/;\n\nconst canonicalizeTileURL = function(url: string) {\n    const version = \"/v4/\";\n\n    const urlObject = parseUrl(url);\n    // Make sure that we are dealing with a valid Mapbox tile URL.\n    // Has to begin with /v4/, with a valid filename + extension\n    if (!urlObject.path.match(/(^\\/v4\\/)/) || !urlObject.path.match(extensionRe)) {\n        // Not a proper Mapbox tile URL.\n        return url;\n    }\n    // Reassemble the canonical URL from the parts we've parsed before.\n    let result = \"mapbox://tiles/\";\n    result +=  urlObject.path.replace(version, '');\n\n    // Append the query string, minus the access token parameter.\n    const params = urlObject.params.filter(p => !p.match(/^access_token=/));\n    if (params.length) result += `?${params.join('&')}`;\n    return result;\n};\n\nconst canonicalizeTileset = function(tileJSON: TileJSON, sourceURL: string) {\n    if (!isMapboxURL(sourceURL)) return tileJSON.tiles || [];\n    const canonical = [];\n    for (const url of tileJSON.tiles) {\n        const canonicalUrl = canonicalizeTileURL(url);\n        canonical.push(canonicalUrl);\n    }\n    return canonical;\n};\n\nconst urlRe = /^(\\w+):\\/\\/([^/?]*)(\\/[^?]+)?\\??(.+)?/;\n\nfunction parseUrl(url: string): UrlObject {\n    const parts = url.match(urlRe);\n    if (!parts) {\n        throw new Error('Unable to parse URL object');\n    }\n    return {\n        protocol: parts[1],\n        authority: parts[2],\n        path: parts[3] || '/',\n        params: parts[4] ? parts[4].split('&') : []\n    };\n}\n\nfunction formatUrl(obj: UrlObject): string {\n    const params = obj.params.length ? `?${obj.params.join('&')}` : '';\n    return `${obj.protocol}://${obj.authority}${obj.path}${params}`;\n}\n\nexport { isMapboxURL, isMapboxHTTPURL, hasCacheDefeatingSku };\n\nconst telemEventKey = 'mapbox.eventData';\n\nfunction parseAccessToken(accessToken: ?string) {\n    if (!accessToken) {\n        return null;\n    }\n\n    const parts = accessToken.split('.');\n    if (!parts || parts.length !== 3) {\n        return null;\n    }\n\n    try {\n        const jsonData = JSON.parse(b64DecodeUnicode(parts[1]));\n        return jsonData;\n    } catch (e) {\n        return null;\n    }\n}\n\ntype TelemetryEventType = 'appUserTurnstile' | 'map.load';\n\nclass TelemetryEvent {\n    eventData: any;\n    anonId: ?string;\n    queue: Array<any>;\n    type: TelemetryEventType;\n    pendingRequest: ?Cancelable;\n\n    constructor(type: TelemetryEventType) {\n        this.type = type;\n        this.anonId = null;\n        this.eventData = {};\n        this.queue = [];\n        this.pendingRequest = null;\n    }\n\n    getStorageKey(domain: ?string) {\n        const tokenData = parseAccessToken(config.ACCESS_TOKEN);\n        let u = '';\n        if (tokenData && tokenData['u']) {\n            u = b64EncodeUnicode(tokenData['u']);\n        } else {\n            u = config.ACCESS_TOKEN || '';\n        }\n        return domain ?\n            `${telemEventKey}.${domain}:${u}` :\n            `${telemEventKey}:${u}`;\n    }\n\n    fetchEventData() {\n        const isLocalStorageAvailable = storageAvailable('localStorage');\n        const storageKey = this.getStorageKey();\n        const uuidKey = this.getStorageKey('uuid');\n\n        if (isLocalStorageAvailable) {\n            //Retrieve cached data\n            try {\n                const data = window.localStorage.getItem(storageKey);\n                if (data) {\n                    this.eventData = JSON.parse(data);\n                }\n\n                const uuid = window.localStorage.getItem(uuidKey);\n                if (uuid) this.anonId = uuid;\n            } catch (e) {\n                warnOnce('Unable to read from LocalStorage');\n            }\n        }\n    }\n\n    saveEventData() {\n        const isLocalStorageAvailable = storageAvailable('localStorage');\n        const storageKey =  this.getStorageKey();\n        const uuidKey = this.getStorageKey('uuid');\n        if (isLocalStorageAvailable) {\n            try {\n                window.localStorage.setItem(uuidKey, this.anonId);\n                if (Object.keys(this.eventData).length >= 1) {\n                    window.localStorage.setItem(storageKey, JSON.stringify(this.eventData));\n                }\n            } catch (e) {\n                warnOnce('Unable to write to LocalStorage');\n            }\n        }\n\n    }\n\n    processRequests() {}\n\n    /*\n    * If any event data should be persisted after the POST request, the callback should modify eventData`\n    * to the values that should be saved. For this reason, the callback should be invoked prior to the call\n    * to TelemetryEvent#saveData\n    */\n    postEvent(timestamp: number, additionalPayload: {[string]: any}, callback: (err: ?Error) => void) {\n        if (!config.EVENTS_URL) return;\n        const eventsUrlObject: UrlObject = parseUrl(config.EVENTS_URL);\n        eventsUrlObject.params.push(`access_token=${config.ACCESS_TOKEN || ''}`);\n        const payload: Object = {\n            event: this.type,\n            created: new Date(timestamp).toISOString(),\n            sdkIdentifier: 'mapbox-gl-js',\n            sdkVersion,\n            skuId: SKU_ID,\n            userId: this.anonId\n        };\n\n        const finalPayload = additionalPayload ? extend(payload, additionalPayload) : payload;\n        const request: RequestParameters = {\n            url: formatUrl(eventsUrlObject),\n            headers: {\n                'Content-Type': 'text/plain' //Skip the pre-flight OPTIONS request\n            },\n            body: JSON.stringify([finalPayload])\n        };\n\n        this.pendingRequest = postData(request, (error) => {\n            this.pendingRequest = null;\n            callback(error);\n            this.saveEventData();\n            this.processRequests();\n        });\n    }\n\n    queueRequest(event: number | {id: number, timestamp: number}) {\n        this.queue.push(event);\n        this.processRequests();\n    }\n}\n\nexport class MapLoadEvent extends TelemetryEvent {\n    +success: {[number]: boolean};\n    skuToken: string;\n\n    constructor() {\n        super('map.load');\n        this.success = {};\n        this.skuToken = '';\n    }\n\n    postMapLoadEvent(tileUrls: Array<string>, mapId: number, skuToken: string) {\n        //Enabled only when Mapbox Access Token is set and a source uses\n        // mapbox tiles.\n        this.skuToken = skuToken;\n\n        if (config.EVENTS_URL &&\n            config.ACCESS_TOKEN &&\n            Array.isArray(tileUrls) &&\n            tileUrls.some(url => isMapboxURL(url) || isMapboxHTTPURL(url))) {\n            this.queueRequest({id: mapId, timestamp: Date.now()});\n        }\n    }\n\n    processRequests() {\n        if (this.pendingRequest || this.queue.length === 0) return;\n        const {id, timestamp} = this.queue.shift();\n\n        // Only one load event should fire per map\n        if (id && this.success[id]) return;\n\n        if (!this.anonId) {\n            this.fetchEventData();\n        }\n\n        if (!validateUuid(this.anonId)) {\n            this.anonId = uuid();\n        }\n\n        this.postEvent(timestamp, {skuToken: this.skuToken}, (err) => {\n            if (!err) {\n                if (id) this.success[id] = true;\n            }\n        });\n    }\n}\n\nexport class TurnstileEvent extends TelemetryEvent {\n    constructor() {\n        super('appUserTurnstile');\n    }\n\n    postTurnstileEvent(tileUrls: Array<string>) {\n        //Enabled only when Mapbox Access Token is set and a source uses\n        // mapbox tiles.\n        if (config.EVENTS_URL &&\n            config.ACCESS_TOKEN &&\n            Array.isArray(tileUrls) &&\n            tileUrls.some(url => isMapboxURL(url) || isMapboxHTTPURL(url))) {\n            this.queueRequest(Date.now());\n        }\n    }\n\n\n    processRequests() {\n        if (this.pendingRequest || this.queue.length === 0) {\n            return;\n        }\n\n        if (!this.anonId || !this.eventData.lastSuccess || !this.eventData.tokenU) {\n            //Retrieve cached data\n            this.fetchEventData();\n        }\n\n        const tokenData = parseAccessToken(config.ACCESS_TOKEN);\n        const tokenU = tokenData ? tokenData['u'] : config.ACCESS_TOKEN;\n        //Reset event data cache if the access token owner changed.\n        let dueForEvent = tokenU !== this.eventData.tokenU;\n\n        if (!validateUuid(this.anonId)) {\n            this.anonId = uuid();\n            dueForEvent = true;\n        }\n\n        const nextUpdate = this.queue.shift();\n        // Record turnstile event once per calendar day.\n        if (this.eventData.lastSuccess) {\n            const lastUpdate = new Date(this.eventData.lastSuccess);\n            const nextDate = new Date(nextUpdate);\n            const daysElapsed = (nextUpdate - this.eventData.lastSuccess) / (24 * 60 * 60 * 1000);\n            dueForEvent = dueForEvent || daysElapsed >= 1 || daysElapsed < -1 || lastUpdate.getDate() !== nextDate.getDate();\n        } else {\n            dueForEvent = true;\n        }\n\n        if (!dueForEvent) {\n            return this.processRequests();\n        }\n\n        this.postEvent(nextUpdate, {\"enabled.telemetry\": false}, (err) => {\n            if (!err) {\n                this.eventData.lastSuccess = nextUpdate;\n                this.eventData.tokenU = tokenU;\n            }\n        });\n    }\n}\n\nconst turnstileEvent_ = new TurnstileEvent();\nexport const postTurnstileEvent = turnstileEvent_.postTurnstileEvent.bind(turnstileEvent_);\n\nconst mapLoadEvent_ = new MapLoadEvent();\nexport const postMapLoadEvent = mapLoadEvent_.postMapLoadEvent.bind(mapLoadEvent_);\n\n/***** END WARNING - REMOVAL OR MODIFICATION OF THE\nPRECEDING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******/\n","// @flow\n\n/***** START WARNING - IF YOU USE THIS CODE WITH MAPBOX MAPPING APIS, REMOVAL OR\n* MODIFICATION OF THE FOLLOWING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******\n* The following code is used to access Mapbox's Mapping APIs. Removal or modification\n* of this code when used with Mapbox's Mapping APIs can result in higher fees and/or\n* termination of your account with Mapbox.\n*\n* Under the Mapbox Terms of Service, you may not use this code to access Mapbox\n* Mapping APIs other than through Mapbox SDKs.\n*\n* The Mapping APIs documentation is available at https://docs.mapbox.com/api/maps/#maps\n* and the Mapbox Terms of Service are available at https://www.mapbox.com/tos/\n******************************************************************************/\n\ntype SkuTokenObject = {|\n    token: string,\n    tokenExpiresAt: number\n|};\n\nconst SKU_ID = '01';\n\nfunction createSkuToken(): SkuTokenObject {\n    // SKU_ID and TOKEN_VERSION are specified by an internal schema and should not change\n    const TOKEN_VERSION = '1';\n    const base62chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n    // sessionRandomizer is a randomized 10-digit base-62 number\n    let sessionRandomizer = '';\n    for (let i = 0; i < 10; i++) {\n        sessionRandomizer += base62chars[Math.floor(Math.random() * 62)];\n    }\n    const expiration = 12 * 60 * 60 * 1000; // 12 hours\n    const token = [TOKEN_VERSION, SKU_ID, sessionRandomizer].join('');\n    const tokenExpiresAt = Date.now() + expiration;\n\n    return { token, tokenExpiresAt };\n}\n\nexport { createSkuToken, SKU_ID };\n\n/***** END WARNING - REMOVAL OR MODIFICATION OF THE\nPRECEDING CODE VIOLATES THE MAPBOX TERMS OF SERVICE  ******/\n","// @flow\n\nimport { parseCacheControl } from './util';\nimport window from './window';\n\nimport type Dispatcher from './dispatcher';\n\nconst CACHE_NAME = 'mapbox-tiles';\nlet cacheLimit = 500; // 50MB / (100KB/tile) ~= 500 tiles\nlet cacheCheckThreshold = 50;\n\nconst MIN_TIME_UNTIL_EXPIRY = 1000 * 60 * 7; // 7 minutes. Skip caching tiles with a short enough max age.\n\nexport type ResponseOptions = {\n    status: number,\n    statusText: string,\n    headers: window.Headers\n};\n\n\nlet responseConstructorSupportsReadableStream;\nfunction prepareBody(response: Response, callback) {\n    if (responseConstructorSupportsReadableStream === undefined) {\n        try {\n            new Response(new ReadableStream()); // eslint-disable-line no-undef\n            responseConstructorSupportsReadableStream = true;\n        } catch (e) {\n            // Edge\n            responseConstructorSupportsReadableStream = false;\n        }\n    }\n\n    if (responseConstructorSupportsReadableStream) {\n        callback(response.body);\n    } else {\n        response.blob().then(callback);\n    }\n}\n\nexport function cachePut(request: Request, response: Response, requestTime: number) {\n    if (!window.caches) return;\n\n    const options: ResponseOptions = {\n        status: response.status,\n        statusText: response.statusText,\n        headers: new window.Headers()\n    };\n    response.headers.forEach((v, k) => options.headers.set(k, v));\n\n    const cacheControl = parseCacheControl(response.headers.get('Cache-Control') || '');\n    if (cacheControl['no-store']) {\n        return;\n    }\n    if (cacheControl['max-age']) {\n        options.headers.set('Expires', new Date(requestTime + cacheControl['max-age'] * 1000).toUTCString());\n    }\n\n    const timeUntilExpiry = new Date(options.headers.get('Expires')).getTime() - requestTime;\n    if (timeUntilExpiry < MIN_TIME_UNTIL_EXPIRY) return;\n\n    prepareBody(response, body => {\n        const clonedResponse = new window.Response(body, options);\n\n        window.caches.open(CACHE_NAME).then(cache => cache.put(stripQueryParameters(request.url), clonedResponse));\n    });\n}\n\nfunction stripQueryParameters(url: string) {\n    const start = url.indexOf('?');\n    return start < 0 ? url : url.slice(0, start);\n}\n\nexport function cacheGet(request: Request, callback: (error: ?any, response: ?Response, fresh: ?boolean) => void) {\n    if (!window.caches) return callback(null);\n\n    window.caches.open(CACHE_NAME)\n        .catch(callback)\n        .then(cache => {\n            cache.match(request, { ignoreSearch: true })\n                .catch(callback)\n                .then(response => {\n                    const fresh = isFresh(response);\n\n                    // Reinsert into cache so that order of keys in the cache is the order of access.\n                    // This line makes the cache a LRU instead of a FIFO cache.\n                    const strippedURL = stripQueryParameters(request.url);\n                    cache.delete(strippedURL);\n                    if (fresh) {\n                        cache.put(strippedURL, response.clone());\n                    }\n\n                    callback(null, response, fresh);\n                });\n        });\n}\n\n\n\nfunction isFresh(response) {\n    if (!response) return false;\n    const expires = new Date(response.headers.get('Expires'));\n    const cacheControl = parseCacheControl(response.headers.get('Cache-Control') || '');\n    return expires > Date.now() && !cacheControl['no-cache'];\n}\n\n\n// `Infinity` triggers a cache check after the first tile is loaded\n// so that a check is run at least once on each page load.\nlet globalEntryCounter = Infinity;\n\n// The cache check gets run on a worker. The reason for this is that\n// profiling sometimes shows this as taking up significant time on the\n// thread it gets called from. And sometimes it doesn't. It *may* be\n// fine to run this on the main thread but out of caution this is being\n// dispatched on a worker. This can be investigated further in the future.\nexport function cacheEntryPossiblyAdded(dispatcher: Dispatcher) {\n    globalEntryCounter++;\n    if (globalEntryCounter > cacheCheckThreshold) {\n        dispatcher.send('enforceCacheSizeLimit', cacheLimit);\n        globalEntryCounter = 0;\n    }\n}\n\n// runs on worker, see above comment\nexport function enforceCacheSizeLimit(limit: number) {\n    if (!window.caches) return;\n    window.caches.open(CACHE_NAME)\n        .then(cache => {\n            cache.keys().then(keys => {\n                for (let i = 0; i < keys.length - limit; i++) {\n                    cache.delete(keys[i]);\n                }\n            });\n        });\n}\n\nexport function clearTileCache(callback?: (err: ?Error) => void) {\n    const promise = window.caches.delete(CACHE_NAME);\n    if (callback) {\n        promise.catch(callback).then(() => callback());\n    }\n}\n\nexport function setCacheLimits(limit: number, checkThreshold: number) {\n    cacheLimit = limit;\n    cacheCheckThreshold = checkThreshold;\n}\n","// @flow\n\nimport window from './window';\nimport { extend, warnOnce } from './util';\nimport { isMapboxHTTPURL, hasCacheDefeatingSku } from './mapbox';\nimport config from './config';\nimport assert from 'assert';\nimport { cacheGet, cachePut } from './tile_request_cache';\n\nimport type { Callback } from '../types/callback';\nimport type { Cancelable } from '../types/cancelable';\n\n/**\n * The type of a resource.\n * @private\n * @readonly\n * @enum {string}\n */\nconst ResourceType = {\n    Unknown: 'Unknown',\n    Style: 'Style',\n    Source: 'Source',\n    Tile: 'Tile',\n    Glyphs: 'Glyphs',\n    SpriteImage: 'SpriteImage',\n    SpriteJSON: 'SpriteJSON',\n    Image: 'Image'\n};\nexport { ResourceType };\n\nif (typeof Object.freeze == 'function') {\n    Object.freeze(ResourceType);\n}\n\n/**\n * A `RequestParameters` object to be returned from Map.options.transformRequest callbacks.\n * @typedef {Object} RequestParameters\n * @property {string} url The URL to be requested.\n * @property {Object} headers The headers to be sent with the request.\n * @property {string} credentials `'same-origin'|'include'` Use 'include' to send cookies with cross-origin requests.\n */\nexport type RequestParameters = {\n    url: string,\n    headers?: Object,\n    method?: 'GET' | 'POST' | 'PUT',\n    body?: string,\n    type?: 'string' | 'json' | 'arrayBuffer',\n    credentials?: 'same-origin' | 'include',\n    collectResourceTiming?: boolean\n};\n\nexport type ResponseCallback<T> = (error: ?Error, data: ?T, cacheControl: ?string, expires: ?string) => void;\n\nclass AJAXError extends Error {\n    status: number;\n    url: string;\n    constructor(message: string, status: number, url: string) {\n        if (status === 401 && isMapboxHTTPURL(url)) {\n            message += ': you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes';\n        }\n        super(message);\n        this.status = status;\n        this.url = url;\n\n        // work around for https://github.com/Rich-Harris/buble/issues/40\n        this.name = this.constructor.name;\n        this.message = message;\n    }\n\n    toString() {\n        return `${this.name}: ${this.message} (${this.status}): ${this.url}`;\n    }\n}\n\nfunction isWorker() {\n    return typeof WorkerGlobalScope !== 'undefined' && typeof self !== 'undefined' &&\n           self instanceof WorkerGlobalScope;\n}\n\n// Ensure that we're sending the correct referrer from blob URL worker bundles.\n// For files loaded from the local file system, `location.origin` will be set\n// to the string(!) \"null\" (Firefox), or \"file://\" (Chrome, Safari, Edge, IE),\n// and we will set an empty referrer. Otherwise, we're using the document's URL.\n/* global self, WorkerGlobalScope */\nexport const getReferrer = isWorker() ?\n    () => self.worker && self.worker.referrer :\n    () => {\n        const origin = window.location.origin;\n        if (origin && origin !== 'null' && origin !== 'file://') {\n            return origin + window.location.pathname;\n        }\n    };\n\nfunction makeFetchRequest(requestParameters: RequestParameters, callback: ResponseCallback<any>): Cancelable {\n    const controller = new window.AbortController();\n    const request = new window.Request(requestParameters.url, {\n        method: requestParameters.method || 'GET',\n        body: requestParameters.body,\n        credentials: requestParameters.credentials,\n        headers: requestParameters.headers,\n        referrer: getReferrer(),\n        signal: controller.signal\n    });\n    let complete = false;\n\n    const cacheIgnoringSearch = hasCacheDefeatingSku(request.url);\n\n    if (requestParameters.type === 'json') {\n        request.headers.set('Accept', 'application/json');\n    }\n\n    const validateOrFetch = (err, cachedResponse, responseIsFresh) => {\n        if (err) {\n            // Do fetch in case of cache error.\n            // HTTP pages in Edge trigger a security error that can be ignored.\n            if (err.message !== 'SecurityError') {\n                warnOnce(err);\n            }\n        }\n\n        if (cachedResponse && responseIsFresh) {\n            return finishRequest(cachedResponse);\n        }\n\n        if (cachedResponse) {\n            // We can't do revalidation with 'If-None-Match' because then the\n            // request doesn't have simple cors headers.\n        }\n\n        const requestTime = Date.now();\n\n        window.fetch(request).then(response => {\n            if (response.ok) {\n                const cacheableResponse = cacheIgnoringSearch ? response.clone() : null;\n                return finishRequest(response, cacheableResponse, requestTime);\n\n            } else {\n                return callback(new AJAXError(response.statusText, response.status, requestParameters.url));\n            }\n        }).catch(error => {\n            if (error.code === 20) {\n                // silence expected AbortError\n                return;\n            }\n            callback(new Error(error.message));\n        });\n    };\n\n    const finishRequest = (response, cacheableResponse, requestTime) => {\n        (\n            requestParameters.type === 'arrayBuffer' ? response.arrayBuffer() :\n            requestParameters.type === 'json' ? response.json() :\n            response.text()\n        ).then(result => {\n            if (cacheableResponse && requestTime) {\n                // The response needs to be inserted into the cache after it has completely loaded.\n                // Until it is fully loaded there is a chance it will be aborted. Aborting while\n                // reading the body can cause the cache insertion to error. We could catch this error\n                // in most browsers but in Firefox it seems to sometimes crash the tab. Adding\n                // it to the cache here avoids that error.\n                cachePut(request, cacheableResponse, requestTime);\n            }\n            complete = true;\n            callback(null, result, response.headers.get('Cache-Control'), response.headers.get('Expires'));\n        }).catch(err => callback(new Error(err.message)));\n    };\n\n    if (cacheIgnoringSearch) {\n        cacheGet(request, validateOrFetch);\n    } else {\n        validateOrFetch(null, null);\n    }\n\n    return { cancel: () => {\n        if (!complete) controller.abort();\n    }};\n}\n\nfunction makeXMLHttpRequest(requestParameters: RequestParameters, callback: ResponseCallback<any>): Cancelable {\n    const xhr: XMLHttpRequest = new window.XMLHttpRequest();\n\n    xhr.open(requestParameters.method || 'GET', requestParameters.url, true);\n    if (requestParameters.type === 'arrayBuffer') {\n        xhr.responseType = 'arraybuffer';\n    }\n    for (const k in requestParameters.headers) {\n        xhr.setRequestHeader(k, requestParameters.headers[k]);\n    }\n    if (requestParameters.type === 'json') {\n        xhr.setRequestHeader('Accept', 'application/json');\n    }\n    xhr.withCredentials = requestParameters.credentials === 'include';\n    xhr.onerror = () => {\n        callback(new Error(xhr.statusText));\n    };\n    xhr.onload = () => {\n        if (((xhr.status >= 200 && xhr.status < 300) || xhr.status === 0) && xhr.response !== null) {\n            let data: mixed = xhr.response;\n            if (requestParameters.type === 'json') {\n                // We're manually parsing JSON here to get better error messages.\n                try {\n                    data = JSON.parse(xhr.response);\n                } catch (err) {\n                    return callback(err);\n                }\n            }\n            callback(null, data, xhr.getResponseHeader('Cache-Control'), xhr.getResponseHeader('Expires'));\n        } else {\n            callback(new AJAXError(xhr.statusText, xhr.status, requestParameters.url));\n        }\n    };\n    xhr.send(requestParameters.body);\n    return { cancel: () => xhr.abort() };\n}\n\nexport const makeRequest = function(requestParameters: RequestParameters, callback: ResponseCallback<any>): Cancelable {\n    // We're trying to use the Fetch API if possible. However, in some situations we can't use it:\n    // - IE11 doesn't support it at all. In this case, we dispatch the request to the main thread so\n    //   that we can get an accruate referrer header.\n    // - Safari exposes window.AbortController, but it doesn't work actually abort any requests in\n    //   some versions (see https://bugs.webkit.org/show_bug.cgi?id=174980#c2)\n    // - Requests for resources with the file:// URI scheme don't work with the Fetch API either. In\n    //   this case we unconditionally use XHR on the current thread since referrers don't matter.\n    if (!/^file:/.test(requestParameters.url)) {\n        if (window.fetch && window.Request && window.AbortController && window.Request.prototype.hasOwnProperty('signal')) {\n            return makeFetchRequest(requestParameters, callback);\n        }\n        if (isWorker() && self.worker && self.worker.actor) {\n            return self.worker.actor.send('getResource', requestParameters, callback);\n        }\n    }\n    return makeXMLHttpRequest(requestParameters, callback);\n};\n\nexport const getJSON = function(requestParameters: RequestParameters, callback: ResponseCallback<Object>): Cancelable {\n    return makeRequest(extend(requestParameters, { type: 'json' }), callback);\n};\n\nexport const getArrayBuffer = function(requestParameters: RequestParameters, callback: ResponseCallback<ArrayBuffer>): Cancelable {\n    return makeRequest(extend(requestParameters, { type: 'arrayBuffer' }), callback);\n};\n\nexport const postData = function(requestParameters: RequestParameters, callback: ResponseCallback<string>): Cancelable {\n    return makeRequest(extend(requestParameters, { method: 'POST' }), callback);\n};\n\nfunction sameOrigin(url) {\n    const a: HTMLAnchorElement = window.document.createElement('a');\n    a.href = url;\n    return a.protocol === window.document.location.protocol && a.host === window.document.location.host;\n}\n\nconst transparentPngUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\n\nlet imageQueue, numImageRequests;\nexport const resetImageRequestQueue = () => {\n    imageQueue = [];\n    numImageRequests = 0;\n};\nresetImageRequestQueue();\n\nexport const getImage = function(requestParameters: RequestParameters, callback: Callback<HTMLImageElement>): Cancelable {\n    // limit concurrent image loads to help with raster sources performance on big screens\n    if (numImageRequests >= config.MAX_PARALLEL_IMAGE_REQUESTS) {\n        const queued = {\n            requestParameters,\n            callback,\n            cancelled: false,\n            cancel() { this.cancelled = true; }\n        };\n        imageQueue.push(queued);\n        return queued;\n    }\n    numImageRequests++;\n\n    let advanced = false;\n    const advanceImageRequestQueue = () => {\n        if (advanced) return;\n        advanced = true;\n        numImageRequests--;\n        assert(numImageRequests >= 0);\n        while (imageQueue.length && numImageRequests < config.MAX_PARALLEL_IMAGE_REQUESTS) { // eslint-disable-line\n            const request = imageQueue.shift();\n            const {requestParameters, callback, cancelled} = request;\n            if (!cancelled) {\n                request.cancel = getImage(requestParameters, callback).cancel;\n            }\n        }\n    };\n\n    // request the image with XHR to work around caching issues\n    // see https://github.com/mapbox/mapbox-gl-js/issues/1470\n    const request = getArrayBuffer(requestParameters, (err: ?Error, data: ?ArrayBuffer, cacheControl: ?string, expires: ?string) => {\n\n        advanceImageRequestQueue();\n\n        if (err) {\n            callback(err);\n        } else if (data) {\n            const img: HTMLImageElement = new window.Image();\n            const URL = window.URL || window.webkitURL;\n            img.onload = () => {\n                callback(null, img);\n                URL.revokeObjectURL(img.src);\n            };\n            img.onerror = () => callback(new Error('Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.'));\n            const blob: Blob = new window.Blob([new Uint8Array(data)], { type: 'image/png' });\n            (img: any).cacheControl = cacheControl;\n            (img: any).expires = expires;\n            img.src = data.byteLength ? URL.createObjectURL(blob) : transparentPngUrl;\n        }\n    });\n\n    return {\n        cancel: () => {\n            request.cancel();\n            advanceImageRequestQueue();\n        }\n    };\n};\n\nexport const getVideo = function(urls: Array<string>, callback: Callback<HTMLVideoElement>): Cancelable {\n    const video: HTMLVideoElement = window.document.createElement('video');\n    video.muted = true;\n    video.onloadstart = function() {\n        callback(null, video);\n    };\n    for (let i = 0; i < urls.length; i++) {\n        const s: HTMLSourceElement = window.document.createElement('source');\n        if (!sameOrigin(urls[i])) {\n            video.crossOrigin = 'Anonymous';\n        }\n        s.src = urls[i];\n        video.appendChild(s);\n    }\n    return { cancel: () => {} };\n};\n","// @flow\n\nimport { extend } from './util';\n\ntype Listener = (Object) => any;\ntype Listeners = { [string]: Array<Listener> };\n\nfunction _addEventListener(type: string, listener: Listener, listenerList: Listeners) {\n    const listenerExists = listenerList[type] && listenerList[type].indexOf(listener) !== -1;\n    if (!listenerExists) {\n        listenerList[type] = listenerList[type] || [];\n        listenerList[type].push(listener);\n    }\n}\n\nfunction _removeEventListener(type: string, listener: Listener, listenerList: Listeners) {\n    if (listenerList && listenerList[type]) {\n        const index = listenerList[type].indexOf(listener);\n        if (index !== -1) {\n            listenerList[type].splice(index, 1);\n        }\n    }\n}\n\nexport class Event {\n    +type: string;\n\n    constructor(type: string, data: Object = {}) {\n        extend(this, data);\n        this.type = type;\n    }\n}\n\nexport class ErrorEvent extends Event {\n    error: Error;\n\n    constructor(error: Error, data: Object = {}) {\n        super('error', extend({error}, data));\n    }\n}\n\n/**\n * Methods mixed in to other classes for event capabilities.\n *\n * @mixin Evented\n */\nexport class Evented {\n    _listeners: Listeners;\n    _oneTimeListeners: Listeners;\n    _eventedParent: ?Evented;\n    _eventedParentData: ?(Object | () => Object);\n\n    /**\n     * Adds a listener to a specified event type.\n     *\n     * @param {string} type The event type to add a listen for.\n     * @param {Function} listener The function to be called when the event is fired.\n     *   The listener function is called with the data object passed to `fire`,\n     *   extended with `target` and `type` properties.\n     * @returns {Object} `this`\n     */\n    on(type: *, listener: Listener): this {\n        this._listeners = this._listeners || {};\n        _addEventListener(type, listener, this._listeners);\n\n        return this;\n    }\n\n    /**\n     * Removes a previously registered event listener.\n     *\n     * @param {string} type The event type to remove listeners for.\n     * @param {Function} listener The listener function to remove.\n     * @returns {Object} `this`\n     */\n    off(type: *, listener: Listener) {\n        _removeEventListener(type, listener, this._listeners);\n        _removeEventListener(type, listener, this._oneTimeListeners);\n\n        return this;\n    }\n\n    /**\n     * Adds a listener that will be called only once to a specified event type.\n     *\n     * The listener will be called first time the event fires after the listener is registered.\n     *\n     * @param {string} type The event type to listen for.\n     * @param {Function} listener The function to be called when the event is fired the first time.\n     * @returns {Object} `this`\n     */\n    once(type: string, listener: Listener) {\n        this._oneTimeListeners = this._oneTimeListeners || {};\n        _addEventListener(type, listener, this._oneTimeListeners);\n\n        return this;\n    }\n\n    fire(event: Event, properties?: Object) {\n        // Compatibility with (type: string, properties: Object) signature from previous versions.\n        // See https://github.com/mapbox/mapbox-gl-js/issues/6522,\n        //     https://github.com/mapbox/mapbox-gl-draw/issues/766\n        if (typeof event === 'string') {\n            event = new Event(event, properties || {});\n        }\n\n        const type = event.type;\n\n        if (this.listens(type)) {\n            (event: any).target = this;\n\n            // make sure adding or removing listeners inside other listeners won't cause an infinite loop\n            const listeners = this._listeners && this._listeners[type] ? this._listeners[type].slice() : [];\n            for (const listener of listeners) {\n                listener.call(this, event);\n            }\n\n            const oneTimeListeners = this._oneTimeListeners && this._oneTimeListeners[type] ? this._oneTimeListeners[type].slice() : [];\n            for (const listener of oneTimeListeners) {\n                _removeEventListener(type, listener, this._oneTimeListeners);\n                listener.call(this, event);\n            }\n\n            const parent = this._eventedParent;\n            if (parent) {\n                extend(\n                    event,\n                    typeof this._eventedParentData === 'function' ? this._eventedParentData() : this._eventedParentData\n                );\n                parent.fire(event);\n            }\n\n        // To ensure that no error events are dropped, print them to the\n        // console if they have no listeners.\n        } else if (event instanceof ErrorEvent) {\n            console.error(event.error);\n        }\n\n        return this;\n    }\n\n    /**\n     * Returns a true if this instance of Evented or any forwardeed instances of Evented have a listener for the specified type.\n     *\n     * @param {string} type The event type\n     * @returns {boolean} `true` if there is at least one registered listener for specified event type, `false` otherwise\n     * @private\n     */\n    listens(type: string) {\n        return (\n            (this._listeners && this._listeners[type] && this._listeners[type].length > 0) ||\n            (this._oneTimeListeners && this._oneTimeListeners[type] && this._oneTimeListeners[type].length > 0) ||\n            (this._eventedParent && this._eventedParent.listens(type))\n        );\n    }\n\n    /**\n     * Bubble all events fired by this instance of Evented to this parent instance of Evented.\n     *\n     * @private\n     * @returns {Object} `this`\n     * @private\n     */\n    setEventedParent(parent: ?Evented, data?: Object | () => Object) {\n        this._eventedParent = parent;\n        this._eventedParentData = data;\n\n        return this;\n    }\n}\n","var SphericalMercator = (function(){\n\n// Closures including constants and other precalculated values.\nvar cache = {},\n    EPSLN = 1.0e-10,\n    D2R = Math.PI / 180,\n    R2D = 180 / Math.PI,\n    // 900913 properties.\n    A = 6378137.0,\n    MAXEXTENT = 20037508.342789244;\n\nfunction isFloat(n){\n    return Number(n) === n && n % 1 !== 0;\n}\n\n// SphericalMercator constructor: precaches calculations\n// for fast tile lookups.\nfunction SphericalMercator(options) {\n    options = options || {};\n    this.size = options.size || 256;\n    if (!cache[this.size]) {\n        var size = this.size;\n        var c = cache[this.size] = {};\n        c.Bc = [];\n        c.Cc = [];\n        c.zc = [];\n        c.Ac = [];\n        for (var d = 0; d < 30; d++) {\n            c.Bc.push(size / 360);\n            c.Cc.push(size / (2 * Math.PI));\n            c.zc.push(size / 2);\n            c.Ac.push(size);\n            size *= 2;\n        }\n    }\n    this.Bc = cache[this.size].Bc;\n    this.Cc = cache[this.size].Cc;\n    this.zc = cache[this.size].zc;\n    this.Ac = cache[this.size].Ac;\n};\n\n// Convert lon lat to screen pixel value\n//\n// - `ll` {Array} `[lon, lat]` array of geographic coordinates.\n// - `zoom` {Number} zoom level.\nSphericalMercator.prototype.px = function(ll, zoom) {\n  if (isFloat(zoom)) {\n    var size = this.size * Math.pow(2, zoom);\n    var d = size / 2;\n    var bc = (size / 360);\n    var cc = (size / (2 * Math.PI));\n    var ac = size;\n    var f = Math.min(Math.max(Math.sin(D2R * ll[1]), -0.9999), 0.9999);\n    var x = d + ll[0] * bc;\n    var y = d + 0.5 * Math.log((1 + f) / (1 - f)) * -cc;\n    (x > ac) && (x = ac);\n    (y > ac) && (y = ac);\n    //(x < 0) && (x = 0);\n    //(y < 0) && (y = 0);\n    return [x, y];\n  } else {\n    var d = this.zc[zoom];\n    var f = Math.min(Math.max(Math.sin(D2R * ll[1]), -0.9999), 0.9999);\n    var x = Math.round(d + ll[0] * this.Bc[zoom]);\n    var y = Math.round(d + 0.5 * Math.log((1 + f) / (1 - f)) * (-this.Cc[zoom]));\n    (x > this.Ac[zoom]) && (x = this.Ac[zoom]);\n    (y > this.Ac[zoom]) && (y = this.Ac[zoom]);\n    //(x < 0) && (x = 0);\n    //(y < 0) && (y = 0);\n    return [x, y];\n  }\n};\n\n// Convert screen pixel value to lon lat\n//\n// - `px` {Array} `[x, y]` array of geographic coordinates.\n// - `zoom` {Number} zoom level.\nSphericalMercator.prototype.ll = function(px, zoom) {\n  if (isFloat(zoom)) {\n    var size = this.size * Math.pow(2, zoom);\n    var bc = (size / 360);\n    var cc = (size / (2 * Math.PI));\n    var zc = size / 2;\n    var g = (px[1] - zc) / -cc;\n    var lon = (px[0] - zc) / bc;\n    var lat = R2D * (2 * Math.atan(Math.exp(g)) - 0.5 * Math.PI);\n    return [lon, lat];\n  } else {\n    var g = (px[1] - this.zc[zoom]) / (-this.Cc[zoom]);\n    var lon = (px[0] - this.zc[zoom]) / this.Bc[zoom];\n    var lat = R2D * (2 * Math.atan(Math.exp(g)) - 0.5 * Math.PI);\n    return [lon, lat];\n  }\n};\n\n// Convert tile xyz value to bbox of the form `[w, s, e, n]`\n//\n// - `x` {Number} x (longitude) number.\n// - `y` {Number} y (latitude) number.\n// - `zoom` {Number} zoom.\n// - `tms_style` {Boolean} whether to compute using tms-style.\n// - `srs` {String} projection for resulting bbox (WGS84|900913).\n// - `return` {Array} bbox array of values in form `[w, s, e, n]`.\nSphericalMercator.prototype.bbox = function(x, y, zoom, tms_style, srs) {\n    // Convert xyz into bbox with srs WGS84\n    if (tms_style) {\n        y = (Math.pow(2, zoom) - 1) - y;\n    }\n    // Use +y to make sure it's a number to avoid inadvertent concatenation.\n    var ll = [x * this.size, (+y + 1) * this.size]; // lower left\n    // Use +x to make sure it's a number to avoid inadvertent concatenation.\n    var ur = [(+x + 1) * this.size, y * this.size]; // upper right\n    var bbox = this.ll(ll, zoom).concat(this.ll(ur, zoom));\n\n    // If web mercator requested reproject to 900913.\n    if (srs === '900913') {\n        return this.convert(bbox, '900913');\n    } else {\n        return bbox;\n    }\n};\n\n// Convert bbox to xyx bounds\n//\n// - `bbox` {Number} bbox in the form `[w, s, e, n]`.\n// - `zoom` {Number} zoom.\n// - `tms_style` {Boolean} whether to compute using tms-style.\n// - `srs` {String} projection of input bbox (WGS84|900913).\n// - `@return` {Object} XYZ bounds containing minX, maxX, minY, maxY properties.\nSphericalMercator.prototype.xyz = function(bbox, zoom, tms_style, srs) {\n    // If web mercator provided reproject to WGS84.\n    if (srs === '900913') {\n        bbox = this.convert(bbox, 'WGS84');\n    }\n\n    var ll = [bbox[0], bbox[1]]; // lower left\n    var ur = [bbox[2], bbox[3]]; // upper right\n    var px_ll = this.px(ll, zoom);\n    var px_ur = this.px(ur, zoom);\n    // Y = 0 for XYZ is the top hence minY uses px_ur[1].\n    var x = [ Math.floor(px_ll[0] / this.size), Math.floor((px_ur[0] - 1) / this.size) ];\n    var y = [ Math.floor(px_ur[1] / this.size), Math.floor((px_ll[1] - 1) / this.size) ];\n    var bounds = {\n        minX: Math.min.apply(Math, x) < 0 ? 0 : Math.min.apply(Math, x),\n        minY: Math.min.apply(Math, y) < 0 ? 0 : Math.min.apply(Math, y),\n        maxX: Math.max.apply(Math, x),\n        maxY: Math.max.apply(Math, y)\n    };\n    if (tms_style) {\n        var tms = {\n            minY: (Math.pow(2, zoom) - 1) - bounds.maxY,\n            maxY: (Math.pow(2, zoom) - 1) - bounds.minY\n        };\n        bounds.minY = tms.minY;\n        bounds.maxY = tms.maxY;\n    }\n    return bounds;\n};\n\n// Convert projection of given bbox.\n//\n// - `bbox` {Number} bbox in the form `[w, s, e, n]`.\n// - `to` {String} projection of output bbox (WGS84|900913). Input bbox\n//   assumed to be the \"other\" projection.\n// - `@return` {Object} bbox with reprojected coordinates.\nSphericalMercator.prototype.convert = function(bbox, to) {\n    if (to === '900913') {\n        return this.forward(bbox.slice(0, 2)).concat(this.forward(bbox.slice(2,4)));\n    } else {\n        return this.inverse(bbox.slice(0, 2)).concat(this.inverse(bbox.slice(2,4)));\n    }\n};\n\n// Convert lon/lat values to 900913 x/y.\nSphericalMercator.prototype.forward = function(ll) {\n    var xy = [\n        A * ll[0] * D2R,\n        A * Math.log(Math.tan((Math.PI*0.25) + (0.5 * ll[1] * D2R)))\n    ];\n    // if xy value is beyond maxextent (e.g. poles), return maxextent.\n    (xy[0] > MAXEXTENT) && (xy[0] = MAXEXTENT);\n    (xy[0] < -MAXEXTENT) && (xy[0] = -MAXEXTENT);\n    (xy[1] > MAXEXTENT) && (xy[1] = MAXEXTENT);\n    (xy[1] < -MAXEXTENT) && (xy[1] = -MAXEXTENT);\n    return xy;\n};\n\n// Convert 900913 x/y values to lon/lat.\nSphericalMercator.prototype.inverse = function(xy) {\n    return [\n        (xy[0] * R2D / A),\n        ((Math.PI*0.5) - 2.0 * Math.atan(Math.exp(-xy[1] / A))) * R2D\n    ];\n};\n\nreturn SphericalMercator;\n\n})();\n\nif (typeof module !== 'undefined' && typeof exports !== 'undefined') {\n    module.exports = exports = SphericalMercator;\n}\n","import { pick } from 'mapbox-gl/src/util/util';\nimport { getJSON } from 'mapbox-gl/src/util/ajax';\nimport browser from 'mapbox-gl/src/util/browser';\nimport SphericalMercator from '@mapbox/sphericalmercator';\n\n//Contains code from esri-leaflet https://github.com/Esri/esri-leaflet\nconst MercatorZoomLevels = {\n    '0': 156543.03392799999,\n    '1': 78271.516963999893,\n    '2': 39135.758482000099,\n    '3': 19567.879240999901,\n    '4': 9783.9396204999593,\n    '5': 4891.9698102499797,\n    '6': 2445.9849051249898,\n    '7': 1222.9924525624899,\n    '8': 611.49622628138002,\n    '9': 305.74811314055802,\n    '10': 152.874056570411,\n    '11': 76.437028285073197,\n    '12': 38.218514142536598,\n    '13': 19.109257071268299,\n    '14': 9.5546285356341496,\n    '15': 4.7773142679493699,\n    '16': 2.38865713397468,\n    '17': 1.1943285668550501,\n    '18': 0.59716428355981699,\n    '19': 0.29858214164761698,\n    '20': 0.14929107082381,\n    '21': 0.07464553541191,\n    '22': 0.0373227677059525,\n    '23': 0.0186613838529763\n};\n\nconst _withinPercentage = function (a, b, percentage) {\n    const diff = Math.abs((a / b) - 1);\n    return diff < percentage;\n};\n\nexport default function(options, callback) {\n    const loaded = function(err, metadata) {\n        if (err) {\n            return callback(err);\n        }\n\n        const result = pick(metadata,\n            ['tileInfo', 'initialExtent', 'fullExtent', 'spatialReference', 'tileServers', 'documentInfo']);\n\n        result._lodMap = {};\n        const zoomOffsetAllowance = 0.1;\n        const sr = metadata.spatialReference.latestWkid || metadata.spatialReference.wkid;\n        if (sr === 102100 || sr === 3857) {\n\n            /*\n            Example extent from ArcGIS REST API\n            fullExtent: {\n            xmin: -9144791.679226127,\n            ymin: -2195190.961437726,\n            xmax: -4650987.072019983,\n            ymax: 1118113.110155766,\n            spatialReference: {\n            wkid: 102100,\n            wkt: null\n            }\n            },\n            */\n            //convert ArcGIS extent to bounds\n            const extent = metadata.fullExtent;\n            if (extent && extent.spatialReference && extent.spatialReference.wkid ===  102100) {\n                const boundsWebMercator = [extent.xmin, extent.ymin, extent.xmax, extent.ymax];\n                var merc = new SphericalMercator({\n                    size: 256\n                });\n                const boundsWGS84 = merc.convert(boundsWebMercator);\n                result.bounds = boundsWGS84;\n            }\n\n            // create the zoom level data\n            const arcgisLODs = metadata.tileInfo.lods;\n            const correctResolutions = MercatorZoomLevels;\n            result.minzoom = arcgisLODs[0].level;\n            result.maxzoom = arcgisLODs[arcgisLODs.length - 1].level;\n            for (let i = 0; i < arcgisLODs.length; i++) {\n                const arcgisLOD = arcgisLODs[i];\n                for (const ci in correctResolutions) {\n                    const correctRes = correctResolutions[ci];\n\n                    if (_withinPercentage(arcgisLOD.resolution, correctRes, zoomOffsetAllowance)) {\n                        result._lodMap[ci] = arcgisLOD.level;\n                        break;\n                    }\n                }\n            }\n        } else {\n            callback(new Error('non-mercator spatial reference'));\n        }\n\n        callback(null, result);\n    };\n\n    if (options.url) {\n        getJSON({url: options.url}, loaded);\n    } else {\n        browser.frame(loaded.bind(null, null, options));\n    }\n};\n","// @flow\n\nimport { wrap } from '../util/util';\nimport LngLatBounds from './lng_lat_bounds';\n\n/**\n * A `LngLat` object represents a given longitude and latitude coordinate, measured in degrees.\n *\n * Mapbox GL uses longitude, latitude coordinate order (as opposed to latitude, longitude) to match GeoJSON.\n *\n * Note that any Mapbox GL method that accepts a `LngLat` object as an argument or option\n * can also accept an `Array` of two numbers and will perform an implicit conversion.\n * This flexible type is documented as {@link LngLatLike}.\n *\n * @param {number} lng Longitude, measured in degrees.\n * @param {number} lat Latitude, measured in degrees.\n * @example\n * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n * @see [Get coordinates of the mouse pointer](https://www.mapbox.com/mapbox-gl-js/example/mouse-position/)\n * @see [Display a popup](https://www.mapbox.com/mapbox-gl-js/example/popup/)\n * @see [Highlight features within a bounding box](https://www.mapbox.com/mapbox-gl-js/example/using-box-queryrenderedfeatures/)\n * @see [Create a timeline animation](https://www.mapbox.com/mapbox-gl-js/example/timeline-animation/)\n */\nclass LngLat {\n    lng: number;\n    lat: number;\n\n    constructor(lng: number, lat: number) {\n        if (isNaN(lng) || isNaN(lat)) {\n            throw new Error(`Invalid LngLat object: (${lng}, ${lat})`);\n        }\n        this.lng = +lng;\n        this.lat = +lat;\n        if (this.lat > 90 || this.lat < -90) {\n            throw new Error('Invalid LngLat latitude value: must be between -90 and 90');\n        }\n    }\n\n    /**\n     * Returns a new `LngLat` object whose longitude is wrapped to the range (-180, 180).\n     *\n     * @returns {LngLat} The wrapped `LngLat` object.\n     * @example\n     * var ll = new mapboxgl.LngLat(286.0251, 40.7736);\n     * var wrapped = ll.wrap();\n     * wrapped.lng; // = -73.9749\n     */\n    wrap() {\n        return new LngLat(wrap(this.lng, -180, 180), this.lat);\n    }\n\n    /**\n     * Returns the coordinates represented as an array of two numbers.\n     *\n     * @returns {Array<number>} The coordinates represeted as an array of longitude and latitude.\n     * @example\n     * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n     * ll.toArray(); // = [-73.9749, 40.7736]\n     */\n    toArray() {\n        return [this.lng, this.lat];\n    }\n\n    /**\n     * Returns the coordinates represent as a string.\n     *\n     * @returns {string} The coordinates represented as a string of the format `'LngLat(lng, lat)'`.\n     * @example\n     * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n     * ll.toString(); // = \"LngLat(-73.9749, 40.7736)\"\n     */\n    toString() {\n        return `LngLat(${this.lng}, ${this.lat})`;\n    }\n\n    /**\n     * Returns a `LngLatBounds` from the coordinates extended by a given `radius`.\n     *\n     * @param {number} [radius=0] Distance in meters from the coordinates to extend the bounds.\n     * @returns {LngLatBounds} A new `LngLatBounds` object representing the coordinates extended by the `radius`.\n     * @example\n     * var ll = new mapboxgl.LngLat(-73.9749, 40.7736);\n     * ll.toBounds(100).toArray(); // = [[-73.97501862141328, 40.77351016847229], [-73.97478137858673, 40.77368983152771]]\n     */\n    toBounds(radius?: number = 0) {\n        const earthCircumferenceInMetersAtEquator = 40075017;\n        const latAccuracy = 360 * radius / earthCircumferenceInMetersAtEquator,\n            lngAccuracy = latAccuracy / Math.cos((Math.PI / 180) * this.lat);\n\n        return new LngLatBounds(new LngLat(this.lng - lngAccuracy, this.lat - latAccuracy),\n            new LngLat(this.lng + lngAccuracy, this.lat + latAccuracy));\n    }\n\n    /**\n     * Converts an array of two numbers or an object with `lng` and `lat` or `lon` and `lat` properties\n     * to a `LngLat` object.\n     *\n     * If a `LngLat` object is passed in, the function returns it unchanged.\n     *\n     * @param {LngLatLike} input An array of two numbers or object to convert, or a `LngLat` object to return.\n     * @returns {LngLat} A new `LngLat` object, if a conversion occurred, or the original `LngLat` object.\n     * @example\n     * var arr = [-73.9749, 40.7736];\n     * var ll = mapboxgl.LngLat.convert(arr);\n     * ll;   // = LngLat {lng: -73.9749, lat: 40.7736}\n     */\n    static convert(input: LngLatLike): LngLat {\n        if (input instanceof LngLat) {\n            return input;\n        }\n        if (Array.isArray(input) && (input.length === 2 || input.length === 3)) {\n            return new LngLat(Number(input[0]), Number(input[1]));\n        }\n        if (!Array.isArray(input) && typeof input === 'object' && input !== null) {\n            return new LngLat(\n                // flow can't refine this to have one of lng or lat, so we have to cast to any\n                Number('lng' in input ? (input: any).lng : (input: any).lon),\n                Number(input.lat)\n            );\n        }\n        throw new Error(\"`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]\");\n    }\n}\n\n/**\n * A {@link LngLat} object, an array of two numbers representing longitude and latitude,\n * or an object with `lng` and `lat` or `lon` and `lat` properties.\n *\n * @typedef {LngLat | {lng: number, lat: number} | {lon: number, lat: number} | [number, number]} LngLatLike\n * @example\n * var v1 = new mapboxgl.LngLat(-122.420679, 37.772537);\n * var v2 = [-122.420679, 37.772537];\n * var v3 = {lon: -122.420679, lat: 37.772537};\n */\nexport type LngLatLike = LngLat | {lng: number, lat: number} | {lon: number, lat: number} | [number, number];\n\nexport default LngLat;\n","// @flow\n\nimport LngLat from './lng_lat';\n\nimport type {LngLatLike} from './lng_lat';\n\n/**\n * A `LngLatBounds` object represents a geographical bounding box,\n * defined by its southwest and northeast points in longitude and latitude.\n *\n * If no arguments are provided to the constructor, a `null` bounding box is created.\n *\n * Note that any Mapbox GL method that accepts a `LngLatBounds` object as an argument or option\n * can also accept an `Array` of two {@link LngLatLike} constructs and will perform an implicit conversion.\n * This flexible type is documented as {@link LngLatBoundsLike}.\n *\n * @param {LngLatLike} [sw] The southwest corner of the bounding box.\n * @param {LngLatLike} [ne] The northeast corner of the bounding box.\n * @example\n * var sw = new mapboxgl.LngLat(-73.9876, 40.7661);\n * var ne = new mapboxgl.LngLat(-73.9397, 40.8002);\n * var llb = new mapboxgl.LngLatBounds(sw, ne);\n */\nclass LngLatBounds {\n    _ne: LngLat;\n    _sw: LngLat;\n\n    // This constructor is too flexible to type. It should not be so flexible.\n    constructor(sw: any, ne: any) {\n        if (!sw) {\n            // noop\n        } else if (ne) {\n            this.setSouthWest(sw).setNorthEast(ne);\n        } else if (sw.length === 4) {\n            this.setSouthWest([sw[0], sw[1]]).setNorthEast([sw[2], sw[3]]);\n        } else {\n            this.setSouthWest(sw[0]).setNorthEast(sw[1]);\n        }\n    }\n\n    /**\n     * Set the northeast corner of the bounding box\n     *\n     * @param {LngLatLike} ne\n     * @returns {LngLatBounds} `this`\n     */\n    setNorthEast(ne: LngLatLike) {\n        this._ne = ne instanceof LngLat ? new LngLat(ne.lng, ne.lat) : LngLat.convert(ne);\n        return this;\n    }\n\n    /**\n     * Set the southwest corner of the bounding box\n     *\n     * @param {LngLatLike} sw\n     * @returns {LngLatBounds} `this`\n     */\n    setSouthWest(sw: LngLatLike) {\n        this._sw = sw instanceof LngLat ? new LngLat(sw.lng, sw.lat) : LngLat.convert(sw);\n        return this;\n    }\n\n    /**\n     * Extend the bounds to include a given LngLat or LngLatBounds.\n     *\n     * @param {LngLat|LngLatBounds} obj object to extend to\n     * @returns {LngLatBounds} `this`\n     */\n    extend(obj: LngLat | LngLatBounds) {\n        const sw = this._sw,\n            ne = this._ne;\n        let sw2, ne2;\n\n        if (obj instanceof LngLat) {\n            sw2 = obj;\n            ne2 = obj;\n\n        } else if (obj instanceof LngLatBounds) {\n            sw2 = obj._sw;\n            ne2 = obj._ne;\n\n            if (!sw2 || !ne2) return this;\n\n        } else {\n            if (Array.isArray(obj)) {\n                if (obj.every(Array.isArray)) {\n                    return this.extend(LngLatBounds.convert(obj));\n                } else {\n                    return this.extend(LngLat.convert(obj));\n                }\n            }\n            return this;\n        }\n\n        if (!sw && !ne) {\n            this._sw = new LngLat(sw2.lng, sw2.lat);\n            this._ne = new LngLat(ne2.lng, ne2.lat);\n\n        } else {\n            sw.lng = Math.min(sw2.lng, sw.lng);\n            sw.lat = Math.min(sw2.lat, sw.lat);\n            ne.lng = Math.max(ne2.lng, ne.lng);\n            ne.lat = Math.max(ne2.lat, ne.lat);\n        }\n\n        return this;\n    }\n\n    /**\n     * Returns the geographical coordinate equidistant from the bounding box's corners.\n     *\n     * @returns {LngLat} The bounding box's center.\n     * @example\n     * var llb = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002]);\n     * llb.getCenter(); // = LngLat {lng: -73.96365, lat: 40.78315}\n     */\n    getCenter(): LngLat {\n        return new LngLat((this._sw.lng + this._ne.lng) / 2, (this._sw.lat + this._ne.lat) / 2);\n    }\n\n    /**\n     * Returns the southwest corner of the bounding box.\n     *\n     * @returns {LngLat} The southwest corner of the bounding box.\n     */\n    getSouthWest(): LngLat { return this._sw; }\n\n    /**\n    * Returns the northeast corner of the bounding box.\n    *\n    * @returns {LngLat} The northeast corner of the bounding box.\n     */\n    getNorthEast(): LngLat { return this._ne; }\n\n    /**\n    * Returns the northwest corner of the bounding box.\n    *\n    * @returns {LngLat} The northwest corner of the bounding box.\n     */\n    getNorthWest(): LngLat { return new LngLat(this.getWest(), this.getNorth()); }\n\n    /**\n    * Returns the southeast corner of the bounding box.\n    *\n    * @returns {LngLat} The southeast corner of the bounding box.\n     */\n    getSouthEast(): LngLat { return new LngLat(this.getEast(), this.getSouth()); }\n\n    /**\n    * Returns the west edge of the bounding box.\n    *\n    * @returns {number} The west edge of the bounding box.\n     */\n    getWest(): number { return this._sw.lng; }\n\n    /**\n    * Returns the south edge of the bounding box.\n    *\n    * @returns {number} The south edge of the bounding box.\n     */\n    getSouth(): number { return this._sw.lat; }\n\n    /**\n    * Returns the east edge of the bounding box.\n    *\n    * @returns {number} The east edge of the bounding box.\n     */\n    getEast(): number { return this._ne.lng; }\n\n    /**\n    * Returns the north edge of the bounding box.\n    *\n    * @returns {number} The north edge of the bounding box.\n     */\n    getNorth(): number { return this._ne.lat; }\n\n    /**\n     * Returns the bounding box represented as an array.\n     *\n     * @returns {Array<Array<number>>} The bounding box represented as an array, consisting of the\n     *   southwest and northeast coordinates of the bounding represented as arrays of numbers.\n     * @example\n     * var llb = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002]);\n     * llb.toArray(); // = [[-73.9876, 40.7661], [-73.9397, 40.8002]]\n     */\n    toArray() {\n        return [this._sw.toArray(), this._ne.toArray()];\n    }\n\n    /**\n     * Return the bounding box represented as a string.\n     *\n     * @returns {string} The bounding box represents as a string of the format\n     *   `'LngLatBounds(LngLat(lng, lat), LngLat(lng, lat))'`.\n     * @example\n     * var llb = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002]);\n     * llb.toString(); // = \"LngLatBounds(LngLat(-73.9876, 40.7661), LngLat(-73.9397, 40.8002))\"\n     */\n    toString() {\n        return `LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`;\n    }\n\n    /**\n     * Check if the bounding box is an empty/`null`-type box.\n     *\n     * @returns {boolean} True if bounds have been defined, otherwise false.\n     */\n    isEmpty() {\n        return !(this._sw && this._ne);\n    }\n\n    /**\n     * Converts an array to a `LngLatBounds` object.\n     *\n     * If a `LngLatBounds` object is passed in, the function returns it unchanged.\n     *\n     * Internally, the function calls `LngLat#convert` to convert arrays to `LngLat` values.\n     *\n     * @param {LngLatBoundsLike} input An array of two coordinates to convert, or a `LngLatBounds` object to return.\n     * @returns {LngLatBounds} A new `LngLatBounds` object, if a conversion occurred, or the original `LngLatBounds` object.\n     * @example\n     * var arr = [[-73.9876, 40.7661], [-73.9397, 40.8002]];\n     * var llb = mapboxgl.LngLatBounds.convert(arr);\n     * llb;   // = LngLatBounds {_sw: LngLat {lng: -73.9876, lat: 40.7661}, _ne: LngLat {lng: -73.9397, lat: 40.8002}}\n     */\n    static convert(input: LngLatBoundsLike): LngLatBounds {\n        if (!input || input instanceof LngLatBounds) return input;\n        return new LngLatBounds(input);\n    }\n}\n\n/**\n * A {@link LngLatBounds} object, an array of {@link LngLatLike} objects in [sw, ne] order,\n * or an array of numbers in [west, south, east, north] order.\n *\n * @typedef {LngLatBounds | [LngLatLike, LngLatLike] | [number, number, number, number]} LngLatBoundsLike\n * @example\n * var v1 = new mapboxgl.LngLatBounds(\n *   new mapboxgl.LngLat(-73.9876, 40.7661),\n *   new mapboxgl.LngLat(-73.9397, 40.8002)\n * );\n * var v2 = new mapboxgl.LngLatBounds([-73.9876, 40.7661], [-73.9397, 40.8002])\n * var v3 = [[-73.9876, 40.7661], [-73.9397, 40.8002]];\n */\nexport type LngLatBoundsLike = LngLatBounds | [LngLatLike, LngLatLike] | [number, number, number, number];\n\nexport default LngLatBounds;\n","// @flow\n\nimport LngLat from '../geo/lng_lat';\nimport type {LngLatLike} from '../geo/lng_lat';\n\n/*\n * The circumference of the world in meters at the given latitude.\n */\nfunction circumferenceAtLatitude(latitude: number) {\n    const circumference = 2 * Math.PI * 6378137;\n    return circumference * Math.cos(latitude * Math.PI / 180);\n}\n\nexport function mercatorXfromLng(lng: number) {\n    return (180 + lng) / 360;\n}\n\nexport function mercatorYfromLat(lat: number) {\n    return (180 - (180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + lat * Math.PI / 360)))) / 360;\n}\n\nexport function mercatorZfromAltitude(altitude: number, lat: number) {\n    return altitude / circumferenceAtLatitude(lat);\n}\n\nexport function lngFromMercatorX(x: number) {\n    return x * 360 - 180;\n}\n\nexport function latFromMercatorY(y: number) {\n    const y2 = 180 - y * 360;\n    return 360 / Math.PI * Math.atan(Math.exp(y2 * Math.PI / 180)) - 90;\n}\n\nexport function altitudeFromMercatorZ(z: number, y: number) {\n    return z * circumferenceAtLatitude(latFromMercatorY(y));\n}\n\n/**\n * A `MercatorCoordinate` object represents a projected three dimensional position.\n *\n * `MercatorCoordinate` uses the web mercator projection ([EPSG:3857](https://epsg.io/3857)) with slightly different units:\n * - the size of 1 unit is the width of the projected world instead of the \"mercator meter\"\n * - the origin of the coordinate space is at the north-west corner instead of the middle\n *\n * For example, `MercatorCoordinate(0, 0, 0)` is the north-west corner of the mercator world and\n * `MercatorCoordinate(1, 1, 0)` is the south-east corner. If you are familiar with\n * [vector tiles](https://github.com/mapbox/vector-tile-spec) it may be helpful to think\n * of the coordinate space as the `0/0/0` tile with an extent of `1`.\n *\n * The `z` dimension of `MercatorCoordinate` is conformal. A cube in the mercator coordinate space would be rendered as a cube.\n *\n * @param {number} x The x component of the position.\n * @param {number} y The y component of the position.\n * @param {number} z The z component of the position.\n * @example\n * var nullIsland = new mapboxgl.MercatorCoordinate(0.5, 0.5, 0);\n *\n * @see [Add a custom style layer](https://www.mapbox.com/mapbox-gl-js/example/custom-style-layer/)\n */\nclass MercatorCoordinate {\n    x: number;\n    y: number;\n    z: number;\n\n    constructor(x: number, y: number, z: number = 0) {\n        this.x = +x;\n        this.y = +y;\n        this.z = +z;\n    }\n\n    /**\n     * Project a `LngLat` to a `MercatorCoordinate`.\n     *\n     * @param {LngLatLike} lngLatLike The location to project.\n     * @param {number} altitude The altitude in meters of the position.\n     * @returns {MercatorCoordinate} The projected mercator coordinate.\n     * @example\n     * var coord = mapboxgl.MercatorCoordinate.fromLngLat({ lng: 0, lat: 0}, 0);\n     * coord; // MercatorCoordinate(0.5, 0.5, 0)\n     */\n    static fromLngLat(lngLatLike: LngLatLike, altitude: number = 0) {\n        const lngLat = LngLat.convert(lngLatLike);\n\n        return new MercatorCoordinate(\n                mercatorXfromLng(lngLat.lng),\n                mercatorYfromLat(lngLat.lat),\n                mercatorZfromAltitude(altitude, lngLat.lat));\n    }\n\n    /**\n     * Returns the `LngLat` for the coordinate.\n     *\n     * @returns {LngLat} The `LngLat` object.\n     * @example\n     * var coord = new mapboxgl.MercatorCoordinate(0.5, 0.5, 0);\n     * var latLng = coord.toLngLat(); // LngLat(0, 0)\n     */\n    toLngLat() {\n        return new LngLat(\n                lngFromMercatorX(this.x),\n                latFromMercatorY(this.y));\n    }\n\n    /**\n     * Returns the altitude in meters of the coordinate.\n     *\n     * @returns {number} The altitude in meters.\n     * @example\n     * var coord = new mapboxgl.MercatorCoordinate(0, 0, 0.02);\n     * coord.toAltitude(); // 6914.281956295339\n     */\n    toAltitude() {\n        return altitudeFromMercatorZ(this.z, this.y);\n    }\n}\n\nexport default MercatorCoordinate;\n","// @flow\n\nimport LngLatBounds from '../geo/lng_lat_bounds';\nimport {mercatorXfromLng, mercatorYfromLat} from '../geo/mercator_coordinate';\n\nimport type {CanonicalTileID} from './tile_id';\n\nclass TileBounds {\n    bounds: LngLatBounds;\n    minzoom: number;\n    maxzoom: number;\n\n    constructor(bounds: [number, number, number, number], minzoom: ?number, maxzoom: ?number) {\n        this.bounds = LngLatBounds.convert(this.validateBounds(bounds));\n        this.minzoom = minzoom || 0;\n        this.maxzoom = maxzoom || 24;\n    }\n\n    validateBounds(bounds: [number, number, number, number]) {\n        // make sure the bounds property contains valid longitude and latitudes\n        if (!Array.isArray(bounds) || bounds.length !== 4) return [-180, -90, 180, 90];\n        return [Math.max(-180, bounds[0]), Math.max(-90, bounds[1]), Math.min(180, bounds[2]), Math.min(90, bounds[3])];\n    }\n\n    contains(tileID: CanonicalTileID) {\n        const worldSize = Math.pow(2, tileID.z);\n        const level = {\n            minX: Math.floor(mercatorXfromLng(this.bounds.getWest()) * worldSize),\n            minY: Math.floor(mercatorYfromLat(this.bounds.getNorth()) * worldSize),\n            maxX: Math.ceil(mercatorXfromLng(this.bounds.getEast()) * worldSize),\n            maxY: Math.ceil(mercatorYfromLat(this.bounds.getSouth()) * worldSize)\n        };\n        const hit = tileID.x >= level.minX && tileID.x < level.maxX && tileID.y >= level.minY && tileID.y < level.maxY;\n        return hit;\n    }\n}\n\nexport default TileBounds;\n","\n//From https://github.com/Leaflet/Leaflet/blob/master/src/core/Util.js\nconst _templateRe = /\\{ *([\\w_]+) *\\}/g;\nconst _template = function (str, data) {\n    return str.replace(_templateRe, (str, key) => {\n        let value = data[key];\n\n        if (value === undefined) {\n            throw new Error(`No value provided for variable ${str}`);\n\n        } else if (typeof value === 'function') {\n            value = value(data);\n        }\n        return value;\n    });\n};\n\n//From https://github.com/Leaflet/Leaflet/blob/master/src/layer/tile/TileLayer.js\nconst _getSubdomain = function (tilePoint, subdomains) {\n    if (subdomains) {\n        const index = Math.abs(tilePoint.x + tilePoint.y) % subdomains.length;\n        return subdomains[index];\n    }\n    return null;\n};\n\nexport {\n    _template,\n    _getSubdomain\n};\n","// @flow\n\nimport window from '../util/window';\nconst { HTMLImageElement, HTMLCanvasElement, HTMLVideoElement, ImageData } = window;\n\nimport type Context from '../gl/context';\nimport type {RGBAImage, AlphaImage} from '../util/image';\n\nexport type TextureFormat =\n    | $PropertyType<WebGLRenderingContext, 'RGBA'>\n    | $PropertyType<WebGLRenderingContext, 'ALPHA'>;\nexport type TextureFilter =\n    | $PropertyType<WebGLRenderingContext, 'LINEAR'>\n    | $PropertyType<WebGLRenderingContext, 'LINEAR_MIPMAP_NEAREST'>\n    | $PropertyType<WebGLRenderingContext, 'NEAREST'>;\nexport type TextureWrap =\n    | $PropertyType<WebGLRenderingContext, 'REPEAT'>\n    | $PropertyType<WebGLRenderingContext, 'CLAMP_TO_EDGE'>\n    | $PropertyType<WebGLRenderingContext, 'MIRRORED_REPEAT'>;\n\ntype EmptyImage = {\n    width: number,\n    height: number,\n    data: null\n}\n\nexport type TextureImage =\n    | RGBAImage\n    | AlphaImage\n    | HTMLImageElement\n    | HTMLCanvasElement\n    | HTMLVideoElement\n    | ImageData\n    | EmptyImage;\n\nclass Texture {\n    context: Context;\n    size: [number, number];\n    texture: WebGLTexture;\n    format: TextureFormat;\n    filter: ?TextureFilter;\n    wrap: ?TextureWrap;\n    useMipmap: boolean;\n\n    constructor(context: Context, image: TextureImage, format: TextureFormat, options: ?{ premultiply?: boolean, useMipmap?: boolean }) {\n        this.context = context;\n        this.format = format;\n        this.texture = context.gl.createTexture();\n        this.update(image, options);\n    }\n\n    update(image: TextureImage, options: ?{premultiply?: boolean, useMipmap?: boolean}, position?: { x: number, y: number }) {\n        const {width, height} = image;\n        const resize = (!this.size || this.size[0] !== width || this.size[1] !== height) && !position;\n        const {context} = this;\n        const {gl} = context;\n\n        this.useMipmap = Boolean(options && options.useMipmap);\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n        context.pixelStoreUnpackFlipY.set(false);\n        context.pixelStoreUnpack.set(1);\n        context.pixelStoreUnpackPremultiplyAlpha.set(this.format === gl.RGBA && (!options || options.premultiply !== false));\n\n        if (resize) {\n            this.size = [width, height];\n\n            if (image instanceof HTMLImageElement || image instanceof HTMLCanvasElement || image instanceof HTMLVideoElement || image instanceof ImageData) {\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, gl.UNSIGNED_BYTE, image);\n            } else {\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, gl.UNSIGNED_BYTE, image.data);\n            }\n\n        } else {\n            const {x, y} = position || { x: 0, y: 0};\n            if (image instanceof HTMLImageElement || image instanceof HTMLCanvasElement || image instanceof HTMLVideoElement || image instanceof ImageData) {\n                gl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, gl.RGBA, gl.UNSIGNED_BYTE, image);\n            } else {\n                gl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, width, height, gl.RGBA, gl.UNSIGNED_BYTE, image.data);\n            }\n        }\n\n        if (this.useMipmap && this.isSizePowerOfTwo()) {\n            gl.generateMipmap(gl.TEXTURE_2D);\n        }\n    }\n\n    bind(filter: TextureFilter, wrap: TextureWrap, minFilter: ?TextureFilter) {\n        const {context} = this;\n        const {gl} = context;\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n\n        if (minFilter === gl.LINEAR_MIPMAP_NEAREST && !this.isSizePowerOfTwo()) {\n            minFilter = gl.LINEAR;\n        }\n\n        if (filter !== this.filter) {\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter || filter);\n            this.filter = filter;\n        }\n\n        if (wrap !== this.wrap) {\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap);\n            this.wrap = wrap;\n        }\n    }\n\n    isSizePowerOfTwo() {\n        return this.size[0] === this.size[1] && (Math.log(this.size[0]) / Math.LN2) % 1 === 0;\n    }\n\n    destroy() {\n        const {gl} = this.context;\n        gl.deleteTexture(this.texture);\n        this.texture = (null: any);\n    }\n}\n\nexport default Texture;\n","// @flow\n\nimport { extend, pick } from 'mapbox-gl/src/util/util';\nimport { getImage, ResourceType } from 'mapbox-gl/src/util/ajax';\nimport { Event, ErrorEvent, Evented } from 'mapbox-gl/src/util/evented';\nimport loadArcGISMapServer from './load_arcgis_mapserver';\nimport TileBounds from 'mapbox-gl/src/source/tile_bounds';\nimport {_template, _getSubdomain} from './helpers';\nimport Texture from 'mapbox-gl/src/render/texture';\nimport { cacheEntryPossiblyAdded } from 'mapbox-gl/src/util/tile_request_cache';\n\nimport type {Source} from 'mapbox-gl/src/source/source';\nimport type {OverscaledTileID} from 'mapbox-gl/src/source/tile_id';\nimport type Map from 'mapbox-gl/src/ui/map';\nimport type Dispatcher from 'mapbox-gl/src/util/dispatcher';\nimport type Tile from 'mapbox-gl/src/source/tile';\nimport type {Callback} from 'mapbox-gl/src/types/callback';\n\nclass ArcGISTiledMapServiceSource extends Evented implements Source {\n\n    type: 'raster' | 'raster-dem';\n    id: string;\n    minzoom: number;\n    maxzoom: number;\n    url: string;\n    scheme: string;\n    tileSize: number;\n\n    bounds: ?[number, number, number, number];\n    tileBounds: TileBounds;\n    roundZoom: boolean;\n    dispatcher: Dispatcher;\n    map: Map;\n    tiles: Array<string>;\n\n    _loaded: boolean;\n    _options: RasterSourceSpecification | RasterDEMSourceSpecification;\n\n    constructor(id: string, options: RasterSourceSpecification | RasterDEMSourceSpecification, dispatcher: Dispatcher, eventedParent: Evented) {\n        super();\n        this.id = id;\n        this.dispatcher = dispatcher;\n        this.setEventedParent(eventedParent);\n\n        this.type = 'arcgisraster';\n        this.minzoom = 0;\n        this.maxzoom = 22;\n        this.roundZoom = true;\n        this.tileSize = 512;\n        this._loaded = false;\n\n        this._options = extend({}, options);\n        extend(this, pick(options, ['url', 'scheme', 'tileSize']));\n    }\n\n    load() {\n        this.fire(new Event('dataloading', {dataType: 'source'}));\n        loadArcGISMapServer(this._options, (err, metadata) => {\n            if (err) {\n                this.fire(new ErrorEvent(err));\n            } else if (metadata) {\n                extend(this, metadata);\n\n                if (metadata.bounds) {\n                    this.tileBounds = new TileBounds(metadata.bounds, this.minzoom, this.maxzoom);\n                }\n\n            // `content` is included here to prevent a race condition where `Style#_updateSources` is called\n            // before the TileJSON arrives. this makes sure the tiles needed are loaded once TileJSON arrives\n            // ref: https://github.com/mapbox/mapbox-gl-js/pull/4347#discussion_r104418088\n            this.fire(new Event('data', {dataType: 'source', sourceDataType: 'metadata'}));\n            this.fire(new Event('data', {dataType: 'source', sourceDataType: 'content'}));\n            }\n        });\n    }\n\n    onAdd(map: Map) {\n        // set the urls\n        const baseUrl = this.url.split('?')[0];\n        this.tileUrl = `${baseUrl}/tile/{z}/{y}/{x}`;\n\n        const arcgisonline = new RegExp(/tiles.arcgis(online)?\\.com/g);\n        if (arcgisonline.test(this.url)) {\n            this.tileUrl = this.tileUrl.replace('://tiles', '://tiles{s}');\n            this.subdomains = ['1', '2', '3', '4'];\n        }\n\n        if (this.token) {\n            this.tileUrl += (`?token=${this.token}`);\n        }\n        \n        this.map = map;\n        this.load();\n    }\n\n    onRemove() {\n\n    }\n\n    serialize() {\n        return extend({}, this._options);\n    }\n\n    hasTile(tileID: OverscaledTileID) {\n        return !this.tileBounds || this.tileBounds.contains(tileID.canonical);\n    }\n\n    loadTile(tile: Tile, callback: Callback<void>) {\n        //convert to ags coords\n        const tilePoint = { z: tile.tileID.overscaledZ, x: tile.tileID.canonical.x, y: tile.tileID.canonical.y };\n\n        const url =  _template(this.tileUrl, extend({\n            s: _getSubdomain(tilePoint, this.subdomains),\n            z: (this._lodMap && this._lodMap[tilePoint.z]) ? this._lodMap[tilePoint.z] : tilePoint.z, // try lod map first, then just defualt to zoom level\n            x: tilePoint.x,\n            y: tilePoint.y\n        }, this.options));\n        tile.request = getImage({url},  (err, img) => {\n            delete tile.request;\n\n            if (tile.aborted) {\n                tile.state = 'unloaded';\n                callback(null);\n            } else if (err) {\n                tile.state = 'errored';\n                callback(err);\n            } else if (img) {\n                if (this.map._refreshExpiredTiles) tile.setExpiryData(img);\n                delete (img: any).cacheControl;\n                delete (img: any).expires;\n\n                const context = this.map.painter.context;\n                const gl = context.gl;\n                tile.texture = this.map.painter.getTileTexture(img.width);\n                if (tile.texture) {\n                    tile.texture.update(img, { useMipmap: true });\n                } else {\n                    tile.texture = new Texture(context, img, gl.RGBA, { useMipmap: true });\n                    tile.texture.bind(gl.LINEAR, gl.CLAMP_TO_EDGE, gl.LINEAR_MIPMAP_NEAREST);\n\n                    if (context.extTextureFilterAnisotropic) {\n                        gl.texParameterf(gl.TEXTURE_2D, context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT, context.extTextureFilterAnisotropicMax);\n                    }\n                }\n\n                tile.state = 'loaded';\n                cacheEntryPossiblyAdded(this.dispatcher);\n                callback(null);\n            }\n        });\n    }\n\n    abortTile(tile: Tile, callback: Callback<void>) {\n        if (tile.request) {\n            tile.request.cancel();\n            delete tile.request;\n        }\n        callback();\n    }\n\n    unloadTile(tile: Tile, callback: Callback<void>) {\n        if (tile.texture) this.map.painter.saveTileTexture(tile.texture);\n        callback();\n    }\n\n    hasTransition() {\n        return false;\n    }\n}\n\nexport default ArcGISTiledMapServiceSource;"],"names":["extend","dest","sources","src","k","pick","properties","const","result","i","length","let","uuid","b","a","Math","random","toString","replace","validateUuid","str","test","warnOnceHistory","warnOnce","message","console","warn","parseCacheControl","cacheControl","header","$0","$1","$2","$3","value","toLowerCase","maxAge","parseInt","isNaN","storageAvailable","type","storage","window","setItem","removeItem","e","linkEl","glForTesting","webpImgTest","config","API_URL","EVENTS_URL","this","indexOf","FEEDBACK_URL","REQUIRE_ACCESS_TOKEN","ACCESS_TOKEN","MAX_PARALLEL_IMAGE_REQUESTS","now","performance","bind","Date","raf","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","cancel","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","exported","frame","fn","getImageData","img","canvas","document","createElement","context","getContext","Error","width","height","drawImage","resolveURL","path","href","hardwareConcurrency","navigator","devicePixelRatio","onload","gl","texture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","isContextLost","deleteTexture","testWebpTextureUpload","onerror","isMapboxURL","url","mapboxHTTPURLRe","isMapboxHTTPURL","urlRe","parseAccessToken","accessToken","parts","split","JSON","parse","decodeURIComponent","atob","map","c","charCodeAt","slice","join","TelemetryEvent","constructor","anonId","eventData","queue","pendingRequest","getStorageKey","domain","tokenData","u","btoa","encodeURIComponent","match","p1","String","fromCharCode","Number","telemEventKey","fetchEventData","isLocalStorageAvailable","storageKey","uuidKey","data","localStorage","getItem","saveEventData","Object","keys","stringify","processRequests","postEvent","timestamp","additionalPayload","callback","eventsUrlObject","protocol","authority","params","parseUrl","push","obj","payload","event","toISOString","userId","finalPayload","request","headers","Content-Type","postData","error","queueRequest","responseConstructorSupportsReadableStream","MapLoadEvent","super","success","skuToken","postMapLoadEvent","tileUrls","mapId","Array","isArray","some","id","shift","err","turnstileEvent_","postTurnstileEvent","lastSuccess","tokenU","dueForEvent","nextUpdate","lastUpdate","nextDate","daysElapsed","getDate","enabled.telemetry","mapLoadEvent_","CACHE_NAME","cacheLimit","cacheCheckThreshold","MIN_TIME_UNTIL_EXPIRY","cachePut","response","requestTime","caches","options","status","statusText","Headers","forEach","v","set","get","toUTCString","getTime","undefined","Response","ReadableStream","body","blob","then","prepareBody","clonedResponse","open","cache","put","stripQueryParameters","start","cacheGet","catch","ignoreSearch","fresh","expires","isFresh","strippedURL","delete","clone","globalEntryCounter","Infinity","freeze","Unknown","Style","Source","Tile","Glyphs","SpriteImage","SpriteJSON","Image","AJAXError","name","isWorker","WorkerGlobalScope","self","getReferrer","worker","referrer","origin","location","pathname","makeFetchRequest","requestParameters","controller","AbortController","Request","method","credentials","signal","complete","cacheIgnoringSearch","validateOrFetch","cachedResponse","responseIsFresh","finishRequest","fetch","ok","cacheableResponse","code","arrayBuffer","json","text","abort","imageQueue","numImageRequests","makeRequest","prototype","hasOwnProperty","actor","send","xhr","XMLHttpRequest","responseType","setRequestHeader","withCredentials","getResponseHeader","makeXMLHttpRequest","getJSON","getImage","queued","cancelled","advanced","advanceImageRequestQueue","getArrayBuffer","URL","webkitURL","revokeObjectURL","Blob","Uint8Array","byteLength","createObjectURL","_addEventListener","listener","listenerList","_removeEventListener","index","splice","Event","ErrorEvent","Evented","on","_listeners","off","_oneTimeListeners","once","fire","listens","target","call","parent","_eventedParent","_eventedParentData","setEventedParent","SphericalMercator","D2R","PI","R2D","A","MAXEXTENT","isFloat","n","size","Bc","Cc","zc","Ac","d","px","ll","zoom","pow","bc","cc","ac","f","min","max","sin","x","y","log","round","g","atan","exp","bbox","tms_style","srs","ur","concat","convert","xyz","px_ll","px_ur","floor","bounds","minX","apply","minY","maxX","maxY","tms","to","forward","inverse","xy","tan","module","MercatorZoomLevels","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","_withinPercentage","percentage","abs","LngLat","lng","lat","wrap","w","toArray","toBounds","radius","latAccuracy","lngAccuracy","cos","LngLatBounds","input","lon","sw","ne","setSouthWest","setNorthEast","mercatorXfromLng","mercatorYfromLat","_ne","_sw","sw2","ne2","every","getCenter","getSouthWest","getNorthEast","getNorthWest","getWest","getNorth","getSouthEast","getEast","getSouth","isEmpty","TileBounds","minzoom","maxzoom","validateBounds","contains","tileID","worldSize","z","level","ceil","_templateRe","_getSubdomain","tilePoint","subdomains","Texture","image","format","update","position","resize","useMipmap","Boolean","pixelStoreUnpackFlipY","pixelStoreUnpack","pixelStoreUnpackPremultiplyAlpha","premultiply","HTMLImageElement","HTMLCanvasElement","HTMLVideoElement","ImageData","texSubImage2D","isSizePowerOfTwo","generateMipmap","filter","minFilter","LINEAR_MIPMAP_NEAREST","LINEAR","texParameteri","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","LN2","destroy","dispatcher","eventedParent","roundZoom","tileSize","_loaded","_options","load","dataType","metadata","tileBounds","sourceDataType","onAdd","baseUrl","tileUrl","RegExp","token","onRemove","serialize","hasTile","canonical","loadTile","tile","overscaledZ","s","_lodMap","key","aborted","state","_refreshExpiredTiles","setExpiryData","painter","getTileTexture","CLAMP_TO_EDGE","extTextureFilterAnisotropic","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","extTextureFilterAnisotropicMax","abortTile","unloadTile","saveTileTexture","hasTransition"],"mappings":"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"}