!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ArcGISTiledMapServiceSource=e()}(this,function(){"use strict";function t(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var s in o)t[s]=o[s]}return t}function e(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n}function n(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function r(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}var i={};function o(t){i[t]||("undefined"!=typeof console&&console.warn(t),i[t]=!0)}function s(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var a,h,u={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return 0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":"https://events.mapbox.com/events/v2"},REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},l=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),c=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,p=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,f={now:l,frame:function(t){var e=c(t);return{cancel:function(){return p(e)}}},getImageData:function(t){var e=self.document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(0,0,t.width,t.height)},resolveURL:function(t){var e=self.document.createElement("a");return e.href=t,e.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio}};self.document&&((h=self.document.createElement("img")).onload=function(){a&&function(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,h),t.isContextLost())return}catch(t){}t.deleteTexture(e)}(a),a=null},h.onerror=function(){a=null},h.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var m=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;var d=/^(\w+):\/\/([^\/?]*)(\/[^?]+)?\??(.+)?/;var v=function(t){this.type=t,this.anonId=null,this.eventData={lastSuccess:null,accessToken:u.ACCESS_TOKEN},this.queue=[],this.pendingRequest=null};v.prototype.fetchEventData=function(){if(s("localStorage"))try{var t=self.localStorage.getItem("mapbox.eventData:");t&&(this.eventData=JSON.parse(t));var e=self.localStorage.getItem("mapbox.eventData.uuid:");e&&(this.anonId=e)}catch(t){o("Unable to read from LocalStorage")}},v.prototype.saveEventData=function(){if(s("localStorage"))try{self.localStorage.setItem("mapbox.eventData.uuid:",this.anonId),this.eventData.lastSuccess&&self.localStorage.setItem("mapbox.eventData:",JSON.stringify(this.eventData))}catch(t){o("Unable to write to LocalStorage")}},v.prototype.processRequests=function(){},v.prototype.postEvent=function(e,n,r){var i=this,o=function(t){var e=t.match(d);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}(u.EVENTS_URL);o.params.push("access_token=");var s,a,h={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"0.52.0",userId:this.anonId},l=n?t(h,n):h,c={url:(s=o,a=s.params.length?"?"+s.params.join("&"):"",s.protocol+"://"+s.authority+s.path+a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([l])};this.pendingRequest=S(c,function(t){i.pendingRequest=null,r(t),i.saveEventData(),i.processRequests()})},v.prototype.queueRequest=function(t){this.queue.push(t),this.processRequests()};var y=function(t){function e(){t.call(this,"map.load"),this.success={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postMapLoadEvent=function(t,e){},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var e=this.queue.shift(),i=e.id,o=e.timestamp;i&&this.success[i]||(this.anonId||this.fetchEventData(),r(this.anonId)||(this.anonId=n()),this.postEvent(o,{},function(e){e||i&&(t.success[i]=!0)}))}},e}(v),g=new(function(t){function e(){t.call(this,"appUserTurnstile")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postTurnstileEvent=function(t){},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var e=!!this.eventData.accessToken&&this.eventData.accessToken!==u.ACCESS_TOKEN;e&&(this.anonId=this.eventData.lastSuccess=null),this.anonId&&this.eventData.lastSuccess||this.fetchEventData(),r(this.anonId)||(this.anonId=n(),e=!0);var i=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(i),a=(i-this.eventData.lastSuccess)/864e5;e=e||a>=1||a<-1||o.getDate()!==s.getDate()}else e=!0;if(!e)return this.processRequests();this.postEvent(i,{"enabled.telemetry":!1},function(e){e||(t.eventData.lastSuccess=i,t.eventData.accessToken=u.ACCESS_TOKEN)})}},e}(v)),_=(g.postTurnstileEvent.bind(g),new y);_.postMapLoadEvent.bind(_);"function"==typeof Object.freeze&&Object.freeze({Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"});var E=function(t){function e(e,n,r){401===n&&function(t){return m.test(t)}(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens"),t.call(this,e),this.status=n,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),A="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope?function(){return self.worker&&self.worker.referrer}:function(){var t=self.location.origin;if(t&&"null"!==t&&"file://"!==t)return t+self.location.pathname};var T,w,M=self.fetch&&self.Request&&self.AbortController?function(t,e){var n=new self.AbortController,r=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:A(),signal:n.signal});return"json"===t.type&&r.headers.set("Accept","application/json"),self.fetch(r).then(function(n){n.ok?n[t.type||"text"]().then(function(t){e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires"))}).catch(function(t){return e(new Error(t.message))}):e(new E(n.statusText,n.status,t.url))}).catch(function(t){20!==t.code&&e(new Error(t.message))}),{cancel:function(){return n.abort()}}}:function(t,e){var n=new self.XMLHttpRequest;for(var r in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&n.setRequestHeader("Accept","application/json"),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new E(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}},x=function(e,n){return M(t(e,{type:"json"}),n)},S=function(e,n){return M(t(e,{method:"POST"}),n)};T=[],w=0;var I=function(e,n){if(w>=u.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:n,cancelled:!1};return T.push(r),{cancel:function(){r.cancelled=!0}}}w++;var i=!1,o=function(){if(!i)for(i=!0,w--;T.length&&w<u.MAX_PARALLEL_IMAGE_REQUESTS;){var t=T.shift(),e=t.requestParameters,n=t.callback;t.cancelled||I(e,n)}},s=function(e,n){return M(t(e,{type:"arrayBuffer"}),n)}(e,function(t,e,r,i){if(o(),t)n(t);else if(e){var s=new self.Image,a=self.URL||self.webkitURL;s.onload=function(){n(null,s),a.revokeObjectURL(s.src)},s.onerror=function(){return n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var h=new self.Blob([new Uint8Array(e)],{type:"image/png"});s.cacheControl=r,s.expires=i,s.src=e.byteLength?a.createObjectURL(h):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}});return{cancel:function(){s.cancel(),o()}}};function R(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function b(t,e,n){if(n&&n[t]){var r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}var z=function(e,n){void 0===n&&(n={}),t(this,n),this.type=e},N=function(e){function n(n,r){void 0===r&&(r={}),e.call(this,"error",t({error:n},r))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n}(z),U=function(){};U.prototype.on=function(t,e){return this._listeners=this._listeners||{},R(t,e,this._listeners),this},U.prototype.off=function(t,e){return b(t,e,this._listeners),b(t,e,this._oneTimeListeners),this},U.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},R(t,e,this._oneTimeListeners),this},U.prototype.fire=function(e,n){"string"==typeof e&&(e=new z(e,n||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var i=0,o=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];i<o.length;i+=1){o[i].call(this,e)}for(var s=0,a=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];s<a.length;s+=1){var h=a[s];b(r,h,this._oneTimeListeners),h.call(this,e)}var u=this._eventedParent;u&&(t(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof N&&console.error(e.error);return this},U.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},U.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var P,D=(function(t,e){var n=function(){var t={},e=Math.PI/180,n=180/Math.PI,r=6378137,i=20037508.342789244;function o(t){return Number(t)===t&&t%1!=0}function s(e){if(e=e||{},this.size=e.size||256,!t[this.size]){var n=this.size,r=t[this.size]={};r.Bc=[],r.Cc=[],r.zc=[],r.Ac=[];for(var i=0;i<30;i++)r.Bc.push(n/360),r.Cc.push(n/(2*Math.PI)),r.zc.push(n/2),r.Ac.push(n),n*=2}this.Bc=t[this.size].Bc,this.Cc=t[this.size].Cc,this.zc=t[this.size].zc,this.Ac=t[this.size].Ac}return s.prototype.px=function(t,n){if(o(n)){var r=this.size*Math.pow(2,n),i=r/2,s=r/360,a=r/(2*Math.PI),h=r,u=Math.min(Math.max(Math.sin(e*t[1]),-.9999),.9999);return(l=i+t[0]*s)>h&&(l=h),(c=i+.5*Math.log((1+u)/(1-u))*-a)>h&&(c=h),[l,c]}i=this.zc[n],u=Math.min(Math.max(Math.sin(e*t[1]),-.9999),.9999);var l=Math.round(i+t[0]*this.Bc[n]),c=Math.round(i+.5*Math.log((1+u)/(1-u))*-this.Cc[n]);return l>this.Ac[n]&&(l=this.Ac[n]),c>this.Ac[n]&&(c=this.Ac[n]),[l,c]},s.prototype.ll=function(t,e){if(o(e)){var r=this.size*Math.pow(2,e),i=r/360,s=r/(2*Math.PI),a=r/2,h=(t[1]-a)/-s;return[(t[0]-a)/i,n*(2*Math.atan(Math.exp(h))-.5*Math.PI)]}h=(t[1]-this.zc[e])/-this.Cc[e];return[(t[0]-this.zc[e])/this.Bc[e],n*(2*Math.atan(Math.exp(h))-.5*Math.PI)]},s.prototype.bbox=function(t,e,n,r,i){r&&(e=Math.pow(2,n)-1-e);var o=[t*this.size,(+e+1)*this.size],s=[(+t+1)*this.size,e*this.size],a=this.ll(o,n).concat(this.ll(s,n));return"900913"===i?this.convert(a,"900913"):a},s.prototype.xyz=function(t,e,n,r){"900913"===r&&(t=this.convert(t,"WGS84"));var i=[t[0],t[1]],o=[t[2],t[3]],s=this.px(i,e),a=this.px(o,e),h=[Math.floor(s[0]/this.size),Math.floor((a[0]-1)/this.size)],u=[Math.floor(a[1]/this.size),Math.floor((s[1]-1)/this.size)],l={minX:Math.min.apply(Math,h)<0?0:Math.min.apply(Math,h),minY:Math.min.apply(Math,u)<0?0:Math.min.apply(Math,u),maxX:Math.max.apply(Math,h),maxY:Math.max.apply(Math,u)};if(n){var c={minY:Math.pow(2,e)-1-l.maxY,maxY:Math.pow(2,e)-1-l.minY};l.minY=c.minY,l.maxY=c.maxY}return l},s.prototype.convert=function(t,e){return"900913"===e?this.forward(t.slice(0,2)).concat(this.forward(t.slice(2,4))):this.inverse(t.slice(0,2)).concat(this.inverse(t.slice(2,4)))},s.prototype.forward=function(t){var n=[r*t[0]*e,r*Math.log(Math.tan(.25*Math.PI+.5*t[1]*e))];return n[0]>i&&(n[0]=i),n[0]<-i&&(n[0]=-i),n[1]>i&&(n[1]=i),n[1]<-i&&(n[1]=-i),n},s.prototype.inverse=function(t){return[t[0]*n/r,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/r)))*n]},s}();t.exports=n}(P={exports:{}},P.exports),P.exports),C={0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763},L=function(t,e,n){return Math.abs(t/e-1)<n};var q=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};q.prototype.wrap=function(){return new q((t=this.lng,(i=((t-(e=-180))%(r=(n=180)-e)+r)%r+e)===e?n:i),this.lat);var t,e,n,r,i},q.prototype.toArray=function(){return[this.lng,this.lat]},q.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},q.prototype.toBounds=function(t){var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new B(new q(this.lng-n,this.lat-e),new q(this.lng+n,this.lat+e))},q.convert=function(t){if(t instanceof q)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new q(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new q(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var B=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};function X(t){return(180+t)/360}function k(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}B.prototype.setNorthEast=function(t){return this._ne=t instanceof q?new q(t.lng,t.lat):q.convert(t),this},B.prototype.setSouthWest=function(t){return this._sw=t instanceof q?new q(t.lng,t.lat):q.convert(t),this},B.prototype.extend=function(t){var e,n,r=this._sw,i=this._ne;if(t instanceof q)e=t,n=t;else{if(!(t instanceof B))return Array.isArray(t)?t.every(Array.isArray)?this.extend(B.convert(t)):this.extend(q.convert(t)):this;if(e=t._sw,n=t._ne,!e||!n)return this}return r||i?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new q(e.lng,e.lat),this._ne=new q(n.lng,n.lat)),this},B.prototype.getCenter=function(){return new q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},B.prototype.getSouthWest=function(){return this._sw},B.prototype.getNorthEast=function(){return this._ne},B.prototype.getNorthWest=function(){return new q(this.getWest(),this.getNorth())},B.prototype.getSouthEast=function(){return new q(this.getEast(),this.getSouth())},B.prototype.getWest=function(){return this._sw.lng},B.prototype.getSouth=function(){return this._sw.lat},B.prototype.getEast=function(){return this._ne.lng},B.prototype.getNorth=function(){return this._ne.lat},B.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},B.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},B.prototype.isEmpty=function(){return!(this._sw&&this._ne)},B.convert=function(t){return!t||t instanceof B?t:new B(t)};var G=function(t,e,n){this.bounds=B.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=n||24};G.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},G.prototype.contains=function(t){var e=Math.pow(2,t.z),n=Math.floor(X(this.bounds.getWest())*e),r=Math.floor(k(this.bounds.getNorth())*e),i=Math.ceil(X(this.bounds.getEast())*e),o=Math.ceil(k(this.bounds.getSouth())*e);return t.x>=n&&t.x<i&&t.y>=r&&t.y<o};var Y=/\{ *([\w_]+) *\}/g,j=function(t,e){return e?e[Math.abs(t.x+t.y)%e.length]:null},O=self.HTMLImageElement,F=self.HTMLCanvasElement,V=self.HTMLVideoElement,J=self.ImageData,Q=function(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)};return Q.prototype.update=function(t,e){var n=t.width,r=t.height,i=!this.size||this.size[0]!==n||this.size[1]!==r,o=this.context,s=o.gl;this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),i?(this.size=[n,r],t instanceof O||t instanceof F||t instanceof V||t instanceof J?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,r,0,this.format,s.UNSIGNED_BYTE,t.data)):t instanceof O||t instanceof F||t instanceof V||t instanceof J?s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,0,0,n,r,s.RGBA,s.UNSIGNED_BYTE,t.data),this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Q.prototype.bind=function(t,e,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},Q.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Q.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null},function(n){function r(r,i,o,s){n.call(this),this.id=r,this.dispatcher=o,this.setEventedParent(s),this.type="arcgisraster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.tileSize=512,this._loaded=!1,this._options=t({},i),t(this,e(i,["url","scheme","tileSize"]))}return n&&(r.__proto__=n),r.prototype=Object.create(n&&n.prototype),r.prototype.constructor=r,r.prototype.load=function(){var n,r,i,o=this;this.fire(new z("dataloading",{dataType:"source"})),n=this._options,r=function(e,n){e?o.fire(new N(e)):n&&(t(o,n),n.bounds&&(o.tileBounds=new G(n.bounds,o.minzoom,o.maxzoom)),o.fire(new z("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new z("data",{dataType:"source",sourceDataType:"content"})))},i=function(t,n){if(t)return r(t);var i=e(n,["tileInfo","initialExtent","fullExtent","spatialReference","tileServers","documentInfo"]);i._lodMap={};var o=n.spatialReference.latestWkid||n.spatialReference.wkid;if(102100===o||3857===o){var s=n.fullExtent;if(s&&s.spatialReference&&102100===s.spatialReference.wkid){var a=[s.xmin,s.ymin,s.xmax,s.ymax],h=new D({size:256}).convert(a);i.bounds=h}var u=n.tileInfo.lods,l=C;i.minzoom=u[0].level,i.maxzoom=u[u.length-1].level;for(var c=0;c<u.length;c++){var p=u[c];for(var f in l){var m=l[f];if(L(p.resolution,m,.1)){i._lodMap[f]=p.level;break}}}}else r(new Error("non-mercator spatial reference"));r(null,i)},n.url?x({url:n.url},i):f.frame(i.bind(null,null,n))},r.prototype.onAdd=function(t){var e=this.url.split("?")[0];this.tileUrl=e+"/tile/{z}/{y}/{x}",new RegExp(/tiles.arcgis(online)?\.com/g).test(this.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),this.subdomains=["1","2","3","4"]),this.token&&(this.tileUrl+="?token="+this.token),this.map=t,this.load()},r.prototype.serialize=function(){return t({},this._options)},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.loadTile=function(e,n){var r,i,o=this,s={z:e.tileID.overscaledZ,x:e.tileID.canonical.x,y:e.tileID.canonical.y},a=(r=this.tileUrl,i=t({s:j(s,this.subdomains),z:this._lodMap&&this._lodMap[s.z]?this._lodMap[s.z]:s.z,x:s.x,y:s.y},this.options),r.replace(Y,function(t,e){var n=i[e];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(i)),n}));e.request=I({url:a},function(t,r){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(t)e.state="errored",n(t);else if(r){o.map._refreshExpiredTiles&&e.setExpiryData(r),delete r.cacheControl,delete r.expires;var i=o.map.painter.context,s=i.gl;e.texture=o.map.painter.getTileTexture(r.width),e.texture?e.texture.update(r,{useMipmap:!0}):(e.texture=new Q(i,r,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),e.state="loaded",n(null)}})},r.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},r.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},r.prototype.hasTransition=function(){return!1},r}(U)});
//# sourceMappingURL=mapbox-gl-arcgis-tiled-map-service.js.map
